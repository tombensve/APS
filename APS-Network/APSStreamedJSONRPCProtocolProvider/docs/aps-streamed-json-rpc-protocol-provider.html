<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generated-by" content="MarkdownDoc"/>
    <link href="docs.css" type="text/css" rel="stylesheet"/>
  </head>
  <body>
    <H1>APSStreamedJSONRPCProtocolProvider</H1>
    <p>
      This provides JSONRPC protocol. It provides both version 1.0 and 2.0 of the protocol. It requires a transport that uses it and services provided by aps-external-protocol-extender to be useful.      
    </p>
    <p>
      JSONRPC version 1.0 protocol as described at <a href='http://json-rpc.org/wiki/specification' title=''>http://json-rpc.org/wiki/specification</a>.      
    </p>
    <p>
      JSONRPC version 2.0 protocol as describved at <a href='http://jsonrpc.org/spec.html' title=''>http://jsonrpc.org/spec.html</a>.      
    </p>
    <p>
      JSONHTTP version 1.0 which is not any standard protocol at all. It requires both service name and method name on the url, and in case of HTTP GET or DELETE also arguments as ?params=arg:...:arg where values are strings or primitives. For POST, and PUT a JSON array of values need to be written on the stream.      
    </p>
    <p>
      JSONREST version 1.0 extending JSONHTTP requeres callable methods to be annotated with @APSWebService. The optional <em>httpMethod</em> value can also be set and will be validated agains the HTTP method of the call if set.      
    </p>
    <p>
      Personally I think that JSONRPC 2.0 is far more flexible than REST.      
    </p>
    <H2>Examples</H2>
    <p>
      Here is some examples calling services over http with diffent protocols using curl (<em>requires aps-ext-protocol-http-transport-provider.jar and the called services to be deployed</em>,<em> and specified as externalizable via configuration</em> (Network/service/external-protocol-extender)):      
    </p>
    <pre>
      <code>
    curl --data '{"jsonrpc": "2.0", "method": "getPlatformDescription", "params": [], "id": 1}' http://localhost:8080/apsrpc/JSONRPC/2.0/se.natusoft.osgi.aps.api.core.platform.service.APSPlatformService 
      </code>
    </pre>
    <p>
      yields:      
    </p>
    <pre>
      <code>
    {"id": 1, "result": {"description": "My personal development environment.", "type": "Development", "identifier": "MyDev"}, "jsonrpc": "2.0"}
        
      </code>
    </pre>
    <p>
      while      
    </p>
    <pre>
      <code>
    curl --get http://localhost:8080/apsrpc/JSONHTTP/1.0/se.natusoft.osgi.aps.api.core.platform.service.APSPlatformService/getPlatformDescription
    
      </code>
    </pre>
    <p>
      yields      
    </p>
    <pre>
      <code>
    {"description": "My personal development environment.", "type": "Development", "identifier": "MyDev"}
       
      </code>
    </pre>
    <p>
      and      
    </p>
    <pre>
      <code>
     curl --get http://localhost:8080/apsrpc/JSONHTTP/1.0/se.natusoft.osgi.aps.api.misc.session.APSSessionService/createSession\(Integer\)?params=5
     
      </code>
    </pre>
    <p>
      yields      
    </p>
    <pre>
      <code>
    {"id": "6d25d646-11fc-44c3-b74d-29b3d5c94920", "valid": true}
      </code>
    </pre>
    <p>
      In this case we didn't just use <em>createSession</em> as method name, but <em>createSession(Integer)</em> though with parentheses escaped to not confuse the shell. This is because there is 2 variants of createSession: createSession(String, Integer) and createSession(Integer). If we don't specify clearly we might get the wrong one and in this case that happens and will fail due to missing second parameter. Also note the <em>params=5</em>. On get we cannot pass any data on the stream to the service, we can only pass parameters on the URL which is done by specifying url parameter <em>params</em> with a colon (:) separated list of parameters as value. In this case only String and primitives are supported for parameters.      
    </p>
    <p>
      Assume that APSSessionService.createSession where annotated with <strong>@APSWebService(path="session/create")</strong> to give a service method a nicer path, then the call would look like this:      
    </p>
    <pre>
      <code>
    curl --get http://loclahost:8080/apsrpc/JSONREST/1.0/session/create=params=5
      </code>
    </pre>
    <p>
      These examples only works if you have disabled the <em>requireAuthentication</em> configuration (network/rpc-http-transport).      
    </p>
    <H2>See also</H2>
    <p>
      Se the documentation for <em>APSExtProtocolHTTPTransportProvider</em> for an HTTP transport through which these protocols can be used.      
    </p>
    <p>
      Se the documentation for <em>APSExternalProtocolExtender</em> for a description of how services are made available and what services it provides for transport providers.      
    </p>
  </body>
</html>
