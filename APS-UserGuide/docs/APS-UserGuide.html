<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generated-by" content="MarkdownDoc"/>
    <link href="docs.css" type="text/css" rel="stylesheet"/>
  </head>
  <body>
    <H1>Application Platform Services (APS)</H1>
    <p>
      OSGi Application Platform Services - A "smorgasbord" of OSGi services that focuses on ease of use and good enough functionality for many but wont fit all. It can be seen as osgi-ee-light-and-easy. The services are of platform type: configuration, database, JPA, etc, with companion web applications for administration.      
    </p>
    <p>
      All services that require some form of administration have an admin web application for that, that plugs into the general apsadminweb admin web application.      
    </p>
    <p>
      All administrations web applications are WABs and thus require that the OSGi server supports WABs.      
    </p>
    <p>
      Another point of APS is to be as OSGi server independent as possible, but as said above the admin web applications do need support for WABs.      
    </p>
    <p>
      APS is made using basic OSGi functionality and is not using blueprint and other fancy stuff! Each bundle has an activator that does setup, creates trackers, loggers, and manually dependency injects them into the service providers it publishes.      
    </p>
    <H2>Features</H2>
    <H3>Current</H3>
    <ul>
      <li>
        <p>
           A configuration service that works with annotated configuration models where each config value can be described/documented. The configuration model can be structured with sub models that there can be one or many of. Each top level configuration model registered with the configuration service will be available for publishing in the admin web. The configuration service also supports different configuration environments and allows for configuration values to be different for different configuration environments, but doesn´t require them to be.          
        </p>
      </li>
      <li>
        <p>
           Synchronization of configurations across servers. There is currently 2 implementations for this, one that syncs using APSGroups service, one that syncs using RabbitMQ, and one that syncs via Hazelcast.          
        </p>
      </li>
      <li>
        <p>
           A filesystem service that provides a persistent filesystem outside of the OSGi server. The configuration service makes use of this to store configurations. Each client can get its own filesystem area, and can´t access anything outside of its area.          
        </p>
      </li>
      <li>
        <p>
           A platform service that simply identifies the local installation and provides a description of it. It is basically a read only service that provides configured information about the installation.          
        </p>
      </li>
      <li>
        <p>
           A JPA service that is easier and more clearly defined than the osgi-ee JPA API, and allows for multiple JPA contexts. It works as an extender picking up persistence.xml whose defined persistence unit name can then be looked up using the service. A client can only lookup its own persistence units. It is based on OpenJPA.          
        </p>
      </li>
      <li>
        <p>
           A data source service. Only provides connection information, no pooling (OpenJPA provides its own pooling)!          
        </p>
      </li>
      <li>
        <p>
           External protocol extender that allows more or less any OSGi service to be called remotely using any deployed protocol service and transport. Currently provides JSONRPC 1.0 &amp; 2.0, JSONHTTP, and JSONREST protocols, and an http transport. Protocols have a defined service API whose implementations can just be dropped in to make them available. Transport providers can make use of any deployed protocol. The APSExternalProtocolService now provides support for REST services where there is a method for post, put, get,and delete, and the http transport makes use of this in conjunction with any protocol that indicates it can support REST like JSONREST.          
        </p>
      </li>
      <li>
        <p>
           A group service that can send data to each member over transport safe multicast.          
        </p>
      </li>
      <li>
        <p>
           A service discovery service using the group service.          
        </p>
      </li>
      <li>
        <p>
           A session service (not http!). This is used by apsadminweb to keep a session among several different administration web applications.          
        </p>
      </li>
      <li>
        <p>
           An administration web service to which administration web applications can register themselves with an url and thus be available in the .../apsadminweb admin gui.          
        </p>
      </li>
      <li>
        <p>
           A user service. Provides basic user management including roles/groups. Is accompanied with a admin GUI (plugnis into apsadminweb) for administration of users. (org.osgi.service.useradmin.UserAdmin felt uncomplete. It did not provide what I wanted).          
        </p>
      </li>
      <li>
        <p>
           A user authentication service. This does nothing more that authenticating a user and have a really simple API. APS provides an implementation that makes use of the user service, but it is easy to make another implementation that authenticates against an LDAP for example or something else. The Admin web applications uses the authentication service for authenticating admin users.          
        </p>
      </li>
      <li>
        <p>
           A far better service tracker that does a better job at handling services coming and going. Supports service availability wait and timeout and can be wrapped as a proxy to the service. Instead of returning null it throws an exception if no service becomes available within the timeout, and is thus much easier to handle.          
        </p>
      </li>
    </ul>
    <H3>Planned</H3>
    <ul>
      <li>
        <p>
           An implementation of the standard OSGi LogService since not all servers provide one.          
        </p>
      </li>
      <li>
        <p>
           A log veiwer web application supporting reqular expression filters on log information and a live log view. This is waiting on Vaadin 7.1 which will support server push. Another alternative is to go pure GWT and use Errai for this, but I rather continue with Vaadin having all admin webs looking and feeling the same.          
        </p>
      </li>
      <li>
        <p>
           Anything else relevant I come up with and consider fun to do :-).          
        </p>
      </li>
    </ul>
    <H3>Ideas</H3>
    <ul>
      <li>
        <p>
           A JCR (Java Content Repository) service and a content publishing GUI (following the general APS ambition - reasonable functionality and flexibility, ease of use. Will fit many, but not everyone).          
        </p>
      </li>
      <li>
        <p>
           Support for being able to redeploy a web application and services live without loosing session nor user transactions. With OSGi it should be teoretically possible. For a limited number of redeployments at least. It is very easy to run into the "perm gen space" problem, but according to Frank Kieviet (<a href='http://frankkieviet.blogspot.se/2006/10/classloader-leaks-dreaded-permgen-space.html' title=''>Classloader leaks: The dreaded permgen space</a>) it is caused by bad code and can be avoided.          
        </p>
      </li>
    </ul>
    <H3>What is new in </H3>
    <H4>1.0.0</H4>
    <ul>
      <li>
        <p>
           Bug fix in APSConfigService that was forced to make it non backwards compatible to fix. Sorry for that! Using the APSConfigService work exactly as before, but editing config have changed. <strong>The big catch however is that the keys in the configuration files have changed and thus old saved configurations no longer work!</strong> I had no choice. The old keys where part of the problem. I admit that I did something very stupid in the first version and that I should have known better, and in the end I had no other choice than to fix it, which came as no surprice!          
        </p>
      </li>
      <li>
        <p>
           Added Hazelcast support with APS Hazelcast configuration service.          
        </p>
      </li>
      <li>
        <p>
                    
        </p>
      </li>
    </ul>
    <H4>0.10.0</H4>
    <p>
      Added syncrhonization services and made config synchronizable.      
    </p>
    <H4>0.9.2</H4>
    <ul>
      <li>
        <p>
           Small bug fixes.          
        </p>
      </li>
      <li>
        <p>
           APSActivator has been added to aps-tools-lib and can be used as bundle activator. It uses annotations to register services and inject tracked services and other things.          
        </p>
      </li>
      <li>
        <p>
           A service can now be registered with an <em>aps-externalizable</em> property with value <em>true</em> to be made externally available by aps-external-protocol-extender.          
        </p>
      </li>
    </ul>
    <H4>0.9.1</H4>
    <ul>
      <li>
        <p>
           Now have full REST support in aps-external-protocol-extender and aps-ext-protocol-http-transport-provider.          
        </p>
      </li>
      <li>
        <p>
           Documentation have been cleaned up a bit.          
        </p>
      </li>
    </ul>
    <H2>Requirements</H2>
    <p>
      The administration web application(s) are currently WABs and thus require a server supporting WAB deployments. I have developed/tested this on Glassfish and Virgo. I am however considering seeing if it is possible to also support both Glassfish and JBoss JEE WAR to OSGi bridges. They are unfortunately very server specific since there are no such standard. Other than that all services are basic OSGi services and should theoretically run in any R4 compatible OSGi server.      
    </p>
    <H2>Pre Setup</H2>
    <p>
      The Filesystem service is part of the core and used by other services. It should preferably have its filesystem root outside of the server installation. The BundleContext.getDataFile(String) returns a path within the deploy cache and is only valid for as long a a bundle is deployed. The point with the FilesystemService is to have a more permanent filesystem outside of the application server installation. To provide the FilesystemService root the following system property have to be set and available in the JVM instance:      
    </p>
    <pre>
      <code>
        aps.filesystem.root=&lt;root&gt;
      </code>
    </pre>
    <p>
      How to do this differs between servers. In Glassfish you can supply system properties with its admin gui.      
    </p>
    <p>
      If this system property is not set the default root will be BundleContext.getFile(). This can work for development setup, but not for more serious installations!      
    </p>
    <p>
      After this path has been setup and the server started, all other configuration can be done in http://.../apsadminweb/.      
    </p>
    <p>
      <strong>Please note</strong> that the /apsadminweb by default require no login! This so that <em>"Configurations tab,</em><em> Configurations/persistence/datasources"</em> can be used to setup a datasource called "APSSimpleUserServiceDS" needed by APSSimpleUserService. If you use the provided APSAuthService implementation that uses APSSimpleUserService then you need to configure this datasource before APSSimpleUserService can be used. See the documentation for APSSimpleUserService further down in this document for more information on the datasource configuration. After that is setup go to <em>"Configurations tab,</em><em> Configurations/aps/adminweb"</em> and enable the "requireauthentication" config. After having enabled this and saved, do a browser refresh and then provide userid and password when prompted.      
    </p>
    <H2>Javadoc</H2>
    <p>
      The complete javadoc for all services can be found at <a href='http://apidoc.natusoft.se/APS' title=''>http://apidoc.natusoft.se/APS</a>.      
    </p>
    <H1>APSFilesystemService</H1>
    <p>
      This provides a filesystem for writing and reading files. This filesystem resides outside of the OSGi server and is for longterm storage, which differs from BundleContext.getDataFile() which resides within bundle deployment. The APSFilesystemService also does not return a File object! It priovides a file area for each unique owner name that is accessed through an API that cannot navigate nor access any files outside of this area. The ”owner” name should be either an application name or a bundle name if it is only used by one bundle.      
    </p>
    <p>
      The APSConfigService uses the APSFilesystemService to store its configurations.      
    </p>
    <H2>Setup</H2>
    <p>
      The <em>aps.filesystem.root</em> system property must be set to point to a root where this service provides its file areas. This is either passed to the JVM at server startup or configured withing the server. Glassfish allows you to configure properties within its admin gui. Virgo does not. If this is not provided the service will use BundleContext.getDataFile(".") as the root, which will work for testing and playing around, but should not be used for more serious purposes since this is not a path with a long term availability.      
    </p>
    <H2>The service</H2>
    <p>
      The service allows you to create or get an APSFilesystem object. From that object you can create/read/delete directories (represented by APSDirectory) and files (represented by APSFile). You can get readers, writers, input streams and output streams from files. All paths are relative to the file area represented by the APSFilesystem object.      
    </p>
    <p>
      The javadoc for the <a href='http://apidoc.natusoft.se/APS/se/natusoft/osgi/aps/api/core/filesystem/service/APSFilesystemService.html' title=''>APSFilesystemService</a>.      
    </p>
    <H2>The APIs for this service</H2>
    <p>
      public <em>interface</em> <strong>APSDirectory </strong> extends  APSFile    [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <p>
      This represents a directory in an <em>APSFilesystem</em>.      
    </p>
    <p>
      Use this to create or get directories and files and list contents of directories.      
    </p>
    <p>
      Personal comment: I do prefer the term "folder" over "directory" since I think that is less ambiguous, but since Java uses the term "directory" I decided to stick with that name.      
    </p>
    <p>
      <strong>APSDirectory createDir(String name) throws IOException</strong>      
    </p>
    <p>
      Returns a newly created directory with the specified name.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the directory to create.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory createDir(String name, String duplicateMessage) throws IOException</strong>      
    </p>
    <p>
      Returns a newly created directory with the specified name.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the directory to create.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>duplicateMessage</em> - The exception messaging if directory already exists.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile createFile(String name) throws IOException</strong>      
    </p>
    <p>
      Creates a new file in the directory represented by the current <em>APSDirectory</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the file to create.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getDir(String dirname) throws FileNotFoundException</strong>      
    </p>
    <p>
      Returns the specified directory.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>dirname</em> - The name of the directory to enter.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>FileNotFoundException</em>        
      </p>
    </blockquote>
    <p>
      <strong>APSFile getFile(String name)</strong>      
    </p>
    <p>
      Returns the named file in this directory.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the file to get.         
      </p>
    </blockquote>
    <p>
      <strong>void recursiveDelete() throws IOException</strong>      
    </p>
    <p>
      Performs a recursive delete of the directory represented by this <em>APSDirectory</em> and all subdirectories and files.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>String[] list()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.list()        
      </p>
    </blockquote>
    <p>
      <strong>APSFile[] listFiles()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.listFiles()        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFile </strong>   [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <p>
      This represents a file in an <em>APSFilesystemService</em> provided filesystem. It provides most of the API of <em>java.io.File</em> but is not a <em>java.io.File</em>! It never discloses the full path in the host filesystem, only paths relative to its <em>APSFilesystem</em> root.      
    </p>
    <p>
      Use the createInputStream/OutputStream/Reader/Writer to read and write the file.      
    </p>
    <p>
      <strong>InputStream createInputStream() throws IOException</strong>      
    </p>
    <p>
      Creates a new <em>InputStream</em> to this file.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>OutputStream createOutputStream() throws IOException</strong>      
    </p>
    <p>
      Creates a new <em>OutputStream</em> to this file.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Reader createReader() throws IOException</strong>      
    </p>
    <p>
      Creates a new <em>Reader</em> to this file.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Writer createWriter() throws IOException</strong>      
    </p>
    <p>
      Creates a new <em>Writer</em> to this file.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Properties loadProperties() throws IOException</strong>      
    </p>
    <p>
      If this file denotes a properties file it is loaded and returned.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure or if it is not a properties file.         
      </p>
    </blockquote>
    <p>
      <strong>void saveProperties(Properties properties) throws IOException</strong>      
    </p>
    <p>
      If this file denotes a properties file it is written with the specified properties.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>properties</em> - The properties to save.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure or if it is not a properties file.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory toDirectory()</strong>      
    </p>
    <p>
      If this <em>APSFile</em> represents a directory an <em>APSDirectory</em> instance will be returned. Otherwise <em>null</em> will be returned.      
    </p>
    <p>
      <strong>APSFile getAbsoluteFile()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getAbsoluteFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getAbsolutePath()</strong>      
    </p>
    <p>
      Returns the absolute path relative to filesystem root.      
    </p>
    <p>
      <strong>APSFile getCanonicalFile() throws IOException</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getCanonicalFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getCanonicalPath() throws IOException</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getCanonicalPath()        
      </p>
    </blockquote>
    <p>
      <strong>String getParent()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getParent()        
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getParentFile()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getParentFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getPath()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getPath()        
      </p>
    </blockquote>
    <p>
      <strong>boolean renameTo(APSFile dest)</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.renameTo(File)        
      </p>
    </blockquote>
    <p>
      <strong>String getName()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getName()        
      </p>
    </blockquote>
    <p>
      <strong>boolean canRead()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.canRead()        
      </p>
    </blockquote>
    <p>
      <strong>boolean canWrite()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.canWrite()        
      </p>
    </blockquote>
    <p>
      <strong>boolean exists()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.exists()        
      </p>
    </blockquote>
    <p>
      <strong>boolean exists(String name)</strong>      
    </p>
    <p>
      Checks if the named file/directory exists.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true or false.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name to check.         
      </p>
    </blockquote>
    <p>
      <strong>boolean isDirectory()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isDirectory()        
      </p>
    </blockquote>
    <p>
      <strong>boolean isFile()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isFile()        
      </p>
    </blockquote>
    <p>
      <strong>boolean isHidden()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isHidden()        
      </p>
    </blockquote>
    <p>
      <strong>long lastModified()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.lastModified()        
      </p>
    </blockquote>
    <p>
      <strong>long length()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.length()        
      </p>
    </blockquote>
    <p>
      <strong>boolean createNewFile() throws IOException</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.createNewFile()        
      </p>
    </blockquote>
    <p>
      <strong>boolean delete()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.delete()        
      </p>
    </blockquote>
    <p>
      <strong>void deleteOnExit()</strong>      
    </p>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.deleteOnExit()        
      </p>
    </blockquote>
    <p>
      <strong>String toString()</strong>      
    </p>
    <p>
      Returns a string representation of this <em>APSFile</em>.      
    </p>
    <p>
      <strong>File toFile()</strong>      
    </p>
    <p>
      This API tries to hide the real path and don't allow access outside of its root, but sometimes you just need the real path to pass on to other code requiring it. This provides that. Use it only when needed!      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A File object representing the real/full path to this file.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFilesystem </strong>   [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <p>
      This represents an <em>APSFilesystemService</em> filesystem.      
    </p>
    <p>
      <strong>APSDirectory getDirectory(String path) throws IOException</strong>      
    </p>
    <p>
      Returns a folder at the specified path.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>path</em> - The path of the folder to get.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure, specifically if the specified path is not a folder or doesn't exist.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile getFile(String path)</strong>      
    </p>
    <p>
      Returns the file or folder of the specified path.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>path</em> - The path of the file.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getRootDirectory()</strong>      
    </p>
    <p>
      Returns the root directory.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFilesystemService </strong>   [se.natusoft.osgi.aps.api.core.filesystem.service] {      
    </p>
    <p>
      This provides a filesystem for use by services/applications. Each filesystem has its own root that cannot be navigated outside of.      
    </p>
    <p>
      Services or application using this should do something like this in their activators:      
    </p>
    <pre>
      <code>
    APSFilesystemService fss;
    APSFilesystem fs;
    
    if (fss.hasFilesystem("my.file.system")) {
        fs = fss.getFilsystem("my.file.system");
    }
    else {
        fs = fss.createFilesystem("my.file.system");
    }
      </code>
    </pre>
    <p>
            
    </p>
    <p>
      <strong>APSFilesystem createFilesystem(String owner) throws IOException</strong>      
    </p>
    <p>
      Creates a new filesystem for use by an application or service. Where on disk this filesystem resides is irrelevant. It is accessed using the "owner", and will exist until it is removed.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem or rather a unique identifier of it. Consider using application or service package.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure. An already existing filesystem for the "owner" will cause this exception.         
      </p>
    </blockquote>
    <p>
      <strong>boolean hasFilesystem(String owner)</strong>      
    </p>
    <p>
      Returns true if the specified owner has a filesystem.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem or rather a unique identifier of it.         
      </p>
    </blockquote>
    <p>
      <strong>APSFilesystem getFilesystem(String owner) throws IOException</strong>      
    </p>
    <p>
      Returns the filesystem for the specified owner.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem or rather a unique identifier of it.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>void deleteFilesystem(String owner) throws IOException</strong>      
    </p>
    <p>
      Removes the filesystem and all files in it.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem to delete.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSPlatformService</H1>
    <p>
      This is a trivial little service that just returns meta data about the specific platform installation.      
    </p>
    <p>
      The returned information is configured in the <em>/apsadminweb</em>.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>class</em> <strong>PlatformDescription </strong>   [se.natusoft.osgi.aps.api.core.platform.model] {      
    </p>
    <p>
      This model provides information about a platform installation.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public PlatformDescription()</strong>      
    </p>
    <p>
      Creates a new PlatformDescription.      
    </p>
    <p>
      <strong>public PlatformDescription(String identifier, String type, String description)</strong>      
    </p>
    <p>
      Creates a new PlatformDescription.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>identifier</em> - An identifying name for the platform.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>type</em> - The type of the platform, for example "Development", "SystemTest".         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>description</em> - A short description of the platform instance.         
      </p>
    </blockquote>
    <p>
      <strong>public String getIdentifier()</strong>      
    </p>
    <p>
      Returns the platform identifier.      
    </p>
    <p>
      <strong>public String getType()</strong>      
    </p>
    <p>
      Returns the type of the platform.      
    </p>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <p>
      Returns the description of the platform.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSPlatformService </strong>   [se.natusoft.osgi.aps.api.core.platform.service] {      
    </p>
    <p>
      Provides information about the platform instance.      
    </p>
    <p>
      <strong>public PlatformDescription getPlatformDescription()</strong>      
    </p>
    <p>
      Returns a description of the platform instance / installation.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJSONLib</H1>
    <p>
      This is a library (exports all its packages and provides no service) for reading and writing JSON. It can also write a JavaBean object as JSON and take a JSON value or inputstream containing JSON and produce a JavaBean.      
    </p>
    <p>
      This basically provides a class representing each JSON type: JSONObject, JSONString, JSONNumber, JSONBoolean, JSONArray, JSONNull, and a JSONValue class that is the common base class for all the other. Each class knows how to read and write the JSON type it represents. Then there is a JavaToJSON and a JSONToJava class with static methods for converting back and forth. This mapping is very primitive. There has to be one to one between the JSON and the Java objects.      
    </p>
    <H2>Changes</H2>
    <H3>0.10.0</H3>
    <p>
      <em>readJSON(...)</em> in the <strong>JSONValue</strong> base class now throws JSONEOFException (extends IOException) on EOF. The reason for this is that internally it reads characters which cannot return -1 or any non JSON data valid char to represent EOF. Yes, it would be possible to replace <em>char</em> with <em>Character</em>, but that will have a greater effect on existing code using this lib. If an JSONEOFException comes and is not handled it is still very much more clear what happened than a NullPointerException would be!      
    </p>
    <H2>APIs</H2>
    <p>
      Complete javadocs can be found at <a href='http://apidoc.natusoft.se/APSJSONLib/' title=''>http://apidoc.natusoft.se/APSJSONLib/</a>.      
    </p>
    <p>
      public <em>class</em> <strong>JSON </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <p>
      This is the official API for reading and writing JSON values.      
    </p>
    <p>
      <strong>public static JSONValue read(InputStream jsonIn, JSONErrorHandler errorHandler) throws IOException</strong>      
    </p>
    <p>
      Reads any JSON object from the specified <em>InputStream</em>.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONValue subclass. Which depends on what was found on the stream.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonIn</em> - The InputStream to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>errorHandler</em> - An implementation of this interface should be supplied by the user to handle any errors during JSON parsing.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any IO failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static void write(OutputStream jsonOut, JSONValue value) throws APSIOException</strong>      
    </p>
    <p>
      Writes a <em>JSONValue</em> to an <em>OutputStream</em>. This will write compact output by default.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonOut</em> - The OutputStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to write.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static void write(OutputStream jsonOut, JSONValue value, boolean compact) throws APSIOException</strong>      
    </p>
    <p>
      Writes a <em>JSONValue</em> to an <em>OutputStream</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonOut</em> - The OutputStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to write.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true the written JSON is made very compact and hard to read but produce less data.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO problems.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONArrayProvider()</strong>      
    </p>
    <p>
      Creates a new JSONArray for wrinting JSON output.      
    </p>
    <p>
      <strong>public JSONArrayProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONArray for reading JSON input and writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handler to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void addValue(JSONValueProvider value)</strong>      
    </p>
    <p>
      Adds a value to the array.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value to add.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public List&lt;se.natusoft.osgi.aps.api.misc.json.model.JSONValue&gt; getAsList()</strong>      
    </p>
    <p>
      Returns the array values as a List.      
    </p>
    <p>
      <strong>public &lt;T extends se.natusoft.osgi.aps.api.misc.json.model.JSONValue&gt; List&lt;T&gt; getAsList(Class&lt;T&gt; type)</strong>      
    </p>
    <p>
      Returns the array values as a list of a specific type.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A list of specified type if type is the same as in the list.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>type</em> - The class of the type to return values as a list of.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>&lt;T&gt;</em> - One of the JSONValue subclasses.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONBooleanProvider(boolean value)</strong>      
    </p>
    <p>
      Creates a new JSONBoolean instance for writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value for this boolean.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONBooleanProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONBoolean instance for reading JSON input or writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handler to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setBooleanValue(boolean value)</strong>      
    </p>
    <p>
      Sets the value of this boolean.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value to set.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean getAsBoolean()</strong>      
    </p>
    <p>
      Returns the value of this boolean.      
    </p>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <p>
      Returns the value of this boolean as a String.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONNullProvider()</strong>      
    </p>
    <p>
      Creates a new JSONNull instance for writing JSON output.      
    </p>
    <p>
      <strong>public JSONNullProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONNull instance for reading JSON input or writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handler to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        as String.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONNumberProvider(Number value)</strong>      
    </p>
    <p>
      Creates a new JSONNumber instance for writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The numeric value.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONNumberProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONNumber instance for reading JSON input or writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handle to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public Number toNumber()</strong>      
    </p>
    <p>
      Returns the number as a Number.      
    </p>
    <p>
            
    </p>
    <p>
      <strong>public float toFloat()</strong>      
    </p>
    <p>
      Returns the number as a float value.      
    </p>
    <p>
      <strong>public int toInt()</strong>      
    </p>
    <p>
      Returns the number as an int value.      
    </p>
    <p>
      <strong>public long toLong()</strong>      
    </p>
    <p>
      Returns the number as a long value.      
    </p>
    <p>
      <strong>public short toShort()</strong>      
    </p>
    <p>
      Returns the number as a short value.      
    </p>
    <p>
      <strong>public byte toByte()</strong>      
    </p>
    <p>
      Returns the number as a byte value.      
    </p>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        number as String.        
      </p>
    </blockquote>
    <p>
      <strong>public Object to(Class type)</strong>      
    </p>
    <p>
      Returns the number as a value of the type specified by the type parameter.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>type</em> - The type of the returned number.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONObjectProvider()</strong>      
    </p>
    <p>
      Creates a JSONObject instance for writing JSON output.      
    </p>
    <p>
      <strong>public JSONObjectProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONObject instance for reading JSON input or writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handler to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void addValue(se.natusoft.osgi.aps.api.misc.json.model.JSONString name, JSONValueProvider value)</strong>      
    </p>
    <p>
      Adds a property to this JSONObject instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The property value.         
      </p>
    </blockquote>
    <p>
      <strong>public void addValue(String name, se.natusoft.osgi.aps.api.misc.json.model.JSONValue value)</strong>      
    </p>
    <p>
      Adds a property to this JSONObject instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The property value.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public JSONStringProvider(String value)</strong>      
    </p>
    <p>
      Creates a new JSONString for writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value of this JSONString.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONStringProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONString for reading JSON input and writing JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handler to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected JSONValueProvider()</strong>      
    </p>
    <p>
      Creates a new JSONValue.      
    </p>
    <p>
      <strong>protected JSONValueProvider(JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONValue      
    </p>
    <p>
      <strong>protected abstract void readJSON(char c, JSONReader reader) throws APSIOException</strong>      
    </p>
    <p>
      This will read the vale from an input stream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The first character already read from the input stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>reader</em> - The reader to read from.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>protected abstract void writeJSON(JSONWriter writer, boolean compact) throws APSIOException</strong>      
    </p>
    <p>
      This will write the data held by this JSON value in JSON format on the specified stream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>writer</em> - A JSONWriter instance to write with.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true write the JSON as compact as possible. false means readable, indented.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - On IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>protected JSONErrorHandler getErrorHandler()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The user supplied error handler.        
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Reads and resolves what JSON type is the next in the input and returns it.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The read JSONValue.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The first already read character.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>reader</em> - The reader to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user supplied error handler.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IOFailure.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected void fail(String message, Throwable cause)</strong>      
    </p>
    <p>
      Fails the job.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The failure message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - An eventual cause of the failure. Can be null.         
      </p>
    </blockquote>
    <p>
      <strong>protected void fail(String message)</strong>      
    </p>
    <p>
      Fails the job.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The failure message.         
      </p>
    </blockquote>
    <p>
      <strong>public void readJSON(InputStream is) throws APSIOException</strong>      
    </p>
    <p>
      This will read the value from an input stream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>is</em> - The input stream to read from.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>public void writeJSON(OutputStream os) throws APSIOException</strong>      
    </p>
    <p>
      This writes JSON to the specified OutputStream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>os</em> - The outoutStream to write to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>public void writeJSON(OutputStream os, boolean compact) throws APSIOException</strong>      
    </p>
    <p>
      This writes JSON to the specified OutputStream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>os</em> - The outoutStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true write JSON as compact as possible. If false write it readable with indents.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONString instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONNumber instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONNull instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONBoolean instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONArray instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
      <strong>/*package*/</strong>      
    </p>
    <p>
      Method for creating a JSONObject instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The user error handler.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected JSONReader(PushbackReader reader, JSONErrorHandler errorHandler)</strong>      
    </p>
    <p>
      Creates a new JSONReader instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>reader</em> - The PushbackReader to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>errorHandler</em> - The handler for errors.         
      </p>
    </blockquote>
    <p>
      <strong>protected char getChar() throws APSIOException</strong>      
    </p>
    <p>
      Returns the next character on the specified input stream, setting EOF state checkable with isEOF().      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO problems.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      protected <em>static</em> <em>class</em> <strong>JSONWriter </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <p>
      For subclasses to use in writeJSON(JSONWriter writer).      
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected JSONWriter(Writer writer)</strong>      
    </p>
    <p>
      Creates a new JSONWriter instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>writer</em> - The writer to write to.         
      </p>
    </blockquote>
    <p>
      <strong>protected void write(String json) throws APSIOException</strong>      
    </p>
    <p>
      Writes JSON output.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The JSON output to write.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public BeanInstance(Object modelInstance)</strong>      
    </p>
    <p>
      Creates a new ModelInstance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>modelInstance</em> - The model instance to wrap.         
      </p>
    </blockquote>
    <p>
      <strong>public Object getModelInstance()</strong>      
    </p>
    <p>
      Returns the test model instance held by this object.      
    </p>
    <p>
      <strong>public List&lt;String&gt; getSettableProperties()</strong>      
    </p>
    <p>
      Returns a list of settable properties.      
    </p>
    <p>
      <strong>public List&lt;String&gt; getGettableProperties()</strong>      
    </p>
    <p>
      Returns a list of gettable properties.      
    </p>
    <p>
      <strong>public void setProperty(String property, Object value) throws JSONConvertionException</strong>      
    </p>
    <p>
      Sets a property      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The name of the property to set.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to set with.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on any failure to set the property.         
      </p>
    </blockquote>
    <p>
      <strong>public Object getProperty(String property) throws JSONConvertionException</strong>      
    </p>
    <p>
      Returns the value of the specified property.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The property value.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The property to return value of.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on failure (probably bad property name!).         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public Class getPropertyType(String property) throws JSONConvertionException</strong>      
    </p>
    <p>
      Returns the type of the specified property.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The class representing the property type.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The property to get the type for.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - if property does not exist.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
      <strong>public static JSONObjectProvider convertObject(Object javaBean) throws JSONConvertionException</strong>      
    </p>
    <p>
      Converts a JavaBean object into a <em>JSONObject</em>.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONObject containing all values from the JavaBean.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>javaBean</em> - The JavaBean object to convert.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on converting failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONObjectProvider convertObject(JSONObjectProvider jsonObject, Object javaBean) throws JSONConvertionException</strong>      
    </p>
    <p>
      Converts a JavaBean object into a <em>JSONObject</em>.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONObject containing all values from the JavaBean.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonObject</em> - The jsonObject to convert the bean into or null for a new JSONObject.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaBean</em> - The JavaBean object to convert.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on converting failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONValueProvider convertValue(Object value)</strong>      
    </p>
    <p>
      Converts a value from a java value to a <em>JSONValue</em>.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The converted JSONValue.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The java value to convert. It can be one of String, Number, Boolean, null, JavaBean, or an array of those.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONConvertionException </strong> extends  RuntimeException    [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <p>
      This exception is thrown on failure to convert from JSON to Java or Java to JSON.      
    </p>
    <p>
      Almost all exceptions within the APS services and libraries extend either <em>APSException</em> or <em>APSRuntimeException</em>. I decided to just extend RuntimeException here to avoid any other dependencies for this library since it can be useful outside of APS and can be used as any jar if not deployed in OSGi container.      
    </p>
    <p>
      <strong>public JSONConvertionException(final String message)</strong>      
    </p>
    <p>
      Creates a new <em>JSONConvertionException</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message         
      </p>
    </blockquote>
    <p>
      <strong>public JSONConvertionException(final String message, final Throwable cause)</strong>      
    </p>
    <p>
      Creates a new <em>JSONConvertionException</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of this exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONMapConv </strong>   [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <p>
      This converts between a Java Map and JSON. Do note that this of course uses this library to read and write JSON, but this specific public API only deals with Java and JSON as String or on/in a stream. <a href='p/' title=''>p/</a> This class becomes more useful when used from Groovy since the latter provides much nicer usage of data in Maps. Yes, I know about JSONSlurper and JSONBuilder in Groovy. Those however does not work with @CompileStatic. Maps does.      
    </p>
    <p>
      <strong>public static Map&lt;String, Object&gt; jsonObjectToMap(String json) throws APSIOException</strong>      
    </p>
    <p>
      This takes a String containing a JSON object and returns it as a Map.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The JSON content to convert to a Map.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on failure.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public static Map&lt;String, Object&gt; jsonObjectToMap(se.natusoft.osgi.aps.api.misc.json.model.JSONObject jsonObject)</strong>      
    </p>
    <p>
      This takes a JSONObject and returns a Map.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The converted Map.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonObject</em> - The JSONObject to convert to a Map.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public static String mapToJSONObjectString(Map&lt;String, Object&gt; map) throws APSIOException</strong>      
    </p>
    <p>
      This takes a Map (as created by jsonObjectToMap(...)) and returns a JSON String.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>map</em> - The Map to convert to JSON.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on I/O failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static se.natusoft.osgi.aps.api.misc.json.model.JSONObject mapToJSONObject(Map&lt;String, Object&gt; map)</strong>      
    </p>
    <p>
      Converts a <code>Map&lt;String,</code><code> Object&gt;</code> to a JSONObject.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A converted JSONObject.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>map</em> - The Map to convert.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONToJava </strong>   [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <p>
      Creates a JavaBean instance and copies data from a JSON value to it.      
    </p>
    <p>
      The following mappings are made in addition to the expected ones:      
    </p>
    <ul>
      <li>
        <p>
           <em>JSONArray</em> only maps to an array property.          
        </p>
      </li>
      <li>
        <p>
           Date properties in bean are mapped from <em>JSONString</em> "yyyy-MM-dd HH:mm:ss".          
        </p>
      </li>
      <li>
        <p>
           Enum properties in bean are mapped from <em>JSONString</em> which have to contain enum constant name.          
        </p>
      </li>
    </ul>
    <p>
      <strong>public static &lt;T&gt; T convert(InputStream jsonStream, Class&lt;T&gt; javaClass) throws APSIOException, JSONConvertionException</strong>      
    </p>
    <p>
      Returns an instance of a java class populated with data from a json object value read from a stream.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A populated instance of javaClass.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonStream</em> - The stream to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The java class to instantiate and populate.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failures.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On JSON to Java failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static &lt;T&gt; T convert(String json, Class&lt;T&gt; javaClass) throws APSIOException, JSONConvertionException</strong>      
    </p>
    <p>
      Returns an instance of a java class populated with data from a json object value read from a String containing JSON.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A populated instance of javaClass.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The String to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The java class to instantiate and populate.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on IO failures.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On JSON to Java failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static &lt;T&gt; T convert(JSONValue json, Class&lt;T&gt; javaClass) throws JSONConvertionException</strong>      
    </p>
    <p>
      Returns an instance of java class populated with data from json.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A converted Java object.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The json to convert to java.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The class of the java object to convert to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On failure to convert.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>SystemOutErrorHandler </strong> implements  JSONErrorHandler    [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <p>
      A simple implementation of <em>JSONErrorHandler</em> that simply displays messages on System.out and throws a <em>RuntimeException</em> on fail. This is used by the tests. In a non test case another implementation is probably preferred.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSToolsLib</H1>
    <p>
      This is a library of utilities including a service tracker that is far better than the default one, including exception rather than null response on timeout, timeout specification, getting a proxied service implementation that automatically uses the tracker, allocating a service, calling it, and deallocating it again. This makes it trivially easy to handle a service being restarted or redeployed. It also includes a logger utility that will lookup the standard log service and log to that if found, otherwise just log to stdout.      
    </p>
    <p>
      This bundle provides no services. It just makes all its packages public. Every bundle included in APS makes use of APSToolsLib so it must be deployed for things to work.      
    </p>
    <p>
      Please note that this bundle has no dependencies! That is, it can be used as is without requireing any other APS bundle. It however requires APSOSGiTestTools to build, but that is only a test dependency.      
    </p>
    <H2>APSServiceTracker</H2>
    <p>
      This does the same thing as the standard service tracker included with OSGi, but does it better with more options and flexibility. One of the differences between this tracker and the OSGi one is that this throws an <em>APSNoServiceAvailableException</em> if the service is not available. Personally I think this is easier to work with than having to check for a null result. I also think that trying to keep bundles and services up are better than pulling them down as soon as one depencency goes away for a short while, for example due to redeploy of newer version. This is why APSServiceTracker takes a timeout and waits for a service to come back before failing.      
    </p>
    <p>
      <strong>Note:</strong> that in previous version APSServiceTracker did all callbacks in a separate thread. This is no longer the case, and shouldn't have been from the beginning.      
    </p>
    <p>
      There are several variants of constructors, but here is an example of one of the most used ones within the APS services:      
    </p>
    <pre>
      <code>
    APSServiceTracker&lt;Service&gt; tracker =
        new APSServiceTracker&lt;Service&gt;(context, Service.class, "20 seconds");
    tracker.start();
      </code>
    </pre>
    <p>
      Note that the third argument, which is a timeout can also be specified as an int in which case it is always in miliseconds. The string variant supports the a second word of "sec[onds]" and "min[utes]" which indicates the type of the first numeric value. "forever" means just that and requires just one word. Any other second words than those will be treated as milliseconds. The APSServiceTracker also has a set of constants for the timeout string value:      
    </p>
    <pre>
      <code>
    public static final String SHORT_TIMEOUT = "3 seconds";
    public static final String MEDIUM_TIMEOUT = "30 seconds";
    public static final String LARGE_TIMEOUT = "2 minutes";
    public static final String VERY_LARGE_TIMEOUT = "5 minutes";
    public static final String HUGE_LARGE_TIMEOUT = "10 minutes";
    public static final String NO_TIMEOUT = "forever";
      </code>
    </pre>
    <p>
      On bundle stop you should do:      
    </p>
    <pre>
      <code>
    tracker.stop(context);
      </code>
    </pre>
    <p>
      So that the tracker unregisters itself from receiving bundle/service events.      
    </p>
    <H3>Services and active service</H3>
    <p>
      The tracker tracks all instances of the service being tracked. It however have the notion of an active service. The active service is the service instance that will be returned by allocateService() (which is internally used by all other access methods also). On startup the active service will be the first service instance received. It will keep tracking other instances comming in, but as long as the active service does not go away it will be the one used. If the active service goes away then the the one that is at the beginning of the list of the other tracked instances will become active. If that list is empty there will be no active, which will trigger a wait for a service to become available again if allocateService() is called.      
    </p>
    <H3>Providing a logger</H3>
    <p>
      You can provide an APSLogger (see further down about APSLogger) to the tracker:      
    </p>
    <pre>
      <code>
    tracker.setLogger(apsLogger);
      </code>
    </pre>
    <p>
      When available the tracker will log to this.      
    </p>
    <H3>Tracker as a wrapped service</H3>
    <p>
      The tracker can be used as a wrapped service:      
    </p>
    <pre>
      <code>
    Service service = tracker.getWrappedService();
    Service service = tracker.getWrappedService(boolean cacheCallsUntilServiceAvailable);
      </code>
    </pre>
    <p>
      This gives you a proxied <em>service</em> instance that gets the real service, calls it, releases it and return the result. This handles transparently if a service has been restarted or one instance of the service has gone away and another came available. It will wait for the specified timeout for a service to become available and if that does not happen the <em>APSNoServiceAvailableException</em> will be thrown. This is of course a runtime exception which makes the service wrapping possible without loosing the possibility to handle the case where the service is not available.      
    </p>
    <p>
      The <em>cacheCallsUntilServiceAvailable</em> parameter means just that. This makes the service non blocking. Otherwise any call to a method when service is not available will result in a wait() on the thread until a service is available. When this parameter is <code>true</code> however any calls to the service before a service is available will be cached and executed later when a service is available. Do note that the tracker wrapper provides a java.lang.reflect.Proxy implementation of the service interface. Under the surface it will do an <em>invoke</em> on the actual service object and this invoke can be saved for later in a lambda. There is however a big <strong>warning</strong> with this: This feature will obviously only work for methods that don't provide a return value! Since method calls may possible be done in the future they cannot return any value. And no, <em>Future&lt;?&gt;</em> cannot be used since it blocks, and we are trying to avoid blocking here!      
    </p>
    <p>
      If you don't like this, don't use the <em>getWrappedService(true)</em>. The <em>.onActiveServiceAvailable(callback)</em> method can be used to receive the service instance when it is available.      
    </p>
    <H3>Using the tracker in a similar way to the OSGi standard tracker</H3>
    <p>
      To get a service instance you do:      
    </p>
    <pre>
      <code>
    Service service = tracker.allocateService();
      </code>
    </pre>
    <p>
      Note that if the tracker has a timeout set then this call will wait for the service to become available if it is currently not available until an instance becomes available or the timeout time is reached. It will throw <em>APSNoServiceAvailableException</em> on failure in any case.      
    </p>
    <p>
      When done with the service do:      
    </p>
    <pre>
      <code>
    tracker.releaseService();
      </code>
    </pre>
    <H3>Accessing a service by tracker callback</H3>
    <p>
      There are a few variants to get a service instance by callback. When the callbacks are used the actual service instance will only be allocated during the callback and then released again.      
    </p>
    <H4>onServiceAvailable</H4>
    <p>
      This will result in a callback when any instance of the service becomes available. If there is more than one service instance published then there will be a callback for each.      
    </p>
    <pre>
      <code>
        tracker.onServiceAvailable(new OnServiceAvailable&lt;Service&gt;() {
            @Override
            public void onServiceAvailable(
                Service service,
                ServiceReference serviceReference
            ) throws Exception {
                // Do something.
            }
        });
      </code>
    </pre>
    <H4>onServiceLeaving</H4>
    <p>
      This will result in a callback when any instance of the service goes away. If there is more than one service instance published the there will be a callback for each instance leaving.      
    </p>
    <pre>
      <code>
        onServiceLeaving(new OnServiceLeaving&lt;Service&gt;() {
    
            @Override
            public void onServiceLeaving(
                ServiceReference service,
                Class serviceAPI
            ) throws Exception {
                // Handle the service leaving.
            }
        });
      </code>
    </pre>
    <p>
      Note that since the service is already gone by this time you don't get the service instance, only its reference and the class representing its API. In most cases both of these parameters are irellevant.      
    </p>
    <H4>onActiveServiceAvailable</H4>
    <p>
      This does the same thing as onServiceAvailable() but only for the active service. It uses the same <em>OnServiceAvailable</em> interface.      
    </p>
    <H4>onActiveServiceLeaving</H4>
    <p>
      This does the same thing as onServiceLeaving() but for the active service. It uses the same <em>OnServiceLeaving</em> interface.      
    </p>
    <H4>withService</H4>
    <p>
      Runs the specified callback providing it with a service to use. This will wait for a service to become available if a timeout has been provided for the tracker.      
    </p>
    <p>
      Don't use this in an activator start() method! onActiveServiceAvailable() and onActiveServiceLeaving() are safe in a start() method, this is not!      
    </p>
    <pre>
      <code>
        tracker.withService(new WithService&lt;Service&gt;() {
            @Override
            public void withService(
                Service service,
                Object... args
            ) throws Exception {
                // do something here.
            }
        }, arg1, arg2);
      </code>
    </pre>
    <p>
      If you don't have any arguments this will also work:      
    </p>
    <pre>
      <code>
        tracker.withService(new WithService&lt;Service&gt;() {
            @Override
            public void withService(
                Service service
            ) throws Exception {
                // do something here
            }
        });
      </code>
    </pre>
    <H4>withServiceIfAvailable</H4>
    <p>
      This does the same as withService(...) but without waiting for a service to become available. If the service is not available at the time of the call the callback will not be called. No exception is thrown by this!      
    </p>
    <H4>withAllAvailableServices</H4>
    <p>
      This is used exactly the same way as withService(...), but the callback will be done for each tracked service instance, not only the active.      
    </p>
    <H4>onTimeout (since 0.9.3)</H4>
    <p>
      This allows for a callback when the tracker times out waiting for a service. This callback will be called just before the <em>APSNoServiceAvailableException</em> is about to be thrown.      
    </p>
    <pre>
      <code>
    tracker.onTimeout(new OnTimeout() {
        @Override
        public void onTimeout() {
            // do something here
        }
    });
      </code>
    </pre>
    <H2>APSLogger</H2>
    <p>
      This provides logging functionality. The no args constructor will log to System.out by default. The OutputStream constructor will logg to the specified output stream by default.      
    </p>
    <p>
      The APSLogger can be used by just creating an instance and then start using the info(...), error(...), etc methods. But in that case it will only log to System.out or the provided OutputStream. If you however do this:      
    </p>
    <pre>
      <code>
    APSLogger logger = new APSLogger();
    logger.start(context);
      </code>
    </pre>
    <p>
      then the logger will try to get hold of the standard OSGi LogService and if that is available log to that. If the log service is not available it will fallback to the OutputStream.      
    </p>
    <p>
      If you call the <em>setServiceRefrence(serviceRef);</em> method on the logger then information about that service will be provied with each log.      
    </p>
    <H2>APSActivator</H2>
    <p>
      This is a BundleActivator implementation that uses annotations to register services and inject tracked services. Any bundle can use this activator by just importing the <em>se.natusoft.osgi.aps.tools</em> package.      
    </p>
    <p>
      This is actually a rather trivial class that just scans the bundle for classes and inspects all classes for annotations and act on them. Most methods are protected making it easy to subclass this class and expand on its functionality.      
    </p>
    <p>
      <strong>Please note</strong> that it does <em>class.getDeclaredFields()</em> and <em>class.getDeclaredMethods()</em>! This means that it will only see the bottom class of an inheritance hiearchy!      
    </p>
    <p>
      The following annotations are available:      
    </p>
    <p>
      <strong>@OSGiServiceProvider</strong> - This should be specified on a class that implements a service interface and should be registered as an OSGi service. <em>Please note</em> that the first declared implemented interface is used as service interface unless you specify serviceAPIs={Svc.class, ...}.      
    </p>
    <pre>
      <code>
    public @interface OSGiProperty {
        String name();
        String value();
    }
    
    public @interface OSGiServiceInstance {
    
        /** Extra properties to register the service with. */
        OSGiProperty[] properties() default {};
    
        /**
         * The service API to register instance with. If not specified the first
         * implemented interface will be used.
         */
        Class[] serviceAPIs() default {};
    }
    
    public @interface OSGiServiceProvider {
        /** Extra properties to register the service with. */
        OSGiProperty[] properties() default {};
    
        /**
         * The service API to register instance with. If not specified the first
         * implemented interface will be used.
         */
        Class[] serviceAPIs() default {};
    
        /**
         * This can be used as an alternative to properties() and also supports
         * several instances.
         */
        OSGiServiceInstance[] instances() default {};
    
        /**
         * An alternative to providing static information. This class will be
         * instantiated if specified and provideServiceInstancesSetup() will
         * be called to provide implemented service APIs, service properties,
         * and a service instance. In this last, it differs from
         * instanceFactoryClass() since that does not provide an instance.
         * This allows for more easy configuration of each instance.
         */
        Class&lt;? extends APSActivatorServiceSetupProvider&gt;
            serviceSetupProvider()
            default APSActivatorServiceSetupProvider.class;
    
        /**
         * This can be used as an alternative and will instantiate the
         * specified factory class which will deliver one set of
         * Properties per instance.
         */
        Class&lt;? extends APSActivator.InstanceFactory&gt; instanceFactoryClass()
            default APSActivator.InstanceFactory.class;
    
        /**
         * If true this service will be started in a separate thread.
         * This means the bundle start will continue in parallel and
         * that any failures in startup will be logged, but will
         * not stop the bundle from being started. If this is true
         * it wins over required service dependencies of the service
         * class. Specifying this as true allows you to do things that
         * cannot be done in a bunde activator start method, like
         * calling a service tracked by APSServiceTracker, without
         * causing a deadlock.
         */
        boolean threadStart() default false;
    }
      </code>
    </pre>
    <p>
      Do note that for the <em>serviceSetupProvider()</em> another solution is to use the <em>@BundleStart</em> (see below) and just create instances of your service and register them with the BundleContext. But if you use <em>@OSGiServiceProvider</em> to instantiate and register other "one instance" services, then using <em>serviceSetupProvider()</em> would look a bit more consistent.      
    </p>
    <p>
      <strong>@APSExternalizabe</strong>, <strong>@APSRemoteService</strong> - These 2 annotations are synonyms and have no properties. They should be used on a service implementation class. When either of these are specified the "aps-externalizable=true" property will be set when the service is registered with the OSGi container. The APSExternalProtocolExtender will react on this property and make the service externally accessible.      
    </p>
    <p>
      <strong>@OSGiService</strong> - This should be specified on a field having a type of a service interface to have a service of that type injected, and continuously tracked. Any call to the service will throw an APSNoServiceAvailableException (runtime) if no service has become available before the specified timeout. It is also possible to have APSServiceTracker as field type in which case the underlying configured tracker will be injected instead.      
    </p>
    <p>
      If <em>required=true</em> is specified and this field is in a class annotated with <em>@OSGiServiceProvider</em> then the class will not be registered as a service until the service dependency is actually available, and will also be unregistered if the tracker for the service does a timeout waiting for a service to become available. It will then be reregistered again when the dependent service becomes available again. Please note that unlike iPOJO the bundle is never stopped on dependent service unavailability, only the actual service is unregistered as an OSGi service. A bundle might have more than one service registered and when a dependency that is only required by one service goes away the other service is still available.      
    </p>
    <p>
      The non blocking variant of <em>APSServiceTracker.getWrappedService(true)</em> as described above can also be achieved with this annotation by setting <em>nonBlocking = true</em>.      
    </p>
    <pre>
      <code>
    public @interface OSGiService {
    
        /**
         * The timeout for a service to become available. Defaults
         * to 30 seconds.
         */
        String timeout() default "30 seconds";
    
        /**
         * Any additional search criteria. Should start with
         * '(' and end with ')'. Defaults to none.
         */
        String additionalSearchCriteria() default "";
    
        /**
         * This should specify a Class implementing
         * APSActivatorSearchCriteriaProvider. If specified it will
         * be used instead of additionalSearchCriteria() by
         * instantiating the Class and calling its method to get
         * a search criteria back. This allows for search criteria
         * coming from configuration, which a static annotation String
         * does not.
         */
        Class&lt;? extends APSActivatorSearchCriteriaProvider&gt;
            searchCriteriaProvider()
            default APSActivatorSearchCriteriaProvider.class;
    
        /**
         * If set to true the service using this service will not
         * be registered until the service becomes available.
         */
        boolean required() default false;
    
        /**
         * If this is set to true and a proxied implementation of the service is injected rather than the tracker directly
         * then any call made to the proxy will be cached if the service is not available and then later run when the
         * service becomes available. This of course means that methods returning a value will always return null when
         * service is not currently available since the real call will be made in the future. Returning a Future instead
         * in this case does not work since 'Future's are blocking, and we try to avoid blocking here.
         *
         * __YOU HAVE TO BE VERY CAREFUL WHEN SETTING THIS TO TRUE! NO CALLS RETURNING A VALUE!__
         *
         * The point of this is to be non blocking. By default with a proxied implementation tracker.allocateService() will
         * be called, and this blocks waiting for the service to become available if it is not.
         *
         * @return true or false (default).
         */
        boolean nonBlocking() default false;
    }
      </code>
    </pre>
    <p>
      <strong>@Managed</strong> - This will have an instance managed and injected. There will be a unique instance for each name specified with the default name of "default" being used if none is specified. There are 2 field types handled specially: BundleContext and APSLogger. A BundleContext field will get the bundles context injected. For an APSLogger instance the 'loggingFor' annotation property can be specified. Please note that any other type must have a default constructor to be instantiated and injected!      
    </p>
    <pre>
      <code>
    public @interface Managed {
    
        /**
         * The name of the instance to inject. If the same is used
         * in multiple classes the same instance will be injected.
         */
        String name() default "default";
    
        /**
         * A label indicating who is logging. If not specified the
         * bundle name will be used. This is only
         * relevant if the injected type is APSLogger.
         */
        String loggingFor() default "";
    }
      </code>
    </pre>
    <p>
      <strong>@ExecutorSvc</strong> - This should always be used in conjunction with @Managed! This also assumes that the annotated field is of type ExecutorService or ScheduledExecutorService. This annotation provides some configuration for the ExecutorService that will be injected.      
    </p>
    <pre>
      <code>
    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.FIELD)
    public @interface ExecutorSvc {
    
        enum ExecutorType {
            FixedSize,
            WorkStealing,
            Single,
            Cached,
            Scheduled,
            SingleScheduled
        }
    
        /** This is loosely the number of concurrent threads. */
        int parallelism() default 10;
    
        /** The type of ExecutorService wanted. */
        ExecutorType type() default ExecutorType.FixedSize;
    
        /** If true the created ExecutorService will be wrapped with a delegate that disallows configuration. */
        boolean unConfigurable() default false;
    }
      </code>
    </pre>
    <p>
      <strong>@Schedule</strong> - Schedules a Runnable using a ScheduledExecutionService. Indifferent from @ExecutorSvc this does not require an @Managed also, but do work with @Managed if that is used to inject an instance of Runnable to be scheduled. @Schedule is handled after all injections have been done.      
    </p>
    <pre>
      <code>
    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.FIELD)
    public @interface Schedule {
    
        /**
         * The defined executor service to schedule this on. This should be the name of it. If left blank an internal
         * ScheduledExecutorService will be used.
         */
        String on() default "";
    
        /** The amount of time to wait for the (first) execution. */
        long delay();
    
        /** If specified how long to wait between runs. */
        long repeat();
    
        /** The time unit used for the above values. Defaults to seconds. */
        TimeUnit timeUnit() default TimeUnit.SECONDS;
    
        /** Possibility to affect the size of the thread pool when such is created internally for this (on="..." not provided!). */
        int poolSize() default 2;
    }
      </code>
    </pre>
    <p>
      <strong>@BundleStart</strong> - This should be used on a method and will be called on bundle start. The method should take no arguments. If you need a BundleContext just inject it with <em>@Managed</em>. The use of this annotation is only needed for things not supported by this activator. Please note that a method annotated with this annotation can be static (in which case the class it belongs to will not be instantiaded). You can provide this annotation on as many methods in as many classes as you want. They will all be called (in the order classes are discovered in the bundle).      
    </p>
    <pre>
      <code>
    public @interface BundleStart {
    
        /**
         * If true the start method will run in a new thread.
         * Any failures in this case will not fail
         * the bundle startup, but will be logged.
         */
        boolean thread() default false;
    }
      </code>
    </pre>
    <p>
      <strong>@BundleStop</strong> - This should be used on a method and will be called on bundle stop. The method should take no arguments. This should probably be used if <em>@BundleStart</em> is used. Please note that a method annotated with this annotation can be static!      
    </p>
    <pre>
      <code>
    public @interface BundleStop {}
      </code>
    </pre>
    <H3>Usage as BundleActivator</H3>
    <p>
      The <em>APSActivator</em> class has 2 constructors. The default constructor without arguments are used for BundleActivator usage. In this case you just specify this class as your bundles activator, and then use the annotations described above. Thats it!      
    </p>
    <H3>Other Usage</H3>
    <p>
      Since the activator usage will manage and create instances of all annotated classes this will not always work in all situations. One example is web applications where the web container is responsible for creating servlets. If you specifiy APSActivator as an activator for a WAB bundle and then use the annotations in a servlet then APSActivator will have a managed instance of the servlet, but it will not be the same instance as the web contatiner will run.      
    </p>
    <p>
      Therefore APSActivator has another constructor that takes a vararg of instances: <code>public APSActivator(Object...</code><code> instances)</code>. There is also a <code>public void addManagedInstance(Object instance)</code> method. These allow you to add an already existing instance to be managed by APSActivator. In addition to the provided existing instances it will still scan the bundle for classes to manage. It will however not double manage any class for which an existing instance of has already been provided. Any annotated class for which existing instances has not been provided will be instantiated by APSActivator.      
    </p>
    <p>
      <strong>Please note</strong> that if you create an instance of APSActivator in a servlet and provide the servlet instance to it and start it (you still need to do <em>start(BundleContext)</em> and <em>stop(BundleContext)</em> when used this way!), then you need to catch the close of the servlet and do <em>stop</em> then.      
    </p>
    <p>
      There are 2 support classes:      
    </p>
    <ul>
      <li>
        <p>
           [APSVaadinWebTools]: APSVaadinOSGiApplication - This is subclassed by your Vaading application.          
        </p>
      </li>
      <li>
        <p>
           [APSWebTools]: APSOSGiSupport - You create an instance of this in a servlet and let your servlet implement the <em>APSOSGiSupportCallbacks</em> interface which is then passed to the constructor of APSOSGiSupport.          
        </p>
      </li>
    </ul>
    <p>
      Both of these creates and manages an APSActivator internally and catches shutdown to take it down. They also provide other utilities like providing the BundleContext. See <em>APSWebTools</em> for more information.      
    </p>
    <H3>APSActivatorPlugin</H3>
    <p>
      Any implementing classes of this interface can be specified in META-INF/services/se.natusoft.osgi.aps.tools.APSActivatorPlugin file, one per line. These are loaded by java.util.ServiceLoader. The implementation can be provided by another bundle which should then export the relevant packages which can then be imported in the using bundle.      
    </p>
    <p>
      The APSActivatorPlugin API looks like this:      
    </p>
    <pre>
      <code>
    public interface APSActivatorPlugin {
    
        interface ActivatorInteraction {
            void addManagedInstance(Object instance, Class forClass);
        }
    
        void analyseBundleClass(ActivatorInteraction activatorInteraction, Class bundleClass);
    }
      </code>
    </pre>
    <p>
      <strong>Be warned</strong> that this is currently very untested! No APS code uses this yet.      
    </p>
    <H2>APSContextWrapper</H2>
    <p>
      This provides a static wrap(...) method:      
    </p>
    <pre>
      <code>
    Service providedService = APSContextWrapper.wrap(serviceProvider, Service.class);
      </code>
    </pre>
    <p>
      where <em>serviceProvider</em> is an instance of a class that implements <em>Service</em>. The resulting instance is a java.lang.reflect.Proxy implementation of <em>Service</em> that ensures that the <em>serviceProvider</em> ClassLoader is the context class loader during each call to all service methods that are annotated with @APSRunInBundlesContext annotation in <em>Service</em>. The wrapped instance can then be registered as the OSGi service provider.      
    </p>
    <p>
      Normally the threads context class loader is the original service callers context class loader. For a web application it would be the web containers context class loader. If a service needs its own bundles class loader during its execution then this wrapper can be used.      
    </p>
    <H2>ID generators</H2>
    <p>
      There is one interface:      
    </p>
    <pre>
      <code>
    /**
     * This is a generic interface for representing IDs.
     */
    public interface ID extends Comparable&lt;ID&gt; {
    
        /**
         * Creates a new unique ID.
         *
         * @return A newly created ID.
         */
        public ID newID();
    
        /**
         * Tests for equality.
         *
         * @param obj The object to compare with.
         *
         * @return true if equal, false otherwise.
         */
        @Override
        public boolean equals(Object obj);
    
        /**
         * @return The hash code.
         */
        @Override
        public int hashCode();
    
    }
      </code>
    </pre>
    <p>
      that have 2 implementations:      
    </p>
    <ul>
      <li>
        <p>
           IntID - Produces int ids.          
        </p>
      </li>
      <li>
        <p>
           UUID - Produces java.util.UUID Ids.          
        </p>
      </li>
    </ul>
    <H2>Javadoc</H2>
    <p>
      The javadoc for this can be found at <a href='http://apidoc.natusoft.se/APSToolsLib/' title=''>http://apidoc.natusoft.se/APSToolsLib/</a>.      
    </p>
    <H1>APSWebTools</H1>
    <p>
      This is not an OSGi bundle! This is a plain jar containing utilities for web applications. Specifically APS administration web applications. This jar has to be included in each web application that wants to use it.      
    </p>
    <p>
      Among other things it provides support for being part of the APS administration web login (APSAdminWebLoginHandler). Since the APS administration web is built using Vaadin it has Vaadin support classes. APSVaadinOSGiApplication is a base class used by all APS administration webs.      
    </p>
    <H2>APIs</H2>
    <p>
      The following are the APIs for a few selected classes. The complete javadoc for this library can be found at <a href='http://apidoc.natusoft.se/APSWebTools/' title=''>http://apidoc.natusoft.se/APSWebTools/</a>.      
    </p>
    <hr/>    <p>
      public <em>class</em> <strong>APSAdminWebLoginHandler </strong> extends  APSLoginHandler  implements  APSLoginHandler.HandlerInfo    [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <p>
      This is a login handler to use by any admin web registering with the <em>APSAdminWeb</em> to validate that there is a valid login available.      
    </p>
    <p>
            
    </p>
    <p>
      <strong>public APSAdminWebLoginHandler(BundleContext context)</strong>      
    </p>
    <p>
      Creates a new <em>APSAdminWebLoginHandler</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>context</em> - The bundle context.         
      </p>
    </blockquote>
    <p>
      <strong>public void setSessionIdFromRequestCookie(HttpServletRequest request)</strong>      
    </p>
    <p>
      Sets the session id from a cookie in the specified request.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>request</em> - The request to get the session id cookie from.         
      </p>
    </blockquote>
    <p>
      <strong>public void setSessionIdFromRequestCookie(CookieTool.CookieReader cookieReader)</strong>      
    </p>
    <p>
      Sets the session id from a cookie in the specified request.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>cookieReader</em> - The cookie reader to get the session id cookie from.         
      </p>
    </blockquote>
    <p>
      <strong>public void saveSessionIdOnResponse(HttpServletResponse response)</strong>      
    </p>
    <p>
      Saves the current session id on the specified response.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>response</em> - The response to save the session id cookie on.         
      </p>
    </blockquote>
    <p>
      <strong>public void saveSessionIdOnResponse(CookieTool.CookieWriter cookieWriter)</strong>      
    </p>
    <p>
      Saves the current session id on the specified response.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>cookieWriter</em> - The cookie writer to save the session id cookie on.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSLoginHandler </strong> implements  LoginHandler    [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <p>
      This class validates if there is a valid logged in user and also provides a simple login if no valid logged in user exists.      
    </p>
    <p>
      This utility makes use of APSAuthService to login auth and APSSessionService for session handling. Trackers for these services are created internally which requires the shutdown() method to be called when no longer used to cleanup.      
    </p>
    <p>
      The bundle needs to import the following packages for this class to work:      
    </p>
    <pre>
      <code>
     se.natusoft.osgi.aps.api.auth.user;version="[0.9,2)",
     se.natusoft.osgi.aps.api.misc.session;version="[0.9,2)"
      </code>
    </pre>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected void setHandlerInfo(HandlerInfo handlerInfo)</strong>      
    </p>
    <p>
      Sets the handler info when not provided in constructor.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>handlerInfo</em> - The handler info to set.         
      </p>
    </blockquote>
    <p>
      <strong>public void shutdown()</strong>      
    </p>
    <p>
      Since this class internally creates and starts service trackers this method needs to be called on shutdown to cleanup!      
    </p>
    <p>
      <strong>public String getLoggedInUser()</strong>      
    </p>
    <p>
      This returns the currently logged in user or null if none are logged in.      
    </p>
    <p>
            
    </p>
    <p>
      <strong>public boolean hasValidLogin()</strong>      
    </p>
    <p>
      Returns true if this handler sits on a valid login.      
    </p>
    <p>
      <strong>public boolean login(String userId, String pw)</strong>      
    </p>
    <p>
      Logs in with a userid and a password.      
    </p>
    <p>
      This method does not use or modify any internal state of this object! It only uses the APSAuthService that this object sits on. This allows code sitting on an instance of this class to use this method for validating a user without having to setup its own service tracker for the <em>APSAuthService</em> when this object is already available due to the code also being an <em>APSAdminWeb</em> member. It is basically a convenience.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if successfully logged in, false otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean login(String userId, String pw, String requiredRole)</strong>      
    </p>
    <p>
      Logs in with a userid and a password, and a required role.      
    </p>
    <p>
      This method does not use or modify any internal state of this object! It only uses the APSAuthService that this object sits on. This allows code sitting on an instance of this class to use this method for validating a user without having to setup its own service tracker for the <em>APSAuthService</em> when this object is already available due to the code also being an <em>APSAdminWeb</em> member. It is basically a convenience.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        a valid User object on success or null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requiredRole</em> - If non null the user is required to have this role for a successful login. If it doesn't null will         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>interface</em> <strong>HandlerInfo </strong>   [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <p>
      Config values for the login handler.      
    </p>
    <p>
      <strong>String getSessionId()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An id to an APSSessionService session.        
      </p>
    </blockquote>
    <p>
      <strong>void setSessionId(String sessionId)</strong>      
    </p>
    <p>
      Sets a new session id.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The session id to set.         
      </p>
    </blockquote>
    <p>
      <strong>String getUserSessionName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the session data containing the logged in user if any.        
      </p>
    </blockquote>
    <p>
      <strong>String getRequiredRole()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The required role of the user for it to be considered logged in.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>LoginHandler </strong>   [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <p>
      This is a simple API for doing a login.      
    </p>
    <p>
      <strong>public boolean hasValidLogin()</strong>      
    </p>
    <p>
      Returns true if this handler sits on a valid login.      
    </p>
    <p>
      <strong>boolean login(String userId, String pw)</strong>      
    </p>
    <p>
      Logs in with a userid and a password.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if successfully logged in, false otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <p>
      <strong>public void shutdown()</strong>      
    </p>
    <p>
      If the handler creates service trackers or other things that needs to be shutdown when no longer used this method needs to be called when the handler is no longer needed.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSAuthService</H1>
    <p>
      This is a very simple little service that only does authentication of users. This service is currently used by the APS administration web (/apsadminweb) and APSExtProtocolHTTPTransportProvider for remote calls to services over http.      
    </p>
    <p>
      The idea behind this service is that it should be easy to provide an implementation of this that uses whatever authentication scheme you want/need. If you have an LDAP server you want to authenticate against for example, provide an implementation that looks up and authenticates the user against the LDAP server.      
    </p>
    <p>
      See this a little bit like an authentication plugin.      
    </p>
    <p>
      The APS web applications that use this only uses password authentication.      
    </p>
    <H2>APSSimpleUserServiceAuthServiceProvider</H2>
    <p>
      This provides an APSAuthService that uses the APSSimpleUserService to authenticate users. It only supports password authentication. If you don't have your own implementation of APSAuthService then you can deploy this one along with APSSimpleUserService, and probably APSUserAdminWeb.      
    </p>
    <p>
      <strong>Please note</strong> however that the standard implementation of APSSimpleUserService can register several instances with an "instance=name" property where name is unique for each instance, and each instance can reference a different data source. This is configured under <em>persistence/dsrefs</em> in the configuration. If no instances are configured an instance of "aps-admin-web" will be created by default. If instances are configured the default will not be created. And now the the point: APSSimpleuserServiceAuthServiceProvider will as of now track the "aps-admin-web" instance of APSSimpleUserService! If no such instance is configured it will fail after a timeout of not finding a service!      
    </p>
    <H2>API</H2>
    <p>
      public <em>interface</em> <strong>APSAuthService&lt;Credential&gt; </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <p>
      This is intended to be used as a wrapper to other means of authentication. Things in APS that needs authentication uses this service.      
    </p>
    <p>
      Implementations can lookup the user in an LDAP for example, or use some other user service.      
    </p>
    <p>
      APS supplies an <em>APSSimpleUserServiceAuthServiceProvider</em> that uses the <em>APSSimpleUserService</em> to authenticate. It is provided in its own bundle.      
    </p>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <p>
      This authenticates a user. A Properties object is returned on successful authentication. null is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod, String role) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <p>
      This authenticates a user. A Properties object is returned on successful authentication. <em>null</em> is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>role</em> - The specified user must have this role for authentication to succeed. Please note that the APS admin webs will pass "apsadmin" for the role. The implementation might need to translate this to another role.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>AuthMethod[] getSupportedAuthMethods()</strong>      
    </p>
    <p>
      Returns an array of the AuthMethods supported by the implementation.      
    </p>
    <p>
      public <em>static</em> <em>enum</em> <strong>AuthMethod </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <p>
      This hints at how to use the credentials.      
    </p>
    <p>
      <strong>NONE</strong>      
    </p>
    <p>
       Only userid is required.      
    </p>
    <p>
      <strong>PASSWORD</strong>      
    </p>
    <p>
       toString() on the credentials object should return a password.      
    </p>
    <p>
      <strong>KEY</strong>      
    </p>
    <p>
       The credential object is a key of some sort.      
    </p>
    <p>
      <strong>CERTIFICATE</strong>      
    </p>
    <p>
       The credential object is a certificate of some sort.      
    </p>
    <p>
      <strong>DIGEST</strong>      
    </p>
    <p>
       The credential object is a digest password.      
    </p>
    <p>
      <strong>SSO</strong>      
    </p>
    <p>
       The credential object contains information for participating in a single sign on.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSSimpleUserService</H1>
    <p>
      This is an simple, easy to use service for handling logged in users. It provides two services: APSSimpleUserService and APSSimpleUserServiceAdmin. The latter handles all creation, editing, and deletion of roles and users. This service in itself does not require any authentication to use! Thereby you have to trust all code in the server! The APSUserAdminWeb WAB bundle however does require a user with role <em>apsadmin</em> to be logged in or it will simply repsond with a 401 (UNAUTHORIZED).      
    </p>
    <p>
      So why this and not org.osgi.service.useradmin ? Well, maybe I'm just stupid, but <em>useradmin</em> does not make sense to me. It seems to be missing things, specially for creating. You can create a role, but you cannot create a user. There is no obvious authentication of users. Maybee that should be done via the credentials Dictionary, but what are the expected keys in there ? APSSimpleUserService is intended to make user and role handling simple and clear.      
    </p>
    <H2>Basic example</H2>
    <p>
      To login a user do something like this:      
    </p>
    <pre>
      <code>
    APSSimpleUserService userService ...
    ...
    User user = userService.getUser(userId);
    if (user == null) {
        throw new AuthException("Bad login!");
    }
    if (!userService.authenticateUser(user, password, APSSimpleUserService.AUTH_METHOD_PASSWORD)) {
        throw new AuthException("Bad login!");
    }
    ...
    if (user.isAuthenticated() &amp;&amp; user.hasRole("apsadmin")) {
        ...
    }
    
      </code>
    </pre>
    <H2>Setup</H2>
    <p>
      The following SQL is needed to create the database tables used by the service.      
    </p>
    <pre>
      <code>
    /*
     * This represents one role.
     */
    create table role (
      /* The id and key of the role. */
      id varchar(50) not null primary key,
    
      /* A short description of what the role represents. */
      description varchar(200),
    
      /* 1 == master role, 0 == sub-role. */
      master int
    );
    
    /*
     * This represents one user.
     */
    create table svcuser (
      /* User id and also key. */
      id varchar(50) not null primary key,
    
      /* For the provided implementation this is a password. */
      auth varchar(2000),
    
      /*
       * The service stores string properties for the user here as one long string.
       * These are not meant to be searchable only to provide information about the
       * user.
       *
       * You might want to adapt this size to the amount of data you will be adding
       * to a user.
       */
      user_data varchar(4000)
    );
    
    /*
     * A user can have one or more roles.
     */
    create table user_role (
      user_id varchar(50) not null,
      role_id varchar(50) not null,
      primary key (user_id, role_id),
      foreign key (user_id) references svcuser (id),
      foreign key (role_id) references role (id)
    );
    
    /*
     * A role can have one ore more sub-roles.
     */
    create table role_role (
      master_role_id varchar(50) not null,
      role_id varchar(50) not null,
      primary key (master_role_id, role_id),
      foreign key (master_role_id) references role (id),
      foreign key (role_id) references role (id)
    );
    
    /*
     * ---- This part is mostly an example ----
     * WARNING: You do however need a role called 'apsadmin' to be able to login to
     * /apsadminweb! The name of the user having that role does not matter. As long
     * as it is possible to login to /apsadminweb new roles and users can be created
     * there.
     */
    
    /* The following adds an admin user. */
    insert into role VALUES ('apsadmin', 'Default admin for APS', 1);
    insert into svcuser VALUES ('apsadmin', 'admin', '');
    insert into user_role VALUES ('apsadmin', 'apsadmin');
    
    /* This adds a role for non admin users. */
    insert into role VALUES ('user', 'Plain user', 1);
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      </code>
    </pre>
    <!--
      
The above empty lines are required due to a bug in iText used to render the PDF. It will move the picture to the next page completely out of context since text after the picture will then come before it. 
    -->
    <p>
      After the tables have been created you need to configure a datasource for it in /apsadminweb configuration tab:      
    </p>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Auth/APSSimpleUserServiceProvider/docs/images/DataSourceConfig.png' title='' alt='Picture of datasource config gui.'/>      
    </p>
    <p>
      Please note that the above picture is just an example. The data source name <em>APSSimpleUserServiceDS</em> in this example should be configured in the <em>persistence/dsRefs</em> config where you provide a name and a datasource reference. The service will be looking up the entry with that name, and use the specified datasource! For example:      
    </p>
    <pre>
      <code>
    name: aps-admin-web
    dsRef: APSSimpleUserServiceDS
      </code>
    </pre>
    <p>
      This example happens to be the default if no instances have been configured and is required if you want to use authentication for the APS admin web. You should probably define your own instance if you are going to use this service. The <em>dsRef</em> part is exactly the same name as defined in the data source configuration (<em>persistence/datasources</em>).      
    </p>
    <p>
      The rest of the datasource entry in the picture above depends on your database and where it is running. Also note that the "(default)" after the field names in the above picture are the name of the currently selected configuration environment. This configuration is configuration environment specific. You can point out different database servers for different environments for example.      
    </p>
    <p>
      When the datasource is configured and saved then you can go to <em>"Configuration tab,</em><em> Configurations/aps/adminweb"</em> and enable the "requireauthentication" config. <strong>If you do this before setting up the datasource and you have choosen to use the provided implementation of APSAuthService that uses APSSimpleUserService to login then you will be completely locked out!</strong>      
    </p>
    <H2>Troubleshooting</H2>
    <p>
      If you have managed to lock yourself out of /apsadminweb as described above then I suggest editing the <em>APSFilesystemService root</em>/filesystems/se.natusoft.osgi.aps.core.config.service.APSConfigServiceProvider/apsconfig-se.natusoft.aps.adminweb-1.0.properties file and changeing the following line:      
    </p>
    <pre>
      <code>
    se.natusoft.aps.adminweb_1.0_requireauthentication=true
    
      </code>
    </pre>
    <p>
      to <em>false</em> instead. Then restart the server. Also se the APSFilesystemService documentation for more information. The APSConfigService is using that service to store its configurations.      
    </p>
    <H2>JDBC Drivers</H2>
    <p>
      There is a catch with OSGi and its classpath isolation. The <em>APSSimpleUserService</em> makes use of the <em>APSJPAService</em> whose implementation <em>APSOpenJPAProvider</em> cheats OSGi a bit by using <em>MultiBundleClassLoader</em> (is available in aps-tools-library bundle) and merges the service classpath with the client classpath which is a requirement for the JPA framework to work (it needs access to both framework code in the service classpath and client entities in the client classpath). This also has the side effect that the client can provide a JDBC driver in its bundle. The <em>APSSimpleUserService</em> do provide a JDBC driver for <em>Derby 10.9.1.0</em>.      
    </p>
    <p>
      Another catch with this is that users of <em>APSSimpleUserService</em> are not part of this collective classpath and can thereby not make drivers available in their bundles, or at least not right off, there is however a workaround to this. There is a natsty way that you can pass on the client bundle class loader right through the <em>APSSimpleUserService</em> to <em>APSJPAService</em> by creating an instance of <em>MultiBundleClassLoader</em> and set it as context classloader:      
    </p>
    <pre>
      <code>
    MultiBundleClassLoader mbClassLoader = new MultiBundleClassLoader(bundleContext.getBundle());
    Thread.currentThread().setContextClassLoader(mbClassLoader);
      </code>
    </pre>
    <p>
      Do this before the first call to <em>APSSimpleUserService</em>. The <em>APSJPAService</em> will check if the current context class loader is a MultiBundleClassLoader and if so extract the bundles from it and add to its own MultiBundleClassLoader. This way you have extended the classpath that the JPA framework will se to 3 bundles: aps-openjpa-provider, aps-simple-user-service-provider, and your client bundle, which can then contain a JDBC driver.      
    </p>
    <p>
      The catches are unfortunately not over yet! You also need to configure your own instance of <em>APSSimpleUserService</em> with its own data source in the configuration, and your client needs to add the name of this configuration to the tracker for the <em>APSSimpleUserService</em> :      
    </p>
    <pre>
      <code>
    APSServiceTracker&lt;APSSimpleUserService&gt; userServiceTracker = 
        new APSServiceTracker&lt;&gt;(bundleContext, APSSimpleUserService.class, "(instance=instName)", "30 seconds");
      </code>
    </pre>
    <p>
      or      
    </p>
    <pre>
      <code>
    @OSGiService(additionalSearchCriteria="(instance=instName)", timeout="30 seconds")
    APSSimpleUserService userService;
      </code>
    </pre>
    <p>
      where <em>instName</em> is whatever name you gave the instance in the configuration. Then try to have only one bundle call this service since each different bundle calling the service will extend the service classpath with that bundle!      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSSimpleUserService </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <p>
      This is the API of a simple user service that provide basic user handling that will probably be enough in many cases, but not all.      
    </p>
    <p>
      Please note that this API does not declare any exceptions! In the case of an exception being needed the APSSimpleUserServiceException should be thrown. This is a runtime exception.      
    </p>
    <p>
      <strong>public static final String AUTH_METHOD_PASSWORD = "password"</strong>      
    </p>
    <p>
       Password authentication method for authenticateUser().      
    </p>
    <p>
      <strong>public Role getRole(String roleId)</strong>      
    </p>
    <p>
      Gets a role by its id.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A Role object representing the role or null if role was not found.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleId</em> - The id of the role to get.         
      </p>
    </blockquote>
    <p>
      <strong>public User getUser(String userId)</strong>      
    </p>
    <p>
      Gets a user by its id.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A User object representing the user or null if userId was not found.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to get.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean authenticateUser(User user, Object authentication, String authMethod)</strong>      
    </p>
    <p>
      Authenticates a user using its user id and user provided authentication.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if authenticated, false otherwise. If true user.isAuthenticated() will also return true.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The User object representing the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authentication</em> - The user provided authentication data. For example if AuthMethod is AUTH\_METHOD\_PASSWORD         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - Specifies what authentication method is wanted.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSimpleUserServiceAdmin </strong> extends  APSSimpleUserService    [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <p>
      Admin API for APSSimpleUserService.      
    </p>
    <p>
      <strong>public RoleAdmin createRole(String name, String description)</strong>      
    </p>
    <p>
      Creates a new role.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        a new Role object representing the role.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the role. This is also the key and cannot be changed.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>description</em> - A description of the role. This can be updated afterwards.         
      </p>
    </blockquote>
    <p>
      <strong>public void updateRole(Role role)</strong>      
    </p>
    <p>
      Updates a role.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to update.         
      </p>
    </blockquote>
    <p>
      <strong>public void deleteRole(Role role)</strong>      
    </p>
    <p>
      Deletes a role.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to delete. This will likely fail if there are users still having this role!         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;RoleAdmin&gt; getRoles()</strong>      
    </p>
    <p>
      Returns all available roles.      
    </p>
    <p>
      <strong>public UserAdmin createUser(String id)</strong>      
    </p>
    <p>
      Creates a new user. Please note that you get an empty user back. You probably want to add roles and also possibly properties to the user. After you have done that call <em>updateUser(user)</em>.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A User object representing the new user.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>id</em> - The id of the user. This is key so it must be unique.         
      </p>
    </blockquote>
    <p>
      <strong>public void updateUser(User user)</strong>      
    </p>
    <p>
      Updates a user.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to update.         
      </p>
    </blockquote>
    <p>
      <strong>public void deleteUser(User user)</strong>      
    </p>
    <p>
      Deletes a user.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to delete.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;UserAdmin&gt; getUsers()</strong>      
    </p>
    <p>
      Returns all users.      
    </p>
    <p>
      <strong>public void setUserAuthentication(User user, String authentication)</strong>      
    </p>
    <p>
      Sets authentication for the user.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to set authentication for.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authentication</em> - The authentication to set.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSAuthMethodNotSupportedException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.auth.user.exceptions] {      
    </p>
    <p>
      This is thrown by APSAuthService when the implementation does not support the selected auth method.      
    </p>
    <p>
      <strong>public APSAuthMethodNotSupportedException(String message)</strong>      
    </p>
    <p>
      Creates a new APSAuthMethodNotSupportedException instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <p>
      <strong>public APSAuthMethodNotSupportedException(String message, Throwable cause)</strong>      
    </p>
    <p>
      Creates a new APSAuthMethodNotSupportedException instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The exception that is the cause of this one.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSSimpleUserServiceException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.auth.user.exceptions] {      
    </p>
    <p>
      Indicates a problem with the APSSimpleUserService.      
    </p>
    <p>
      <strong>public APSSimpleUserServiceException(String message)</strong>      
    </p>
    <p>
      Creates a new APSSimpleUserServiceException instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <p>
      <strong>public APSSimpleUserServiceException(String message, Throwable cause)</strong>      
    </p>
    <p>
      Creates a new APSSimpleUserServiceException instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of the exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>Role </strong> extends  Comparable&lt;Role&gt;    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <p>
      This defines a role.      
    </p>
    <p>
      <strong>public String getId()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The id of the role.        
      </p>
    </blockquote>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of the role.        
      </p>
    </blockquote>
    <p>
      <strong>public boolean hasRole(String roleName)</strong>      
    </p>
    <p>
      Returns true if the role has the specified sub role name.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleName</em> - The name of the role to check for.         
      </p>
    </blockquote>
    <p>
      <strong>boolean isMasterRole()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if this role is a master role. Only master roles can be added to users.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RoleAdmin </strong> extends  Role    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <p>
      Provides update API for Role.      
    </p>
    <p>
      <strong>public void setDescription(String description)</strong>      
    </p>
    <p>
      Changes the description of the role.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>description</em> - The new description.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;Role&gt; getRoles()</strong>      
    </p>
    <p>
      Returns all sub roles for this role.      
    </p>
    <p>
      <strong>public void addRole(Role role)</strong>      
    </p>
    <p>
      Adds a sub role to this role.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeRole(Role role)</strong>      
    </p>
    <p>
      Removes a sub role from this role.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void setMasterRole(boolean masterRole)</strong>      
    </p>
    <p>
      Sets whether this is a master role or not.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>masterRole</em> - true for master role.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>User </strong> extends  Comparable&lt;User&gt;    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <p>
      This defines a User.      
    </p>
    <p>
      <strong>public String getId()</strong>      
    </p>
    <p>
      Returns the unique id of the user.      
    </p>
    <p>
      <strong>public boolean isAuthenticated()</strong>      
    </p>
    <p>
      Returns true if this user is authenticated.      
    </p>
    <p>
      <strong>public boolean hasRole(String roleName)</strong>      
    </p>
    <p>
      Returns true if the user has the specified role name.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleName</em> - The name of the role to check for.         
      </p>
    </blockquote>
    <p>
      <strong>public Properties getUserProperties()</strong>      
    </p>
    <p>
      This provides whatever extra information about the user you want. How to use this is upp to the user of the service. There are some constants in this class that provide potential keys for the user properties.      
    </p>
    <p>
      Please note that the returned properties are read only!      
    </p>
    <p>
      <strong>public static final String USER_NAME = "name"</strong>      
    </p>
    <p>
       Optional suggestion for user properties key.      
    </p>
    <p>
      <strong>public static final String USER_PHONE = "phone"</strong>      
    </p>
    <p>
       Optional suggestion for user properties key.      
    </p>
    <p>
      <strong>public static final String USER_PHONE_WORK = "phone.work"</strong>      
    </p>
    <p>
       Optional suggestion for user properties key.      
    </p>
    <p>
      <strong>public static final String USER_PHONE_HOME = "phone.home"</strong>      
    </p>
    <p>
       Optional suggestion for user properties key.      
    </p>
    <p>
      <strong>public static final String USER_EMAIL = "email"</strong>      
    </p>
    <p>
       Optional suggestion for user properties key.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>UserAdmin </strong> extends  User    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <p>
      Provides update API for the User.      
    </p>
    <p>
      <strong>public List&lt;Role&gt; getRoles()</strong>      
    </p>
    <p>
      Returns all roles for this user.      
    </p>
    <p>
      <strong>public void addRole(Role role)</strong>      
    </p>
    <p>
      Adds a role to this user.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeRole(Role role)</strong>      
    </p>
    <p>
      Removes a role from this user.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void addUserProperty(String key, String value)</strong>      
    </p>
    <p>
      Adds a user property.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>key</em> - The key of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value of the property.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeUserProperty(String key)</strong>      
    </p>
    <p>
      Removes a user property.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>key</em> - The key of the property to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void setUserProperties(Properties properties)</strong>      
    </p>
    <p>
      Sets properties for the user.      
    </p>
    <p>
      To update the user properties either first do <em>getProperties()</em>, do your changes, and then call this method with the changed properties or just use the <em>addUserProperty()</em> and <em>removeUserProperty()</em> methods.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>properties</em> - The properties to set.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <!--
      
    This is a source file that will be generated into pdf, html and markdown complete with javadoc input
    and put directly under docs.
    -->
    <H1>APSDataSource</H1>
    <p>
      This is a service that provides named data source definitions. It does <strong>not</strong> provide pooled <em>javax.sql.DataSource</em> instances! It only provides definitions with connection url, driver name, user and password. This service can be used by other services that provide DataSource pooling for example. The APSSimpleUserServiceProvider makes use of this service by looking up ”APSSimpleUserServiceDS” passing the information on to the APSJPAService in its properties. Not everything can make use of an <em>javax.sql.DataSource</em>, but everything can make use of the information provided by this service.      
    </p>
    <p>
      The actual data source definitions are configured in the <em>/apsadminweb</em> under configuration group ”persistence”.      
    </p>
    <H2>APIs</H2>
    <p>
      The complete APS javadoc can be found at <a href='http://apidoc.natusoft.se/APS/' title=''>http://apidoc.natusoft.se/APS/</a>.      
    </p>
    <p>
      public <em>interface</em> <strong>DataSourceDef </strong>   [se.natusoft.osgi.aps.api.data.jdbc.model] {      
    </p>
    <p>
      This represents information required for setting upp a JDBC data source.      
    </p>
    <p>
      <strong>String getName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of this data source definition. This information is optional and can return null!        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionURL()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The JDBC connection URL. Ex: jdbc:provider://host:port/database[;properties].        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionDriveName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The fully qualified class name of the JDBC driver to use.        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionUserName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the database user to login as.        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionPassword()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The password for the database user.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSDataSourceDefService </strong>   [se.natusoft.osgi.aps.api.data.jdbc.service] {      
    </p>
    <p>
      This service provides lookup of configured data source definitions. These can be used to setup connection pools, JPA, ...      
    </p>
    <p>
      <strong>DataSourceDef lookupByName(String name)</strong>      
    </p>
    <p>
      Looks up a data source definition by its configured name.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A DataSourceDef or null if name was not valid.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name to lookup.         
      </p>
    </blockquote>
    <p>
      <strong>List&lt;DataSourceDef&gt; getAllDefinitions()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All available definitions.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJPAService</H1>
    <p>
      This provides JPA to services and applications. It has a slightly more OSGi friendly API than the org.osgi.service.jpa.EntityManagerFactoryBuilder. The APSOpenJPAProvider however returns an APSJPAService instance that also implements EntityManagerFactoryBuilder. For some reason I haven’t figured out yet, it cannot be registered as a service with the EntityManagerFactoryBuilder interface! The bundle fails to deploy if that is done.      
    </p>
    <p>
      The provided service is using OpenJPA. The service works partly as an extender inspecting deployed bundles for a META-INF/persistence.xml file. When found this is read and some setup is done already there. The persistenceUnitName from the persistence.xml file is used to connect the client later with its configuration. When a JPA using bundle is shut down its JPA setup is automatically cleaned.      
    </p>
    <p>
      Here is an example of usage:      
    </p>
    <pre>
      <code>
        private APSJPAEntityManagerProvider emp = null;
        ...
        private APSJPAEntityManagerProvider getEMP() {
            if (this.emp == null || !this.emp.isValid()) {
                DataSourceDef dsDef = this.dataSourceDefService.lookupByName(”MyDS");
                if (dsDef == null) {
                    throw new SomeException("Could not find an ’MyDs’ in 'persistence/datasources' configuration!");
                }
                Map&lt;String, String&gt; props = new HashMap&lt;String, String&gt;();
                props.put("javax.persistence.jdbc.user", dsDef.getConnectionUserName());
                props.put("javax.persistence.jdbc.password", dsDef.getConnectionPassword());
                props.put("javax.persistence.jdbc.url", dsDef.getConnectionURL());
                props.put("javax.persistence.jdbc.driver", dsDef.getConnectionDriveName());
                this.emp = this.jpaService.initialize(this.bundleContext, ”myPersistenceUnitName”, props);
            }
            return this.emp;
        }
        ...
        EntityManager em = getEMP().createEntityManager();
        em.getTransaction().begin();
    
        try {
            RoleEntity role = new RoleEntity(id);
            role.setDescription(description);
            em.persist(role);
            em.getTransaction().commit();
        }
        catch (RuntimeException re) {
            em.getTransaction().rollback();
            throw re;
        }
        finally {
            em.close();
        }
            
      </code>
    </pre>
    <p>
      This code example handles the APSJPAService having been restared or redeployed. When <code>emp.isValid()</code> returns false then all you need to do is to call <code>jpaService.initialize(...)</code> again. The rest is just POJPA (Plain Old JPA :-)).      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSJPAService </strong>   [se.natusoft.osgi.aps.api.data.jpa.service] {      
    </p>
    <p>
      This service allows an JPA <em>EntityManager</em> to be gotten for a persistent unit name.      
    </p>
    <p>
      So why is this done this way ? Why is not an <em>EntityManagerFactory</em> returned?      
    </p>
    <p>
      The answer to that is that the <em>EntityManagerFactory</em> is internal to the service who is responsible for creating it and for closing it at sometime (stopping of bundle). The client only needs an <em>EntityManager</em> for which the client is responsible after its creation.      
    </p>
    <p>
      The creation of the <em>EntityManagerFactory</em> is delayed until the call to <em>initialize(...)</em>. Creating the EMF along with the persistence provider at persistence bundle discovery would limit database connection properties to the persistence.xml file which is less than optimal to put it mildly. This way a client can make use of the <em>APSDataSourceDefService</em> to get the JDBC properties which it can pass along to this service.      
    </p>
    <p>
      The default provider implementation of this service uses OpenJPA which provides its own connection pooling.      
    </p>
    <p>
      <strong>APSJPAEntityManagerProvider initialize(BundleContext bundleContext, String persistenceUnitName, Map&lt;String, String&gt; props) throws APSResourceNotFoundException</strong>      
    </p>
    <p>
      Initializes and returns a provider from the specified properties.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A configured EntityManager.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>bundleContext</em> - The context of the client bundle. It is used to locate its persistence provider.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>persistenceUnitName</em> - The name of the persistent unit defined in persistence.xml.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>props</em> - Custom properties to configure database, etc.         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>interface</em> <strong>APSJPAEntityManagerProvider </strong>   [se.natusoft.osgi.aps.api.data.jpa.service] {      
    </p>
    <p>
      Once you get this it is valid until the <em>APSJPAService</em> is stopped (which will happen if the service is redeployed!).      
    </p>
    <p>
      <strong>public boolean isValid()</strong>      
    </p>
    <p>
      Returns true if this instance is valid. If not call APSJPAService.initialize(...) again to get a new instance. It will be invalid if the APSJPAService provider have been restarted.      
    </p>
    <p>
      <strong>EntityManager createEntityManager()</strong>      
    </p>
    <p>
      Creates a new <em>EntityManager</em>. You are responsible for closing it!      
    </p>
    <p>
      Please note that the <em>EntityManager</em> caches all referenced entities. If you keep and reuse it for a longer time it can use more memory. For example at <a href='http://docs.jboss.org/ejb3/app-server/tutorial/extended_pc/extended.html' title=''>http://docs.jboss.org/ejb3/app-server/tutorial/extended_pc/extended.html</a> it says that "Usually, an <em>EntityManager</em> in JBoss EJB 3.0 lives and dies within a JTA transaction". This indicates how long-lived the <em>EntityManager</em> should preferably be.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A configured EntityManager.        
      </p>
    </blockquote>
    <p>
      <strong>EntityManagerFactory getEntityManagerFactory()</strong>      
    </p>
    <p>
      Returns the underlying <em>EntityManagerFactory</em>. This will return null if isValid() return false!      
    </p>
    <p>
      Be very careful what you do with this! It is managed by this service!      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJSONService</H1>
    <p>
      This provides exactly the same functionallity as APSJSONLib. It actually wraps the library as a service. The reason for that is that I wanted to be able to redeploy the library without forcing a redeploy of the Bunde using it. A redeploy of the library will force a redeploy of this service, but not the client of this service. The APS clients of this service uses APSServiceTracker wrapped as a service and thus handles this service leaving and returning without having to care about it.      
    </p>
    <p>
      This service and the library existrs for internal use. It is here and can be used by anyone, but in most cases like serializing java beans back and forth to JSON (which this can do) Jacksson would still be a better choice and offers more flexibility. In the long run I’m going to see if I can replace the internal use of this with Jacksson as well.      
    </p>
    <H1>aps-persistent-named-queue-provider</H1>
    <p>
      This provides an implementation of <strong>APSNamedQueueService</strong> that makes use of <strong>APSFilesystemService</strong> for storage. Clients just create or get a queue by a unique name. It is then possible to push bytes to the queue or to pull bytes from the queue. It is rather simple.      
    </p>
    <H2>APIS</H2>
    <p>
      public <em>interface</em> <strong>APSNamedQueueService </strong>   [se.natusoft.osgi.aps.api.misc.queue] {      
    </p>
    <p>
      A named queue as a service. How long lived it is depends on the implementation.      
    </p>
    <p>
      <strong>Note</strong> that there can be only one receiver per queue. Once an item is delivered it is gone from the queue!      
    </p>
    <p>
      <strong>APSQueue createQueue(String name) throws APSIOException</strong>      
    </p>
    <p>
      Creates a new queue.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the queue to create. If the named queue already exists, it is just returned,         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on failure to create queue.         
      </p>
    </blockquote>
    <p>
      <strong>void removeQueue(String name) throws APSResourceNotFoundException</strong>      
    </p>
    <p>
      Removes the named queue.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the queue to remove.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSResourceNotFoundException</em> - on failure to remove the queue.         
      </p>
    </blockquote>
    <p>
      <strong>APSQueue getQueue(String name) throws APSResourceNotFoundException</strong>      
    </p>
    <p>
      Returns the named queue. If it does not exist, it is created.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the queue to get.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSResourceNotFoundException</em> - on failure to get queue.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
      <strong>void push(byte[] item) throws APSIOException</strong>      
    </p>
    <p>
      Pushes a new item to the end of the list.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>item</em> - The item to add to the list.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on any failure to do this operation.         
      </p>
    </blockquote>
    <p>
      <strong>byte[] pull(long timeout) throws APSIOTimeoutException</strong>      
    </p>
    <p>
      Pulls the first item in the queue, removing it from the queue.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The pulled item.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>timeout</em> - A value of 0 will cause an immediate APSIOException if the queue is empty. Any         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on any failure to do this operation.         
      </p>
    </blockquote>
    <p>
      <strong>byte[] peek() throws APSIOException, UnsupportedOperationException</strong>      
    </p>
    <p>
      Looks at, but does not remove the first item in the queue.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The first item in the queue.        
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on any failure to do this operation.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>UnsupportedOperationException</em> - If this operation is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>int size() throws APSIOException, UnsupportedOperationException</strong>      
    </p>
    <p>
      Returns the number of items in the queue.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on any failure to do this operation.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>UnsupportedOperationException</em> - If this operation is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>boolean isEmpty() throws APSIOException</strong>      
    </p>
    <p>
      Returns true if this queue is empty.      
    </p>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSIOException</em> - on any failure to do this operation.         
      </p>
    </blockquote>
    <p>
      <strong>void release()</strong>      
    </p>
    <p>
      Releases this APSQueue instance to free up resources. After this call this specific instance will be invalid and a new one have to be gotten from APSNamedQueueService.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSResolvingBundleDeployer</H1>
    <p>
      This is a bundle deployer that is intended as an alternative to the server provided deployer.      
    </p>
    <p>
      This bundle deployer will try to automatically resolve deploy dependencies. It does this by having a fail threshold. If the deploy of a bundle fails it just keeps quiet and put the bundle at the end of the list of bundles to deploy. It updates the try count for the bundle however. Next time the bundle is up for deploy it might have the dependencies it needs and will deploy. If not it goes back to the end of the list again and its retry count is incremented again. This repeats until the retry count reaches the threshold value in which case an error is logged and the bundle will not be attempted to be deployed again unless it gets a new timestamp on disk.      
    </p>
    <p>
      Glassfish does something similar, but Virgo fails completely unless bundles are deployed in the correct order. You have to provide a par file for Virgo to deploy correctly.      
    </p>
    <p>
      There is one catch to using this deployer: It does not handle WAB bundles! Neither Glassfish nor Virgo seems to handle WAB deployment using the OSGi extender pattern. If they did they would recognize a WAB being deployed even though it is deployed by this deployer and handle it. They dont!      
    </p>
    <H2>Configuration</H2>
    <p>
      The following configuration is available for this deployer. Edit this in /apsadminweb ”Configurations” tab under the <em>aps</em> node.      
    </p>
    <p>
      <strong>deployDirectory</strong> - The directory to deploy bundles from. All bundles in this directory will be attempted to be deployed.      
    </p>
    <p>
      <strong>failThreshold</strong> - The number of failed deploys before giving upp. The more bundles and the more dependencies among them the higher the value should be. The default value is 8.      
    </p>
    <H1>APSSessionService</H1>
    <p>
      This service provides session storage functionality. You can create a session, get an existing session by its id, and close a session. Each session can hold any number of named objects.      
    </p>
    <p>
      Why a session service ? To begin with, this is not an HttpSession! That said, it was created to handle a single session among several web applications. This for the APS administration web which are made up of several web applications working toghether. This is explained in detail in the APSAdminWeb documentation.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSSession </strong>   [se.natusoft.osgi.aps.api.misc.session] {      
    </p>
    <p>
      This represents an active session.      
    </p>
    <p>
      <strong>String getId()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The id of this session.        
      </p>
    </blockquote>
    <p>
      <strong>boolean isValid()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if this session is still valid.        
      </p>
    </blockquote>
    <p>
      <strong>void saveObject(String name, Object object)</strong>      
    </p>
    <p>
      Saves an object in the session. Will do nothing if the session is no longer valid.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name to store the object under.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>object</em> - An object to store in the session.         
      </p>
    </blockquote>
    <p>
      <strong>Object retrieveObject(String name)</strong>      
    </p>
    <p>
      Returns a object stored under the specified name or null if no object is stored under that name.      
    </p>
    <p>
      If isValid() returns false then this will always return null.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the object to get.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSessionService </strong>   [se.natusoft.osgi.aps.api.misc.session] {      
    </p>
    <p>
      This is not a http session! It is a simple session that can be used by any code running in the same OSGi server.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>APSSession createSession(int timeoutInMinutes)</strong>      
    </p>
    <p>
      Creates a new session.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>timeoutInMinutes</em> - The timeout in minutes.         
      </p>
    </blockquote>
    <p>
      <strong>APSSession createSession(String sessionId, int timeoutInMinutes)</strong>      
    </p>
    <p>
      Creates a new session.      
    </p>
    <p>
      The idea behind this variant is to support distributed sessions. The implementation must use a session id that is unique enough to support this. The APS implementation uses java.util.UUID.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to create.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>timeoutInMinutes</em> - The timeout in minutes.         
      </p>
    </blockquote>
    <p>
      <strong>APSSession getSession(String sessionId)</strong>      
    </p>
    <p>
      Looks up an existing session by its id.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A valid session having the specified id or null.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to lookup.         
      </p>
    </blockquote>
    <p>
      <strong>void closeSession(String sessionId)</strong>      
    </p>
    <p>
      Closes the session represented by the specified id. After this call APSSession.isValid() on an <em>APSSession</em> representing this session will return false.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to leaveSyncGroup.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSDefaultDiscoveryServiceProvider</H1>
    <p>
      This is a simple service where you can publish and unpublish service information. This information will be distributed to all other nodes that are configured to be part of the disovery.      
    </p>
    <p>
      Service data can be configured to be shared by Multicast, or TCP. The <em>APSTCPIPService</em> is used to send and receive data.      
    </p>
    <H2>Discovery information</H2>
    <p>
      The discovery information is just a Properties object. Anything you want can be put into it, but the following keys are suggested for interoperability:      
    </p>
    <pre>
      <code>
    public class DiscoveryKeys {
    
        /** A name of the service. */
        public static final String NAME = "name";
    
        /** The version of the service. */
        public static final String VERSION = "version";
    
        /** An URI as used by APSTcpipService. */
        public static final String APS_URI = "apsURI";
    
        /** A URL for accessing the service. */
        public static final String URL = "url";
    
        /** The port of the service. */
        public static final String PORT = "port";
    
        /** The host of the service. */
        public static final String HOST = "host";
    
        /** An informative description of the service. */
        public static final String DESCRIPTION = "description";
    
        /** This is used by APSClusterService to announce cluster members. */
        public static final String APS_CLUSTER_NAME = "apsClusterName";
    
        /** The protocol of the service, like TCP, UDP, Multicast */
        public static final String PROTOCOL = "protocol";
    
        /** Some description of the type of the content provided by the service. */
        public static final String CONTENT_TYPE = "contentType";
    
        /** A timestamp of when the entry was last updated. */
        public static final String LAST_UPDATED = "lastUpdated";
    }
      </code>
    </pre>
    <H2>Transport data format</H2>
    <p>
      The data is transported over the network in JSON format:      
    </p>
    <pre>
      <code>
    {
        action: "ADD" / "REMOVE",
        serviceDescription: {
            name: "myservice",
            version: "1.5.4",
            apsURI: "tcp://myhost:5564"
            ...
        }
    }
      </code>
    </pre>
    <H2>API</H2>
    <pre>
      <code>
    /**
     * A network service discovery.
     *
     * There a many such services available in general, a bit less from a java
     * perspective, but the intention with this is not to compete with any of
     * the others, but to provide an extremely simple way to discover remote
     * services in an as simple an primitive way as possible. Basically a way
     * to have multiple hosts running APS based code find each other easily,
     * may it be by simple configuration or by multicast or TCP, or wrapping
     * some other service.
     */
    public interface APSSimpleDiscoveryService {
    
        //
        // Methods
        //
    
        /**
         * On a null filter all services are returned. The filter is otherwise
         * of LDAP type: (&amp;(this=that)(something=pizza)).
         *
         * @param filter The filter to narrow the results.
         */
        Set&lt;Properties&gt; getServices(String filter);
    
        /**
         * Publishes a local service. This will announce it to other known
         * APSSimpleDiscoveryService instances.
         *
         * @param serviceProps This is a set of properties describing the
         *                     service. There are some suggested keys in
         *                     DiscoveryKeys for general compatibility.
         *
         * @throws APSDiscoveryException on problems to publish (note:
         *                               this is a runtime exception!).
         */
        void publishService(Properties serviceProps) throws APSDiscoveryException;
    
        /**
         * Recalls the locally published service, announcing to other known
         * APSSimpleDiscoveryService instances that this service is no longer available.
         *
         * @param unpublishFilter An LDAP type filter that matches an entry or entries
         *                        to unpublish. Any non locally published services cauth
         *                        in the filter will be ignored.
         *
         * @throws APSDiscoveryException on problems to publish (note: this is a
         *                               runtime exception!).
         */
        void unpublishService(String unpublishFilter) throws APSDiscoveryException;
    }
      </code>
    </pre>
    <H1>APSExternalProtocolExtender</H1>
    <p>
      This is an OSGi bundle that makes use of the OSGi extender pattern. It listens to services being registered and unregistered and if the services bundles <em>MANIFEST.MF</em> contains <code>APS-Externalizable: true</code> all services published by the bundle is made externally available. If the <em>MANIFEST.MF</em> contains <code>APS-Externalizable: false</code> however making services externally available is forbidden. It is also possible as an alternative to true/false specify a list of fully qualified service names to make only those services externally available. This overrides any other specification.      
    </p>
    <p>
      A specific service can also be registered containing an <em>aps-externalizable</em> property with value <em>true</em> to be externalizable. If your bundle uses APSActivator (APSToolsLib) as bundle activator then any of @APSExternalizable and @APSRemoteService on the class will make APSActivator set the <em>aps-externalizable</em> property to true when registering the service.      
    </p>
    <p>
      The exernal protocol extender also provides a configuration where services can be specified with their fully qualified name to be made externally available. If a bundle however have specifically specified false for the above manifest entry then the config entry will be ignored.      
    </p>
    <p>
      So, what is meant by <em>made externally available</em> ? Well what this bundle does is to analyze with reflection all services that are in one way or the other specified as being externalizable (manifest or config) and for all callable methods of the service an <em>APSExternallyCallable</em> object will be created and saved locally with the service name. <em>APSExternallyCallable</em> extends <em>java.util.concurrent.Callable</em>, and adds the possibility to add parameters to calls and also provides meta data for the service method, and the bundle it belongs to. There is also an <em>APSRESTCallable</em> that extends <em>APSExternallyCallable</em> and also takes an http method and maps that to a appropriate service method.      
    </p>
    <H2>The overall structure</H2>
    <p>
      The complete picture for making services externally callable looks like this:      
    </p>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Network/APSExternalProtocolExtender/docs/images/EPERelations.png' title='' alt='EPERelations.png'/>      
    </p>
    <p>
      This bundle provides the glue between the services and the protocols. Transports and protocols have to be provided by other bundles.      
    </p>
    <p>
      The flow is like this:      
    </p>
    <ol>
      <li>
        <p>
           Transport gets some request and an InputStream.          
        </p>
      </li>
      <li>
        <p>
           Transport gets some user selected protocol (The APSExtProtocolHTTPTransportProvider allows specification of both protocol, protocol version, and service to call in the URL).          
        </p>
      </li>
      <li>
        <p>
           Transport calls <em>APSExternalProtocolService</em> to get requested protocol.          
        </p>
      </li>
      <li>
        <p>
           Transport calls protocol to parse InputStream and it returns an <em>RPCRequest</em>.          
        </p>
      </li>
      <li>
        <p>
           Transport uses the information in the RPCRequest to call a service using <em>APSExternalProtocolService</em>.          
        </p>
      </li>
      <li>
        <p>
           Transport takes the result from the call and passes to the protocol along with an OutputStream to write response on.          
        </p>
      </li>
    </ol>
    <H2>APSExternalProtocolService</H2>
    <p>
      This bundle registers an <em>APSExternalProtocolService</em> that will provide all <em>APSExternallyCallable</em> instances (or rather copies of them since you can modify the one you get back by providing arguments). This service also provides getters for available remote protocols and you can register with it to receive information about chages for services and protocols.      
    </p>
    <H3>Protocols</H3>
    <p>
      There is a base API for protocols: <em>RPCProtocol</em>. APIs for different types of protocols should extend this. The protocol type APIs are service APIs and services implementing them must be provided by other bundles. This bundle looks for and keeps track of all such service providers.      
    </p>
    <p>
      The <em>StreamedRPCProtocol</em> extends <em>RPCProtocol</em> and provides a method for parsing a request from an <em>InputStream</em> returning an <em>RPCRequest</em> object. This request object contains the name of the service, the method, and the parameters. This is enough for using <em>APSExternalProtocolService</em> to do a call to the service. The request object is also used to write the call response on an OutputStream. There is also a method to write an error response.      
    </p>
    <p>
      It is the responsibility of the transport provider to use a protocol to read and write requests and responses and to use the request information to call a service method. An exception is the case of http transports supporting REST that must take the responibility for returning an http status.      
    </p>
    <H3>Getting information about services and protocols.</H3>
    <p>
      A transport provider can register themselves with the <em>APSExternalProtocolService</em> by implementing the <em>APSExternalProtocolListener</em> interface. They will then be notified when a new externalizable service becomes available or is leaving and when a protocol becomes available or is leaving.      
    </p>
    <H2>WARNING - Non backwards compatible changes!</H2>
    <p>
      This version have non backwards compatible changes! <em>StreamedRPCProtocol</em> have changed in parameters for <em>parseRequest(...)</em> and <em>isRest()</em> is gone. <em>RPCProtocol</em> have changes in parameters for crateRPCError(...). The error code is now gone. These changes was a necessity! The old was really bad and tried to solve REST support in a very stupid way. It is now handled very much more elegantly without any special support for it with <em>is</em>methods!      
    </p>
    <p>
      The <em>APSExtProtocolHTTPTransportProvider</em> now checks if an <em>RPCError</em> (returned by createRPCError(...)) object actually is an <em>HTTPError</em> subclass providing an HTTP error code to return.      
    </p>
    <p>
      <em>parseRequest(...)</em> parameters now also contain the class of the service and a new RequestIntention enum. The service class is only for inspecting methods for annoations or other possible meta data. The JSONREST protocol for example uses this to find annotations indicating GET, PUT, DELETE, etc methods, which is far more flexible than the old solution of requiring a get(), put(), etc method. The RequestIntention enum provides the following values: CREATE, READ, UPDATE, DELETE, UNKNOWN. That is CRUD + UNKNOWN. It will be UNKNOWN if the transport cannot determine such information. These are basically to support REST protocols without being too HTTP specific. Other transports can possible also make use of them.      
    </p>
    <H2>See also</H2>
    <p>
      <em>APSExtProtocolHTTPTransportProvider</em> - Provides a HTTP transport.      
    </p>
    <p>
       <em>APSStreamedJSONRPCProtocolProvider</em> - Provides version 1.0 and 2.0 of JSONRPC, JSONHTTP and JSONREST.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSExternalProtocolService </strong>   [se.natusoft.osgi.aps.api.external.extprotocolsvc] {      
    </p>
    <p>
      This service makes the currently available externalizable services available for calling. It should be used by a bundle providing an externally available way of calling a service (JSON over http for example) to translate and forward calls to the local service. The locally called service is not required to be aware that it is called externally.      
    </p>
    <p>
      <strong>Never cache any result of this service!</strong> Always make a new call to get the current state. Also note that it is possible that the service represented by an APSExternallyCallable have gone away after it was returned, but before you do call() on it! In that case an APSNoServiceAvailableException will be thrown. Note that you can register as an APSExternalProtocolListener to receive notifications about externalizable services coming and going, and also protocols coming and going to keep up to date with the current state of things.      
    </p>
    <p>
      <strong>public Set&lt;String&gt; getAvailableServices()</strong>      
    </p>
    <p>
      Returns all currently available services.      
    </p>
    <p>
      <strong>public List&lt;APSExternallyCallable&gt; getCallables(String serviceName)</strong>      
    </p>
    <p>
      Returns all APSExternallyCallable for the named service object.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The name of the service to get callables for.         
      </p>
    </blockquote>
    <p>
      <strong>public Set&lt;String&gt; getAvailableServiceFunctionNames(String serviceName)</strong>      
    </p>
    <p>
      Returns the names of all available functions of the specified service.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The service to get functions for.         
      </p>
    </blockquote>
    <p>
      <strong>public APSExternallyCallable getCallable(String serviceName, String serviceFunctionName)</strong>      
    </p>
    <p>
      Gets an APSExternallyCallable for a specified service name and service function name.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An APSExternallyCallable instance or null if the combination of service and serviceFunction is not available.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The name of the service object to get callable for.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>serviceFunctionName</em> - The name of the service function of the service object to get callable for.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;RPCProtocol&gt; getAllProtocols()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All currently deployed providers of RPCProtocol.        
      </p>
    </blockquote>
    <p>
      <strong>public RPCProtocol getProtocolByNameAndVersion(String name, String version)</strong>      
    </p>
    <p>
      Returns an RPCProtocol provider by protocol name and version.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        Any matching protocol or null if nothing matches.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the protocol to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the protocol to get.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;StreamedRPCProtocol&gt; getAllStreamedProtocols()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All currently deployed providers of StreamedRPCProtocol.        
      </p>
    </blockquote>
    <p>
      <strong>public StreamedRPCProtocol getStreamedProtocolByNameAndVersion(String name, String version)</strong>      
    </p>
    <p>
      Returns a StreamedRPCProtocol provider by protocol name and version.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        Any matching protocol or null if nothing matches.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the streamed protocol to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the streamed protocol to get.         
      </p>
    </blockquote>
    <p>
      <strong>public void addExternalProtocolListener(APSExternalProtocolListener externalServiceListener)</strong>      
    </p>
    <p>
      Add a listener for externally available services.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>externalServiceListener</em> - The listener to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeExternalProtocolListener(APSExternalProtocolListener externalServiceListener)</strong>      
    </p>
    <p>
      Removes a listener for externally available services.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>externalServiceListener</em> - The listener to remove.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSExternallyCallable&lt;ReturnType&gt; </strong> extends  Callable&lt;ReturnType&gt;    [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <p>
      This API represents one callable service method.      
    </p>
    <p>
      <strong>public String getServiceName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the service this callable is part of.        
      </p>
    </blockquote>
    <p>
      <strong>public String getServiceFunctionName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the service function this callable represents.        
      </p>
    </blockquote>
    <p>
      <strong>public DataTypeDescription getReturnDataDescription()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of the return type.        
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ParameterDataTypeDescription&gt; getParameterDataDescriptions()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of each parameter type.        
      </p>
    </blockquote>
    <p>
      <strong>public Bundle getServiceBundle()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The bundle the service belongs to.        
      </p>
    </blockquote>
    <p>
      <strong>public Class getServiceClass()</strong>      
    </p>
    <p>
      Returns the class of the service implementation.      
    </p>
    <p>
      <strong>ReturnType call(Object... arguments) throws Exception</strong>      
    </p>
    <p>
      Calls the service method represented by this APSExternallyCallable.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The return value of the method call if any or null otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>arguments</em> - Possible arguments to the call.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>Exception</em> - Any exception the called service method threw.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSExternalProtocolListener </strong>   [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <p>
      A listener for externally available services. Please note that this means that the service is available for potential external protocol exposure! For it to be truly available there also has to be a protocol and transport available. It is probably only transports that are interested in this information!      
    </p>
    <p>
      <strong>public void externalServiceAvailable(String service, String version)</strong>      
    </p>
    <p>
      This gets called when a new externally available service becomes available.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The fully qualified name of the newly available service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the service.         
      </p>
    </blockquote>
    <p>
      <strong>public void externalServiceLeaving(String service, String version)</strong>      
    </p>
    <p>
      This gets called when an externally available service no longer is available.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The fully qualified name of the service leaving.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the service.         
      </p>
    </blockquote>
    <p>
      <strong>public void protocolAvailable(String protocolName, String protocolVersion)</strong>      
    </p>
    <p>
      This gets called when a new protocol becomes available.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>protocolName</em> - The name of the protocol.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>protocolVersion</em> - The version of the protocol.         
      </p>
    </blockquote>
    <p>
      <strong>public void protocolLeaving(String protocolName, String protocolVersion)</strong>      
    </p>
    <p>
      This gets called when a new protocol is leaving.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>protocolName</em> - The name of the protocol.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>protocolVersion</em> - The version of the protocol.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSRESTCallable </strong> extends  APSExternallyCallable    [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <p>
      This is a special variant of APSExternallyCallable that supports a HTTP REST call.      
    </p>
    <p>
      This is only available when a service have zero or one method whose name starts with put, zero or one method whose name starts with post, and so on. There has to be at least one method of put, post, get or delete.      
    </p>
    <p>
      APSExternalProtocolService can provide an instance of this is a service matches the criteria.      
    </p>
    <p>
      This is only of use for HTTP transports! aps-ext-protocol-http-transport-provider does make use of this for protocols that indicate they support REST.      
    </p>
    <p>
      <strong>public boolean supportsPut()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if the service supports the PUT method.        
      </p>
    </blockquote>
    <p>
      <strong>public boolean supportsPost()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if the service supports the POST method.        
      </p>
    </blockquote>
    <p>
      <strong>public boolean supportsGet()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if the service supports the GET method.        
      </p>
    </blockquote>
    <p>
      <strong>public boolean supportsDelete()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if the service supports the DELETE method.        
      </p>
    </blockquote>
    <p>
      <strong>public void selectMethod(HttpMethod method)</strong>      
    </p>
    <p>
      This selects the method to call with this callable.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>method</em> - The selected method to call.         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>enum</em> <strong>HttpMethod </strong>   [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <p>
      This defines the valid choices for selectMethod(...).      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSRESTException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <p>
      This is a special exception that services can throw if they are intended to be available as REST services through the aps-external-protocol-extender + aps-ext-protocol-http-transport-provider. This allows for better control over status codes returned by the service call.      
    </p>
    <p>
            
    </p>
    <p>
      <strong>public APSRESTException(int httpStatusCode)</strong>      
    </p>
    <p>
      Creates a new <em>APSRESTException</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <p>
      <strong>public APSRESTException(int httpStatusCode, String message)</strong>      
    </p>
    <p>
      Creates a new <em>APSRESTException</em>.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - An error messaging.         
      </p>
    </blockquote>
    <p>
      <strong>public int getHttpStatusCode()</strong>      
    </p>
    <p>
      Returns the http status code.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>enum</em> <strong>ErrorType </strong>   [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <p>
      This defines what I think is a rather well though through set of error types applicable for an RPC call. No they are not mine, they come from Matt Morley in his JSONRPC 2.0 specification at <a href='http://jsonrpc.org/spec.html' title=''>http://jsonrpc.org/spec.html</a>.      
    </p>
    <p>
      I did however add the following:      
    </p>
    <ul>
      <li>
        <p>
           SERVICE_NOT_FOUND - Simply because this can happen in this case!          
        </p>
      </li>
      <li>
        <p>
           AUTHORIZATION_REQUIRED - This is also a clear possibility.          
        </p>
      </li>
      <li>
        <p>
           BAD_AUTHORIZATION          
        </p>
      </li>
    </ul>
    <p>
      <strong>PARSE_ERROR</strong>      
    </p>
    <p>
      Invalid input was received by the server. An error occurred on the server while parsing request data.      
    </p>
    <p>
      <strong>INVALID_REQUEST</strong>      
    </p>
    <p>
      The request data sent is not a valid.      
    </p>
    <p>
      <strong>METHOD_NOT_FOUND</strong>      
    </p>
    <p>
      The called method does not exist / is not available.      
    </p>
    <p>
      <strong>SERVICE_NOT_FOUND</strong>      
    </p>
    <p>
      The called service does not exist / is not available.      
    </p>
    <p>
      <strong>INVALID_PARAMS</strong>      
    </p>
    <p>
      The parameters to the method are invalid.      
    </p>
    <p>
      <strong>INTERNAL_ERROR</strong>      
    </p>
    <p>
      Internal protocol error.      
    </p>
    <p>
      <strong>SERVER_ERROR</strong>      
    </p>
    <p>
      Server related error.      
    </p>
    <p>
      <strong>AUTHORIZATION_REQUIRED</strong>      
    </p>
    <p>
      Authorization is required, but none was supplied.      
    </p>
    <p>
      <strong>BAD_AUTHORIZATION</strong>      
    </p>
    <p>
      Bad authorization was supplied.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>HTTPError </strong> extends  RPCError    [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <p>
      Extends <em>RPCError</em> with an HTTP status code. HTTP transports can make use of this information.      
    </p>
    <p>
      <strong>public int getHttpStatusCode()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        Returns an http status code.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCError </strong>   [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <p>
      This represents an error in servicing an RPC request.      
    </p>
    <p>
      <strong>public ErrorType getErrorType()</strong>      
    </p>
    <p>
      The type of the error.      
    </p>
    <p>
      <strong>public String getErrorCode()</strong>      
    </p>
    <p>
      A potential error code.      
    </p>
    <p>
      <strong>public String getMessage()</strong>      
    </p>
    <p>
      Returns an error messaging. This is also optional.      
    </p>
    <p>
      <strong>public boolean hasOptionalData()</strong>      
    </p>
    <p>
      True if there is optional data available. An example of optional data would be a stack trace for example.      
    </p>
    <p>
      <strong>public String getOptionalData()</strong>      
    </p>
    <p>
      The optional data.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>RequestedParamNotAvailableException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.net.rpc.exceptions] {      
    </p>
    <p>
      This exception is thrown when a parameter request cannot be fulfilled.      
    </p>
    <p>
      <strong>public RequestedParamNotAvailableException(String message)</strong>      
    </p>
    <p>
      Creates a new <em>RequestedParamNotAvailableException</em> instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <p>
      <strong>public RequestedParamNotAvailableException(String message, Throwable cause)</strong>      
    </p>
    <p>
      Creates a new <em>RequestedParamNotAvailableException</em> instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception messaging.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of this exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>abstract</em> <em>class</em> <strong>AbstractRPCRequest </strong> implements  RPCRequest    [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <p>
      This provides a partial implementation of RPCRequest.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public AbstractRPCRequest(String method)</strong>      
    </p>
    <p>
      Creates a new AbstractRPCRequest.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>method</em> - The method to call.         
      </p>
    </blockquote>
    <p>
      <strong>public AbstractRPCRequest(RPCError error)</strong>      
    </p>
    <p>
      Creates a new AbstractRPCRequest.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>error</em> - An RPCError indicating a request problem, most probably of ErrorType.PARSE_ERROR type.         
      </p>
    </blockquote>
    <p>
      <strong>public AbstractRPCRequest(String method, Object callId)</strong>      
    </p>
    <p>
      Creates a new AbstractRPCRequest.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>method</em> - The method to call.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>callId</em> - The callId of the call.         
      </p>
    </blockquote>
    <p>
      <strong>protected Map&lt;String, Object&gt; getNamedParameters()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The named parameters.        
      </p>
    </blockquote>
    <p>
      <strong>protected List&lt;Object&gt; getParameters()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The sequential parameters.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void setServiceQName(String serviceQName)</strong>      
    </p>
    <p>
      Sets the fully qualified name of the service to call. This is optional since not all protocol delivers a service name this way.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceQName</em> - The service name to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void addParameter(Object parameter)</strong>      
    </p>
    <p>
      Adds a parameter. This is mutually exclusive with addParameter(name, parameter)!      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>parameter</em> - The parameter to add.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>enum</em> <strong>RequestIntention </strong>   [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <p>
      The intention of a request.      
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCExceptionConverter </strong>   [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <p>
      An instance of this can be passed to RPCRequest to convert the cauth exception to an RPCError.      
    </p>
    <p>
      <strong>RPCError convertException(Exception e)</strong>      
    </p>
    <p>
      This should be called on any service exception to convert the exception to an RPCError.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>e</em> - The exception to convert.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCRequest </strong>   [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <p>
      This represents a request returned by protocol implementations.      
    </p>
    <p>
      <strong>boolean isValid()</strong>      
    </p>
    <p>
      Returns true if this request is valid. If this returns false all information except <em>getError()</em> is <strong>invalid</strong>, and <em>getError()</em> should return a valid <em>RPCError</em> object.      
    </p>
    <p>
      <strong>RPCError getError()</strong>      
    </p>
    <p>
      Returns an <em>RPCError</em> object if <code>isValid() == false</code>, <em>null</em> otherwise.      
    </p>
    <p>
      <strong>RPCExceptionConverter getExceptionConverter()</strong>      
    </p>
    <p>
      If an exception occurred during the request call, and this returns non null, then the returned converter should be called with the occurred exception to provide an RPCError.      
    </p>
    <p>
      This allows for a specific protocol implementation to handle its own exceptions and provide an appropriate RPCError.      
    </p>
    <p>
      <strong>String getServiceQName()</strong>      
    </p>
    <p>
      Returns a fully qualified name of service to call. This will be null for protocols where service name is not provided this way. So this cannot be taken for given!      
    </p>
    <p>
      <strong>String getMethod()</strong>      
    </p>
    <p>
      Returns the method to call. This can return <em>null</em> if the method is provided by other means, for example a REST protocol where it will be part of the URL.      
    </p>
    <p>
      <strong>boolean hasCallId()</strong>      
    </p>
    <p>
      Returns true if there is a call id available in the request.      
    </p>
    <p>
      A call id is something that is received with a request and passed back with the response to the request. Some RPC implementations will require this and some wont.      
    </p>
    <p>
      <strong>Object getCallId()</strong>      
    </p>
    <p>
      Returns the method call call Id.      
    </p>
    <p>
      A call id is something that is received with a request and passed back with the response to the request. Some RPC implementations will require this and some wont.      
    </p>
    <p>
      <strong>RequestIntention getRequestIntention()</strong>      
    </p>
    <p>
      Returns the intention of the request.      
    </p>
    <p>
      <strong>int getNumberOfParameters()</strong>      
    </p>
    <p>
      Return the number of parameters available.      
    </p>
    <p>
      <strong>&lt;T&gt; T getIndexedParameter(int index, Class&lt;T&gt; paramClass) throws RequestedParamNotAvailableException</strong>      
    </p>
    <p>
      Returns the parameter at the specified index.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The parameter object or null if indexed parameters cannot be delivered.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>index</em> - The index of the parameter to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>paramClass</em> - The expected class of the parameter.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>RequestedParamNotAvailableException</em> - if requested parameter is not available.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCProtocol </strong>   [se.natusoft.osgi.aps.api.net.rpc.service] {      
    </p>
    <p>
      This represents an RPC protocol provider. This API is not enough in itself, it is a common base for different protocols.      
    </p>
    <p>
      <strong>String getServiceProtocolName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the provided protocol.        
      </p>
    </blockquote>
    <p>
      <strong>String getServiceProtocolVersion()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The version of the implemented protocol.        
      </p>
    </blockquote>
    <p>
      <strong>String getRequestContentType()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The expected content type of a request. This should be verified by the transport if it has content type availability.        
      </p>
    </blockquote>
    <p>
      <strong>String getResponseContentType()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The content type of the response for when such can be provided.        
      </p>
    </blockquote>
    <p>
      <strong>String getRPCProtocolDescription()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A short description of the provided service. This should be in plain text.        
      </p>
    </blockquote>
    <p>
      <strong>RPCError createRPCError(ErrorType errorType, String message, String optionalData, Throwable cause)</strong>      
    </p>
    <p>
      Factory method to create an error object.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An RPCError implementation or null if not handled by the protocol implementation.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorType</em> - The type of the error.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - An error messaging.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>optionalData</em> - Whatever optional data you want to pass along or null.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of the error.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>StreamedRPCProtocol </strong> extends  RPCProtocol    [se.natusoft.osgi.aps.api.net.rpc.service] {      
    </p>
    <p>
      This represents an RPC protocol provider that provide client/service calls with requests read from an InputStream or having parameters passes as strings and responses written to an OutputStream.      
    </p>
    <p>
      HTTP transports can support both <em>parseRequests(...)</em> and <em>parseRequest(...)</em> while other transports probably can handle only <em>parseRequests(...)</em>. <strong>A protocol provider can return null for either of these!</strong> Most protocol providers will support <em>parseRequests(...)</em> and some also <em>parseRequest(...)</em>.      
    </p>
    <p>
      <strong>List&lt;RPCRequest&gt; parseRequests(String serviceQName, Class serviceClass, String method, InputStream requestStream, RequestIntention requestIntention) throws IOException</strong>      
    </p>
    <p>
      Parses a request from the provided InputStream and returns 1 or more RPCRequest objects.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The parsed requests.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceQName</em> - A fully qualified name to the service to call. This can be null if service name is provided on the stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>serviceClass</em> - The class of the service to call. Intended for looking for method annotations! Don't try to be "smart" here!         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>method</em> - The method to call. This can be null if method name is provided on the stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requestStream</em> - The stream to parse request from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requestIntention</em> - The intention of the request (CRUD + UNKNOWN).         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>RPCRequest parseRequest(String serviceQName, Class serviceClass, String method, Map&lt;String, String&gt; parameters, RequestIntention requestIntention) throws IOException</strong>      
    </p>
    <p>
      Provides an RPCRequest based on in-parameters. This variant supports HTTP transports.      
    </p>
    <p>
      Return null for this if the protocol does not support this!      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The parsed requests.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceQName</em> - A fully qualified name to the service to call. This can be null if service name is provided on the stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>serviceClass</em> - The class of the service to call. Intended for looking for method annotations! Don't try to be "smart" here!         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>method</em> - The method to call. This can be null if method name is provided on the stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>parameters</em> - parameters passed as a         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requestIntention</em> - The intention of the request (CRUD + UNKNOWN).         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>void writeResponse(Object result, RPCRequest request, OutputStream responseStream) throws IOException</strong>      
    </p>
    <p>
      Writes a successful response to the specified OutputStream.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>result</em> - The resulting object of the RPC call or null if void return. If is possible a non void method also returns null!         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>request</em> - The request this is a response to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>responseStream</em> - The OutputStream to write the response to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>boolean writeErrorResponse(RPCError error, RPCRequest request, OutputStream responseStream) throws IOException</strong>      
    </p>
    <p>
      Writes an error response.      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if this call was handled and an error response was written. It returns false otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>error</em> - The error to pass back.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>request</em> - The request that this is a response to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>responseStream</em> - The OutputStream to write the response to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSExtProtocolHTTPTransportProvider</H1>
    <p>
      This provides an http transport for simple remote requests to OSGi services that have "APS-Externalizable: true" in their META-INF/MANIFEST.MF. This follows the OSGi extender pattern and makes any registered OSGi services of bundles having the above manifest entry available for remote calls over HTTP. This transport makes use of the aps-external-protocol-extender which exposes services with the above mentioned manifest entry with each service method available as an APSExternallyCallable.The aps-ext-protocol-http-transport-provider for example acts as a mediator between the protocol implementations and aps-external-protocol-extender for requests over HTTP.      
    </p>
    <p>
      Please note that depending on protocol not every service method will be callable. It depends on its arguments and return value. It mostly depends on how well the protocol handles types and can convert between the caller and the service.      
    </p>
    <p>
      This does not provide any protocol, only transport! For services to be able to be called at least one protocol is needed. Protocols are provided by providing an implementation of se.natusoft.osgi.aps.api.net.rpc.service.StreamedRPCProtocol and registering it as an OSGi service. The StreamedRPCProtocol API provides a protocol name and protocol version getter which is used to identify it. A call to an RPC service looks like this:      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;http://host:port/apsrpc/<em>protocol</em>/<em>version</em>[/<em>service</em>][/<em>method</em>]      
    </p>
    <p>
      <em>protocol</em> - This is the name of the protocol to use. An implementation of that protocol must of course be available for this to work. If it isn't you will get a 404 back! The protocol service (RPCProtocol&lt;-StreamedRPCProtocol) provides a name for each protocol. It is this name that is referenced.      
    </p>
    <p>
      <em>version</em> - This is the version of the protocol. If this doesn't match any protocols available you will also get a 404 back.      
    </p>
    <p>
      <em>service</em> - This is the service to call. Depending on the protocol you might not need this. But for protocols that only provide method in the stream data like JSONRPC for example, then this is needed. When provided it has to be a fully qualified service interface class name.      
    </p>
    <p>
      <em>method</em> - This is the method to call. The need for this also depends on the protocol. A REST protocol would need it. The JSONRPC protocol does not. When this is specified in the URL then it will be used even if the protocol provides the method in the request! Please note that a method can be specified on two ways:      
    </p>
    <ul>
      <li>
        <p>
           method(type,...)          
        </p>
      </li>
      <li>
        <p>
           method          
        </p>
      </li>
    </ul>
    <p>
      The method will be resolved in that order. The parameter type specifying version is required when there are several methods with the same name but different parameters. The method name only will give you the last one in that case.      
    </p>
    <H2>Examples</H2>
    <p>
      See examples under the <strong>APSStreamedJSONRPCProtocolProvider</strong> section.      
    </p>
    <H2>Authentication</H2>
    <p>
      Authentication for services are provided in 2 ways. Both require a userid and a password and both validate the user using the APSAuthService.      
    </p>
    <p>
      The 2 alternatives are:      
    </p>
    <ul>
      <li>
        <p>
           http://.../apsrpc/<strong>auth:user:password</strong>/protocol/...          
        </p>
      </li>
      <li>
        <p>
           Basic HTTP authentication using header: 'Authorization: Basic {<em>base 64 encoded user:password</em>}’.          
        </p>
      </li>
    </ul>
    <p>
      One of these will be required if the <em>requireAuthentication</em> configuration have been enabled.      
    </p>
    <H2>The help web</H2>
    <p>
      Opening the <em>http://.../apsrpc/_help/</em> URL will give you a web page that provides a lot of information. This page requires authentication since it register itself with the APSAdminWeb (/apsadminweb) as ”Remote Services” and appears there as a tab, and thus joins in with the APSAdminWeb authentication.      
    </p>
    <p>
      In addition to much of the same information as in this documentation it also lists all protocols tracked by the <em>APSExternalProtocolExtender</em> with their name, version, description, and other properties. Next it lists all services that <em>APSExternalProtocolExtender</em> provides as callable. Each of these services are a link that can be clicked. Clicking on a service will show all the methods of the service and then list the call url for each method per protocol. Each method listed is also a link, and clicking that link will give you a page where you can provide arguments and then press execute to call the service. The result will be displayed as JSON on the same page. This is very useful for testing and debugging services.      
    </p>
    <H2>See Also</H2>
    <p>
      Also look at the documentation for APSExternalProtocolExtender.      
    </p>
    <H1>APS RabbitMQ Message Service Provider</H1>
    <p>
      This service provides an implementation of APSMessageService using <a href='http://www.rabbitmq.com/' title=''>RabbitMQ</a>.      
    </p>
    <p>
      <strong>Note:</strong> This implementation does not support <em>contentType</em> in the API. When sending messages the <em>contentType</em> will be ignored, and when messages are received the <em>contentType</em> will always be "UNKNOWN".      
    </p>
    <p>
      A good suggestion is to always use JSON or XML as content.      
    </p>
    <H2>APSMessageService API</H2>
    <p>
      <a href='http://apidoc.natusoft.se/APS/se/natusoft/osgi/aps/api/net/messaging/service/APSMessageService.html' title=''>Javadoc</a>      
    </p>
    <H1>APSStreamedJSONRPCProtocolProvider</H1>
    <p>
      This provides JSONRPC protocol. It provides both version 1.0 and 2.0 of the protocol. It requires a transport that uses it and services provided by aps-external-protocol-extender to be useful.      
    </p>
    <p>
      The URL format for all of these looks like this:      
    </p>
    <pre>
      <code>
    http(s)://host:port/apsrpc/{protocol}/{protocol version}/{service}[/{method}][?params=...]
      </code>
    </pre>
    <p>
      Where:      
    </p>
    <p>
      <em>{protocol}</em> is one of the below described protocols.      
    </p>
    <p>
      <em>{protocol version}</em> is the version of the specified protocol.      
    </p>
    <p>
      <em>{service}</em> is the name of the service to call. Safest is to use a fully qualified name, that is inlcuding package since that will make the service specification unique. It is however possible to only specify the name of the service in which case the first matching will be used.      
    </p>
    <p>
      <em>{method}</em> is the method of the service to call. In the case of JSONREST the method can be skipped and a method will be found based on the HTTP method used to make the call.      
    </p>
    <H2>JSONRPC version 1.0</H2>
    <p>
      This protocol is described at <a href='http://json-rpc.org/wiki/specification' title=''>http://json-rpc.org/wiki/specification</a>.      
    </p>
    <H2>JSONRPC version 2.0</H2>
    <p>
      This protocol is describved at <a href='http://jsonrpc.org/spec.html' title=''>http://jsonrpc.org/spec.html</a>.      
    </p>
    <H2>JSONHTTP version 1.0</H2>
    <p>
      This is not any standard protocol at all. It requires both service name and method name on the url, and in case of HTTP GET or DELETE also arguments as ?params=arg:...:arg where values are strings or primitives. For POST, and PUT a JSON array of values need to be written on the stream.      
    </p>
    <H2>JSONREST version 1.0</H2>
    <p>
      This provides a loose API of REST type. It will return HTTP error code on any failure. It has several options for calling. It is possible to specify both service and method to call, but if the method is omitted then a method will be deduced by the HTTP method used.      
    </p>
    <p>
      For HTTP method POST methods starting with one of the following will be matched: <em>create</em>, <em>post</em>, <em>new</em>.      
    </p>
    <p>
      For HTTP method GET methods starting with one of the following will be matched: <em>read</em>, <em>get</em>.      
    </p>
    <p>
      For HTTP method PUT methods starting with one of the following will be matched: <em>update</em>, <em>put</em>, <em>set</em>, <em>write</em>.      
    </p>
    <p>
      For HTTP method DELETE methods starting with one of the following will be matched: <em>delete</em>, <em>remove</em>.      
    </p>
    <p>
      JSONREST actually extends JSONHTTP and inherits some of its features, like the <em>params=arg:...:arg</em> parameter. It however adds an own parameter feature: If a service method takes one Map<a href='String, String' title=''>String, String</a> as parameter, all specified HTTP GET parameters will be provided in this Map.      
    </p>
    <p>
      <strong>Also note</strong> that for GET and DELETE '...?params=...' must be used to provide parameters to the call, with the above mentioned exception, while for POST and PUT JSON must be provided on the request stream.      
    </p>
    <H2>Examples</H2>
    <p>
      Here is some examples calling services over http with diffent protocols using curl (<em>requires aps-ext-protocol-http-transport-provider.jar and the called services to be deployed,</em><em> and specified as externalizable via configuration</em> (Network/service/external-protocol-extender)):      
    </p>
    <pre>
      <code>
    curl --data '{"jsonrpc": "2.0", "method": "getPlatformDescription", "params": [], "id": 1}' http://localhost:8080/apsrpc/JSONRPC/2.0/se.natusoft.osgi.aps.api.core.platform.service.APSPlatformService
      </code>
    </pre>
    <p>
      yields      
    </p>
    <pre>
      <code>
    {"id": 1, "result": {"description": "My personal development environment.", "type": "Development", "identifier": "MyDev"}, "jsonrpc": "2.0"}
      </code>
    </pre>
    <p>
      while      
    </p>
    <pre>
      <code>
    curl --get http://localhost:8080/apsrpc/JSONHTTP/1.0/se.natusoft.osgi.aps.api.core.platform.service.APSPlatformService/getPlatformDescription
      </code>
    </pre>
    <p>
      yields      
    </p>
    <pre>
      <code>
    {"description": "My personal development environment.", "type": "Development", "identifier": "MyDev"}
      </code>
    </pre>
    <p>
      and      
    </p>
    <pre>
      <code>
    curl --get http://localhost:8080/apsrpc/JSONHTTP/1.0/se.natusoft.osgi.aps.api.misc.session.APSSessionService/createSession\(Integer\)?params=5
      </code>
    </pre>
    <p>
      yields      
    </p>
    <pre>
      <code>
    {"id": "6d25d646-11fc-44c3-b74d-29b3d5c94920", "valid": true}
      </code>
    </pre>
    <p>
      In this case we didn't just use <em>createSession</em> as method name, but <em>createSession(Integer)</em> though with parentheses escaped to not confuse the shell. This is because there is 2 variants of createSession: createSession(String, Integer) and createSession(Integer). If we don't specify clearly we might get the wrong one and in this case that happens and will fail due to missing second parameter. Also note the <em>params=5</em>. On get we cannot pass any data on the stream to the service, we can only pass parameters on the URL which is done by specifying url parameter <em>params</em> with a colon (:) separated list of parameters as value. In this case only String and primitives are supported for parameters.      
    </p>
    <p>
      The following is also valid:      
    </p>
    <pre>
      <code>
    curl --get http://localhost:8080/apsrpc/JSONHTTP/1.0/APSPlatformService/getPlatformDescription
      </code>
    </pre>
    <p>
      Note that this is much shorter. It does not provide a fully qualified name for the APSPlatformService. This is OK. As long as the service name is unique even without package it will be found correctly. The odds of having 2 services with the same name in different packages are quite small so this is rather safe to do.      
    </p>
    <p>
      <strong>Note:</strong> These examples only works if you have disabled the <em>requireAuthentication</em> configuration (network/rpc-http-transport).      
    </p>
    <H2>See also</H2>
    <p>
      Se the documentation for <em>APSExtProtocolHTTPTransportProvider</em> for an HTTP transport through which these protocols can be used.      
    </p>
    <p>
      Se the documentation for <em>APSExternalProtocolExtender</em> for a description of how services are made available and what services it provides for transport providers.      
    </p>
    <H1>APSTCPIPService</H1>
    <p>
      This service provides, in ways of communication, plain simple TCP/IP communication. Users of this service will however have very little contact with the java.net classes.      
    </p>
    <p>
      The following are the points of this service:      
    </p>
    <ul>
      <li>
        <p>
           Simple TCP/IP usage.          
        </p>
      </li>
      <li>
        <p>
           Makes use of an URI to provide what I call a "connection point". tcp:, udp:, and multicast: are supported protocols.          
        </p>
      </li>
    </ul>
    <p>
      Do note that you do need to have a basic understanding of TCP/IP to use this service!      
    </p>
    <H2>Security</H2>
    <p>
      Makes use of 2 separate services if available for security: <em>APSTCPSecurityService</em> and <em>APSUDPSecurityService</em>. Neither these nor APSTCPIPService makes any assumptions nor demands on the what and how of the security services implementations. The APSTCPSecurityService must provide secure versions of Socket and ServerSocket, while APSUDPSecureService have 2 methods, one to encrypt the data and one to decrypt the data in a DatagramPacket.      
    </p>
    <p>
      APS currently does not provide any implementation of the APS(TCP/UDP)SecurityService.      
    </p>
    <H2>Connection Point URIs</H2>
    <p>
      The service makes use of URIs to specify where to connect for sending or receiving.      
    </p>
    <p>
      The URI format is this:      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;<strong>protocol://host:port#fragment,fragment</strong>      
    </p>
    <p>
      Protocols:      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;<strong>tcp,</strong><strong> udp,</strong><strong> multicast,</strong><strong> named</strong>      
    </p>
    <p>
      The <em>named</em> protocol just provides a name for the <em>host</em> part of the URI. This is not however a hostname! It is a name that has been entered in the service configuration and which has an URI value which will be used instead. So<em> named://mysvc</em> will lookup a config value having "mysvc" as destination name and use its destination URI as connection URI. So the valid URI protocols in the configuration is then tcp, udp, and multicast.      
    </p>
    <p>
      Fragments:      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;<strong>secure</strong> - If specified then one of the APS(TCP/UDP)SecurityService services will be used.      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;<strong>async</strong> (only valid on <em>tcp</em> protocol)      
    </p>
    <H2>Examples</H2>
    <H3>TCP</H3>
    <H4>Write</H4>
    <pre>
      <code>
    APSTCPIPService tcpipSvc;
    ...
    tcpipSvc.sendStreamedRequest(new URI("tcp://localhost:9999"), new StreamedRequest() {
        void sendRequest(URI connectionPoint, OutputStream requestStream, InputStream responseStream) throws IOException {
            // write to requestStream ...
    
            // read from response stream ...
        }
    })
      </code>
    </pre>
    <H4>Read</H4>
    <pre>
      <code>
    APSTCPIPService tcpipSvc;
    ...
    tcpipSvc.setStreamedRequestListener(new URI("tcp://localhost:9999"), this);
    ...
    void requestReceived(URI receivePoint, InputStream requestStream, OutputStream responseStream) {
        // Read request from reqStream ...
    
        // Write response to respStream ...
    }
      </code>
    </pre>
    <p>
      Note that there can only be one listener per URI.      
    </p>
    <H3>UDP / Multicast</H3>
    <p>
      Since Multicast uses UDP packets there is no difference between host and port connected UDP or Multicast. The only difference is in the URI where "udp://" is specified for UDP packets and "multicast://" is specified for multicast packets.      
    </p>
    <H4>Write</H4>
    <pre>
      <code>
    APSTCPIPService tcpipSvc;
    ...
    bytes[] bytes = "Some data".getBytes();
    tcpipSvc.sendDataPacket(new URI("udp://localhost:9999"),  bytes);
      </code>
    </pre>
    <p>
      or      
    </p>
    <pre>
      <code>
    tcpipSvc.sendDataPacket(new URI("multicast://all-systems.mcast.net:9999"), bytes);
      </code>
    </pre>
    <H4>READ</H4>
    <pre>
      <code>
    APSTCPIPService tcpipSvc;
    ...
    tcpipSvc.addDataPacketListener(new URI("udp://localhost:9999"), this);
    ...
    void dataBlockReceived(URI receivePoint, DatagramPacket packet) {
        byte[] bytes = packet.getData();
        ...
    }
      </code>
    </pre>
    <H2>aps-vertx-event-bus-messaging-provider</H2>
    <p>
      This provides an implementation of <em>APSMessageService</em> that uses the Vertx event bus for sending and receiving messages on the Vertx cluster. The topics are used as adresses in this case.      
    </p>
    <p>
      For more information on Vertx see: <a href='http://vertx.io/docs/vertx-core/groovy/' title=''>http://vertx.io/docs/vertx-core/groovy/</a>      
    </p>
    <H2>APSVertxTCPMessagingProvider</H2>
    <p>
      This is an implementation of <em>APSMessageService</em> that uses Vert.x to provide the TCP communication. It is dependent on the <strong>aps-vertx-provider</strong> bundle which provides reusable <em>Vertx</em> instances.      
    </p>
    <H3>Configuration</H3>
    <p>
      This bundle exposes a service interface: <code>APSVertxTCPMessagingOptions</code>. This should be implemented and published as an OSGi service. This provider will look for an implementation of that service and configure itself accoding to the supplied configuration.      
    </p>
    <p>
      Here is the API:      
    </p>
    <pre>
      <code>
    package se.natusoft.osgi.aps.net.messaging.vertx.api
    
    /**
     * This is a service API for providers of options to provide an implementation of.
     */
    interface APSVertxTCPMessagingOptions {
    
        /**
         * @return A Map containing Vert.x Net server options. Contents: name, value
         */
        Map&lt;String, Object&gt; getServerOptions()
    
        /**
         * @return A Map containing Vert.x Net client options. Contents: name, value.
         */
        Map&lt;String, Object&gt; getClientOptions()
    
        /**
         * @return Mappings between topic and the URI for the topic.
         */
        Map&lt;String, String&gt; getTopicToURIMapping()
    }
      </code>
    </pre>
    <p>
      Since this is build on top of Vert.x it takes Vertx options Map:s. See the Vertx <a href='http://vertx.io/docs/vertx-core/groovy/' title=''>documentation</a> for more info.      
    </p>
    <p>
      The topic to URI mapping is a simple mapping per topic what it should listen to for received messages and where it should send published messages.      
    </p>
    <p>
      Here is an example from the test code:      
    </p>
    <pre>
      <code>
    Map&lt;String, String&gt; getTopicToURIMapping() {
        return [
                testOne:   "tcp://localhost:13987?inst=4#in,tcp://localhost:13988/?inst=2#out,tcp://localhost:13989/#out",
                testTwo:   "tcp://localhost:13988?inst=2#in,tcp://localhost:13987/#out,tcp://localhost:13989/#out",
                testThree: "tcp://localhost:13989/#in,tcp://localhost:13988/#out,tcp://localhost:13987/#out"
        ]
    }
      </code>
    </pre>
    <p>
      Note that this is Groovy syntax, but it shold be self explanatory what is topic and what is URIs :-).      
    </p>
    <ul>
      <li>
        <p>
           There are commas between each URI.          
        </p>
      </li>
      <li>
        <p>
           The protocol is always 'tcp'.          
        </p>
      </li>
      <li>
        <p>
           The fragment part (#) has either an "in" or and "out". This is required. There should always only be one #in, and one or more #out.          
        </p>
      </li>
      <li>
        <p>
           The only query is <em>inst=n</em> This is optional.          
        </p>
      </li>
      <ul>
        <li>
          <p>
             For an #in <em>inst</em> number of services listening on host and port of the URI will be created. This is how Vert.x distributes service jobs across processor cores. There should be at least as many as there are cores if you want to utilize the processor to its fullest.            
          </p>
        </li>
        <li>
          <p>
             For an #out there will be a pool of clients that will hold at most <em>inst</em> number of clients. This is for multiple threads to be able to send messages to the same topic. Each client instance will have its own connection to the receiving service. If the pool gets full and no clients are free then a new client will be created, and then deleted again. A warning will be displayed on the log in this case.            
          </p>
        </li>
      </ul>
    </ul>
    <p>
      As can be seen in the example above, each topic has one service (#in) and 2 clients (#out), one for each of the other 2 topics. So these 3 topics send their messages to the other 2, whatever is sent by one the other 2 will get.      
    </p>
    <H1>APSAdminWeb</H1>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Webs/APSAdminWeb/docs/images/APSAdminWeb.png' title='' alt='APSAdminWeb screenshot'/>      
    </p>
    <p>
      This is a web app for administration of APS. It is really only a shell for different administraion webs. It relys on the <em>aps-admin-web-service-provider</em> bundle which publishes the <em>APSAdminWebService</em>. Other bundles providing administration web apps register themselves with this service and for each registration APSAdminWeb creates a tab in its gui. Se <em>APIs</em> further down for the APSAdminService API. Clicking on ”Refresh” will make APSAdminWeb reload the admin webs registered in <em>APSAdminWebService</em>.      
    </p>
    <p>
      The APSAdminWeb is accessed at <strong>http://host:port/apsadminweb</strong>. What you see there depends on what other admin webs are deployed. Anybody can make an admin web and register it with the <em>APSAdminWebService</em>. The admin webs delivered with APS are mainly done using Vaadin. This is in no way a requirement for an admin web. An admin web app can be made in any way what so ever. A side effect of this is that different tabs might have different look and feel. But I choose flexibility over beauty!      
    </p>
    <p>
      The following APS bundles provides a tab in APSAdminWeb:      
    </p>
    <ul>
      <li>
        <p>
           <em>aps-config-admin-web.war</em> - Allows advanced configuration of bundles/services using APSConfigService.          
        </p>
      </li>
      <li>
        <p>
           <em>aps-user-admin-web-war</em> - Administration of users and groups for APSSimpleUserService.          
        </p>
      </li>
      <li>
        <p>
           <em>aps-ext-protocol-http-transport-provider.war</em> - Provides a web gui with help for setting up and calling services remotely, and also shows all available services and allows calling them from the web gui for testing/debugging purposes.          
        </p>
      </li>
    </ul>
    <H2>Authentication</H2>
    <p>
      If <em>”Configuration tab,</em><em> Configurations/aps/adminweb/requireauthentication”</em> property is enabled then the APSAdminWeb requires a login to be accessed. A userid and a password will be asked for. The entered information will be validated by the APSAuthService. The <em>aps-simple-user-service-auth-service-provider.jar</em> bundle provides an implementation of this service that uses the <em>APSSimpleUserService</em> service. The APSAuthService is however simple enough to implement yourself to provide login to whatever you want/need.      
    </p>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Webs/APSAdminWeb/docs/images/APSAdminWeb-login.png' title='' alt='APSAdminWeb login screenshot'/>      
    </p>
    <H2>Making an admin web participating in the APSAdminWeb login.</H2>
    <p>
      There is an APSSessionService that was made just for handling this. It is not a HTTP session, just a service hanling sessions. It is provided by the <em>aps-session-service-provider.jar</em> bundle. When a session is created you get a session id (an UUID) that needs to be passed along to the other admin webs through a cookie. <em>APSWebTools</em> (<em>aps-web-tools.jar</em> (not a bundle!)) provides the APSAdminWebLoginHandler class implementing the LoginHandler interface and handles all this for you.      
    </p>
    <p>
      You need to provide it with a BundleContext on creation since it will be calling both the <em>APSAuthService</em> and <em>APSSessionService</em>:      
    </p>
    <pre>
      <code>
    this.loginHandler = new APSAdminWebLoginHandler(bundleContext);
    
      </code>
    </pre>
    <p>
      Then to validate that there is a valid login do:      
    </p>
    <pre>
      <code>
    this.loginHandler.setSessionIdFromRequestCookie(request);
    if (this.loginHandler.hasValidLogin()) {
        ...
    }
    else {
        ...
    }
      </code>
    </pre>
    <H2>APSAdminWebService APIs</H2>
    <p>
      public <em>interface</em> <strong>APSAdminWebService </strong>   [se.natusoft.osgi.aps.apsadminweb.service] {      
    </p>
    <p>
      This service registers other specific administration web applications to make them available under a common administration gui.      
    </p>
    <p>
      <strong>public void registerAdminWeb(AdminWebReg adminWebReg) throws IllegalArgumentException</strong>      
    </p>
    <p>
      Registers an admin web application.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>adminWebReg</em> - Registration information for the admin web.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IllegalArgumentException</em> - if the admin web has already been registered or if it is using the         
      </p>
    </blockquote>
    <p>
      <strong>public void unregisterAdminWeb(AdminWebReg adminWebReg)</strong>      
    </p>
    <p>
      Unregisters a previously registered admin web. This is failsafe. If it has not been registered nothing happens.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>adminWebReg</em> - Registration information for the admin web. Use the same as registered with.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;AdminWebReg&gt; getRegisteredAdminWebs()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All currently registered admin webs.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>AdminWebReg </strong>   [se.natusoft.osgi.aps.apsadminweb.service.model] {      
    </p>
    <p>
      This model holds information about a registered admin web application.      
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public AdminWebReg(String name, String version, String description, String url)</strong>      
    </p>
    <p>
      Creates a new AdminWebReg instance.      
    </p>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - A (short) name of the admin web.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the admin web.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>description</em> - A longer description of the admin web.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>url</em> - The deployment url of the admin web.         
      </p>
    </blockquote>
    <p>
      <strong>public String getName()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The (short) name of the admin web.        
      </p>
    </blockquote>
    <p>
      <strong>public String getVersion()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The version of the admin web.        
      </p>
    </blockquote>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The description of the admin web.        
      </p>
    </blockquote>
    <p>
      <strong>public String getUrl()</strong>      
    </p>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The deployment url of the admin web.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSConfigAdminWeb</H1>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Webs/APSConfigAdminWeb/docs/images/APSConfigWeb-simple-small.png' title='' alt='APSConfigAdminWeb screenshot'/>       <img src='http://download.natusoft.se/Images/APS/APS-Webs/APSConfigAdminWeb/docs/images/APSConfigWeb-structured-small.png' title='' alt='APSConfigAdminWeb screenshot'/>      
    </p>
    <p>
      This allows editing configurations registered with the <em>APSConfigService</em>. Configurations are only available in the APSConfigAdminWeb while the bundle providing the configuration model are deployed. The actual saved configurations live on disk and remains after a bundle is stopped. It will be available again when the bundle is started again. But the bundle have to be running and regisitering its configuration with the <em>APSConfigService</em> for them to be editable in this admin app!      
    </p>
    <p>
      As can be seen in the screenshots above it provides a simpler gui for simple configs, and a more advanced gui for structured configurations containing list of other configuration models.      
    </p>
    <H2>Config Environments</H2>
    <p>
      Under this node all available configuration environments are listed. Right clicking on the node will drop down a menu alternative to create a new configuration environment. Right clicking on a configuration environment pops up a menu that allows it to be set as active configuration environment or to delete the configuration environment. Just clicking on a configuration environment allows it to be edited on the right side. The active configuration environment cannot however be edited, only viewed.      
    </p>
    <H2>Configurations</H2>
    <p>
      This tree cannot be edited. What is here is the configurations registered by bundles. They can be selected to edit the selected configuration to the right. The screenshots above shows 2 examples of such. Please note that the screenshots were taken on a Mac with Mountain Lion and thus does not show scrollbars unless scrolling. The right side of the second screenshot where things are slightly cutoff at the bottom are scrollable!      
    </p>
    <p>
      On top of the right side box there is a dropdown menu that shows/selects the configuration environment you are editing configuration values for. Only configuration values that are marked in the configuration model as being configuration environment specific will get different values per configuration environement. Those values that are configuration environment specific are identified by having the configuration environment in parentesis after the configuration value key. If you switch the configuration environment in the top dropdown menu you will se that these values change.      
    </p>
    <p>
      Boolean configuration values will be shown as checkboxes. Date configuration values will have a date field where the user can write a date or click the button on the end to bring upp a calendar to select from. Date configuration values can also specify the date format (as described <a href='http://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html' title=''>here</a>) in the configuration model. This is used to display the date in the field and parse any entered date. So different date fields can have different formats!      
    </p>
    <p>
      The configuration models are annotated and provide descriptions of the values which are shown in the gui to make it easy for the person doing the configuration to know what the configuration is about.      
    </p>
    <p>
      As soon as the configuration changes are saved they become active. The code using the configurations doesn’t need to do anything. The next reference to a configuration value will return the new value.      
    </p>
    <H2>See also</H2>
    <p>
      Also se the APSConfigService documentation.      
    </p>
    <H1>APSUserAdminWeb</H1>
    <p>
            <img src='http://download.natusoft.se/Images/APS/APS-Webs/APSUserAdminWeb/docs/images/APSUserAdminWeb.png' title='' alt='APSUserAdminWeb screenshot'/>      
    </p>
    <p>
      APSUserAdminWeb provides user and group administration for the <em>APSSimpleUserService</em>.      
    </p>
    <p>
      Users are splitt into groups of the first character in the userid to make them a little bit easier to find if there are many. So all userids starting with ’a’ or ’A’ will be under Users/A and so on.      
    </p>
    <p>
      Right click on the <em>Users</em> node to create a new user.      
    </p>
    <p>
      Right click on the <em>Roles</em> node to create a new role.      
    </p>
    <p>
      <strong>Warning:</strong> For the roles it is fully possible to create circular dependencies! <strong>Dont!</strong> (There is room for improvement on this point!)      
    </p>
    <p>
      There is not anything more to say about this. It should be selfexplanatory!      
    </p>
    <H1>Licenses</H1>
    <!--
      Created by CodeLicenseManager
    -->
    <H2>Project License</H2>
    <p>
      <strong></strong><a href='http://www.apache.org/licenses/LICENSE-2.0.html' title=''>Apache Software License version 2.0</a><strong></strong>      
    </p>
    <H2>Third Party Licenses</H2>
    <p>
      <strong></strong><a href='http://www.osgi.org/Specifications/Licensing' title=''>OSGi Specification License version 2.0</a><strong></strong>      
    </p>
    <p>
      The following third party products are using this license:      
    </p>
    <ul>
      <li>
        <p>
           <a href='http://www.osgi.org/' title=''>org.osgi.compendium-4.2.0-null</a>          
        </p>
      </li>
      <li>
        <p>
           <a href='http://www.osgi.org/' title=''>org.osgi.core-4.2.0-null</a>          
        </p>
      </li>
    </ul>
    <!--
      CLM
    -->
    <H2>Apache License version 2.0, January 2004</H2>
    <p>
      <a href='http://www.apache.org/licenses/' title=''>http://www.apache.org/licenses/</a>      
    </p>
    <p>
      <strong>TERMS AND CONDITIONS FOR USE,</strong><strong> REPRODUCTION,</strong><strong> AND DISTRIBUTION</strong>      
    </p>
    <ol>
      <li>
        <p>
           Definitions.          
        </p>
      </li>
    </ol>
    <p>
       "License" shall mean the terms and conditions for use, reproduction,  and distribution as defined by Sections 1 through 9 of this document.      
    </p>
    <p>
       "Licensor" shall mean the copyright owner or entity authorized by  the copyright owner that is granting the License.      
    </p>
    <p>
       "Legal Entity" shall mean the union of the acting entity and all  other entities that control, are controlled by, or are under common  control with that entity. For the purposes of this definition,  "control" means (i) the power, direct or indirect, to cause the  direction or management of such entity, whether by contract or  otherwise, or (ii) ownership of fifty percent (50%) or more of the  outstanding shares, or (iii) beneficial ownership of such entity.      
    </p>
    <p>
       "You" (or "Your") shall mean an individual or Legal Entity  exercising permissions granted by this License.      
    </p>
    <p>
       "Source" form shall mean the preferred form for making modifications,  including but not limited to software source code, documentation  source, and configuration files.      
    </p>
    <p>
       "Object" form shall mean any form resulting from mechanical  transformation or translation of a Source form, including but  not limited to compiled object code, generated documentation,  and conversions to other media types.      
    </p>
    <p>
       "Work" shall mean the work of authorship, whether in Source or  Object form, made available under the License, as indicated by a  copyright notice that is included in or attached to the work  (an example is provided in the Appendix below).      
    </p>
    <p>
       "Derivative Works" shall mean any work, whether in Source or Object  form, that is based on (or derived from) the Work and for which the  editorial revisions, annotations, elaborations, or other modifications  represent, as a whole, an original work of authorship. For the purposes  of this License, Derivative Works shall not include works that remain  separable from, or merely link (or bind by name) to the interfaces of,  the Work and Derivative Works thereof.      
    </p>
    <p>
       "Contribution" shall mean any work of authorship, including  the original version of the Work and any modifications or additions  to that Work or Derivative Works thereof, that is intentionally  submitted to Licensor for inclusion in the Work by the copyright owner  or by an individual or Legal Entity authorized to submit on behalf of  the copyright owner. For the purposes of this definition, "submitted"  means any form of electronic, verbal, or written communication sent  to the Licensor or its representatives, including but not limited to  communication on electronic mailing lists, source code control systems,  and issue tracking systems that are managed by, or on behalf of, the  Licensor for the purpose of discussing and improving the Work, but  excluding communication that is conspicuously marked or otherwise  designated in writing by the copyright owner as "Not a Contribution."      
    </p>
    <p>
       "Contributor" shall mean Licensor and any individual or Legal Entity  on behalf of whom a Contribution has been received by Licensor and  subsequently incorporated within the Work.      
    </p>
    <ol>
      <li>
        <p>
           Grant of Copyright License. Subject to the terms and conditions of  this License, each Contributor hereby grants to You a perpetual,  worldwide, non-exclusive, no-charge, royalty-free, irrevocable  copyright license to reproduce, prepare Derivative Works of,  publicly display, publicly perform, sublicense, and distribute the  Work and such Derivative Works in Source or Object form.          
        </p>
      </li>
      <li>
        <p>
           Grant of Patent License. Subject to the terms and conditions of  this License, each Contributor hereby grants to You a perpetual,  worldwide, non-exclusive, no-charge, royalty-free, irrevocable  (except as stated in this section) patent license to make, have made,  use, offer to sell, sell, import, and otherwise transfer the Work,  where such license applies only to those patent claims licensable  by such Contributor that are necessarily infringed by their  Contribution(s) alone or by combination of their Contribution(s)  with the Work to which such Contribution(s) was submitted. If You  institute patent litigation against any entity (including a  cross-claim or counterclaim in a lawsuit) alleging that the Work  or a Contribution incorporated within the Work constitutes direct  or contributory patent infringement, then any patent licenses  granted to You under this License for that Work shall terminate  as of the date such litigation is filed.          
        </p>
      </li>
      <li>
        <p>
           Redistribution. You may reproduce and distribute copies of the  Work or Derivative Works thereof in any medium, with or without  modifications, and in Source or Object form, provided that You  meet the following conditions:          
        </p>
      </li>
      <ol>
        <li>
          <p>
             You must give any other recipients of the Work or  Derivative Works a copy of this License; and            
          </p>
        </li>
        <li>
          <p>
             You must cause any modified files to carry prominent notices  stating that You changed the files; and            
          </p>
        </li>
        <li>
          <p>
             You must retain, in the Source form of any Derivative Works  that You distribute, all copyright, patent, trademark, and  attribution notices from the Source form of the Work,  excluding those notices that do not pertain to any part of  the Derivative Works; and            
          </p>
        </li>
        <li>
          <p>
             If the Work includes a "NOTICE" text file as part of its  distribution, then any Derivative Works that You distribute must  include a readable copy of the attribution notices contained  within such NOTICE file, excluding those notices that do not  pertain to any part of the Derivative Works, in at least one  of the following places: within a NOTICE text file distributed  as part of the Derivative Works; within the Source form or  documentation, if provided along with the Derivative Works; or,  within a display generated by the Derivative Works, if and  wherever such third-party notices normally appear. The contents  of the NOTICE file are for informational purposes only and  do not modify the License. You may add Your own attribution  notices within Derivative Works that You distribute, alongside  or as an addendum to the NOTICE text from the Work, provided  that such additional attribution notices cannot be construed  as modifying the License.            
          </p>
          <p>
             You may add Your own copyright statement to Your modifications and  may provide additional or different license terms and conditions  for use, reproduction, or distribution of Your modifications, or  for any such Derivative Works as a whole, provided Your use,  reproduction, and distribution of the Work otherwise complies with  the conditions stated in this License.            
          </p>
        </li>
      </ol>
      <li>
        <p>
           Submission of Contributions. Unless You explicitly state otherwise,  any Contribution intentionally submitted for inclusion in the Work  by You to the Licensor shall be under the terms and conditions of  this License, without any additional terms or conditions.  Notwithstanding the above, nothing herein shall supersede or modify  the terms of any separate license agreement you may have executed  with Licensor regarding such Contributions.          
        </p>
      </li>
      <li>
        <p>
           Trademarks. This License does not grant permission to use the trade  names, trademarks, service marks, or product names of the Licensor,  except as required for reasonable and customary use in describing the  origin of the Work and reproducing the content of the NOTICE file.          
        </p>
      </li>
      <li>
        <p>
           Disclaimer of Warranty. Unless required by applicable law or  agreed to in writing, Licensor provides the Work (and each  Contributor provides its Contributions) on an "AS IS" BASIS,  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or  implied, including, without limitation, any warranties or conditions  of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A  PARTICULAR PURPOSE. You are solely responsible for determining the  appropriateness of using or redistributing the Work and assume any  risks associated with Your exercise of permissions under this License.          
        </p>
      </li>
      <li>
        <p>
           Limitation of Liability. In no event and under no legal theory,  whether in tort (including negligence), contract, or otherwise,  unless required by applicable law (such as deliberate and grossly  negligent acts) or agreed to in writing, shall any Contributor be  liable to You for damages, including any direct, indirect, special,  incidental, or consequential damages of any character arising as a  result of this License or out of the use or inability to use the  Work (including but not limited to damages for loss of goodwill,  work stoppage, computer failure or malfunction, or any and all  other commercial damages or losses), even if such Contributor  has been advised of the possibility of such damages.          
        </p>
      </li>
      <li>
        <p>
           Accepting Warranty or Additional Liability. While redistributing  the Work or Derivative Works thereof, You may choose to offer,  and charge a fee for, acceptance of support, warranty, indemnity,  or other liability obligations and/or rights consistent with this  License. However, in accepting such obligations, You may act only  on Your own behalf and on Your sole responsibility, not on behalf  of any other Contributor, and only if You agree to indemnify,  defend, and hold each Contributor harmless for any liability  incurred by, or claims asserted against, such Contributor by reason  of your accepting any such warranty or additional liability.          
        </p>
      </li>
    </ol>
    <p>
      <strong>END OF TERMS AND CONDITIONS</strong>      
    </p>
    <H3>APPENDIX: How to apply the Apache License to your work.</H3>
    <p>
      To apply the Apache License to your work, attach the following boilerplate notice, with the fields enclosed by brackets "[]" replaced with your own identifying information. (Don't include the brackets!) The text should be enclosed in the appropriate comment syntax for the file format. We also recommend that a file or class name and description of purpose be included on the same "printed page" as the copyright notice for easier identification within third-party archives.      
    </p>
    <pre>
      <code>
    Copyright [yyyy] [name of copyright owner]
    
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
    
        http://www.apache.org/licenses/LICENSE-2.0
    
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
      </code>
    </pre>
    <!--
      
  This was created by CodeLicenseManager
    -->
    <H2>Day Specification version License</H2>
    <p>
      Day Management AG ("Licensor") is willing to license this specification to you ONLY UPON THE CONDITION THAT YOU ACCEPT ALL OF THE TERMS CONTAINED IN THIS LICENSE AGREEMENT ("Agreement"). Please read the terms and conditions of this Agreement carefully.      
    </p>
    <p>
      Content Repository for JavaTM  Technology API Specification ("Specification") Version: 2.0 Status: FCS Release: 10 August 2009      
    </p>
    <p>
      Copyright 2009 Day Management AG Barf&amp;#252;sserplatz 6, 4001 Basel, Switzerland. All rights reserved.      
    </p>
    <p>
      NOTICE; LIMITED LICENSE GRANTS      
    </p>
    <ol>
      <li>
        <p>
           License for Purposes of Evaluation and Developing Applications.          
        </p>
      </li>
    </ol>
    <p>
      Licensor hereby grants you a fully-paid, non-exclusive, non-transferable, worldwide, limited license (without the right to sublicense), under Licensor's applicable intellectual property rights to view, download, use and reproduce the Specification only for the purpose of internal evaluation. This includes developing applications intended to run on an implementation of the Specification provided that such applications do not themselves implement any portion(s) of the Specification.      
    </p>
    <ol>
      <li>
        <p>
           License for the Distribution of Compliant Implementations. Licensor also grants you a perpetual, non-exclusive, non-transferable, worldwide, fully paid-up, royalty free, limited license (without the right to sublicense) under any applicable copyrights or, subject to the provisions of subsection 4 below, patent rights it may have covering the Specification to create and/or distribute an Independent Implementation of the Specification that: (a) fully implements the Specification including all its required interfaces and functionality; (b) does not modify, subset, superset or otherwise extend the Licensor Name Space, or include any public or protected packages, classes, Java interfaces, fields or methods within the Licensor Name Space other than those required/authorized by the Specification or Specifications being implemented; and (c) passes the Technology Compatibility Kit (including satisfying the requirements of the applicable TCK Users Guide) for such Specification ("Compliant Implementation"). In addition, the foregoing license is expressly conditioned on your not acting outside its scope. No license is granted hereunder for any other purpose (including, for example, modifying the Specification, other than to the extent of your fair use rights, or distributing the Specification to third parties).          
        </p>
      </li>
      <li>
        <p>
           Pass-through Conditions. You need not include limitations (a)-(c) from the previous paragraph or any other particular "pass through" requirements in any license You grant concerning the use of your Independent Implementation or products derived from it. However, except with respect to Independent Implementations (and products derived from them) that satisfy limitations (a)-(c) from the previous paragraph, You may neither: (a) grant or otherwise pass through to your licensees any licenses under Licensor's applicable intellectual property rights; nor (b) authorize your licensees to make any claims concerning their implementation's compliance with the Specification.          
        </p>
      </li>
      <li>
        <p>
           Reciprocity Concerning Patent Licenses. With respect to any patent claims covered by the license granted under subparagraph 2 above that would be infringed by all technically feasible implementations of the Specification, such license is conditioned upon your offering on fair, reasonable and non-discriminatory terms, to any party seeking it from You, a perpetual, non-exclusive, non-transferable, worldwide license under Your patent rights that are or would be infringed by all technically feasible implementations of the Specification to develop, distribute and use a Compliant Implementation.          
        </p>
      </li>
      <li>
        <p>
           Definitions. For the purposes of this Agreement: "Independent Implementation" shall mean an implementation of the Specification that neither derives from any of Licensor's source code or binary code materials nor, except with an appropriate and separate license from Licensor, includes any of Licensor's source code or binary code materials; "Licensor Name Space" shall mean the public class or interface declarations whose names begin with "java", "javax", "javax.jcr" or their equivalents in any subsequent naming convention adopted by Licensor through the Java Community Process, or any recognized successors or replacements thereof; and "Technology Compatibility Kit" or "TCK" shall mean the test suite and accompanying TCK User's Guide provided by Licensor which corresponds to the particular version of the Specification being tested.          
        </p>
      </li>
      <li>
        <p>
           Termination. This Agreement will terminate immediately without notice from Licensor if you fail to comply with any material provision of or act outside the scope of the licenses granted above.          
        </p>
      </li>
      <li>
        <p>
           Trademarks. No right, title, or interest in or to any trademarks, service marks, or trade names of Licensor is granted hereunder. Java is a registered trademark of Sun Microsystems, Inc. in the United States and other countries.          
        </p>
      </li>
      <li>
        <p>
           Disclaimer of Warranties. The Specification is provided "AS IS". LICENSOR MAKES NO REPRESENTATIONS OR WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT (INCLUDING AS A CONSEQUENCE OF ANY PRACTICE OR IMPLEMENTATION OF THE SPECIFICATION), OR THAT THE CONTENTS OF THE SPECIFICATION ARE SUITABLE FOR ANY PURPOSE. This document does not represent any commitment to release or implement any portion of the Specification in any product.          
        </p>
      </li>
    </ol>
    <p>
      The Specification could include technical inaccuracies or typographical errors. Changes are periodically added to the information therein; these changes will be incorporated into new versions of the Specification, if any. Licensor may make improvements and/or changes to the product(s) and/or the program(s) described in the Specification at any time. Any use of such changes in the Specification will be governed by the then-current license for the applicable version of the Specification.      
    </p>
    <ol>
      <li>
        <p>
           Limitation of Liability. TO THE EXTENT NOT PROHIBITED BY LAW, IN NO EVENT WILL LICENSOR BE LIABLE FOR ANY DAMAGES, INCLUDING WITHOUT LIMITATION, LOST REVENUE, PROFITS OR DATA, OR FOR SPECIAL, INDIRECT, CONSEQUENTIAL, INCIDENTAL OR PUNITIVE DAMAGES, HOWEVER CAUSED AND REGARDLESS OF THE THEORY OF LIABILITY, ARISING OUT OF OR RELATED TO ANY FURNISHING, PRACTICING, MODIFYING OR ANY USE OF THE SPECIFICATION, EVEN IF LICENSOR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.          
        </p>
      </li>
      <li>
        <p>
           Report. If you provide Licensor with any comments or suggestions in connection with your use of the Specification ("Feedback"), you hereby: (i) agree that such Feedback is provided on a non-proprietary and non-confidential basis, and (ii) grant Licensor a perpetual, non-exclusive, worldwide, fully paid-up, irrevocable license, with the right to sublicense through multiple levels of sublicensees, to incorporate, disclose, and use without limitation the Feedback for any purpose related to the Specification and future versions, implementations, and test suites thereof.          
        </p>
      </li>
    </ol>
    <!--
      
  This was created by CodeLicenseManager
    -->
    <H2>Eclipse Public License - v version 1.0</H2>
    <p>
      Eclipse Public License - v 1.0      
    </p>
    <p>
      THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.      
    </p>
    <ol>
      <li>
        <p>
           DEFINITIONS          
        </p>
      </li>
    </ol>
    <p>
      "Contribution" means:      
    </p>
    <p>
      a) in the case of the initial Contributor, the initial code and documentation distributed under this Agreement, and b) in the case of each subsequent Contributor: i) changes to the Program, and ii) additions to the Program; where such changes and/or additions to the Program originate from and are distributed by that particular Contributor. A Contribution 'originates' from a Contributor if it was added to the Program by such Contributor itself or anyone acting on such Contributor's behalf. Contributions do not include additions to the Program which: (i) are separate modules of software distributed in conjunction with the Program under their own license agreement, and (ii) are not derivative works of the Program.      
    </p>
    <p>
      "Contributor" means any person or entity that distributes the Program.      
    </p>
    <p>
      "Licensed Patents" mean patent claims licensable by a Contributor which are necessarily infringed by the use or sale of its Contribution alone or when combined with the Program.      
    </p>
    <p>
      "Program" means the Contributions distributed in accordance with this Agreement.      
    </p>
    <p>
      "Recipient" means anyone who receives the Program under this Agreement, including all Contributors.      
    </p>
    <ol>
      <li>
        <p>
           GRANT OF RIGHTS          
        </p>
      </li>
    </ol>
    <p>
      a) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, distribute and sublicense the Contribution of such Contributor, if any, and such derivative works, in source code and object code form.      
    </p>
    <p>
      b) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free patent license under Licensed Patents to make, use, sell, offer to sell, import and otherwise transfer the Contribution of such Contributor, if any, in source code and object code form. This patent license shall apply to the combination of the Contribution and the Program if, at the time the Contribution is added by the Contributor, such addition of the Contribution causes such combination to be covered by the Licensed Patents. The patent license shall not apply to any other combinations which include the Contribution. No hardware per se is licensed hereunder.      
    </p>
    <p>
      c) Recipient understands that although each Contributor grants the licenses to its Contributions set forth herein, no assurances are provided by any Contributor that the Program does not infringe the patent or other intellectual property rights of any other entity. Each Contributor disclaims any liability to Recipient for claims brought by any other entity based on infringement of intellectual property rights or otherwise. As a condition to exercising the rights and licenses granted hereunder, each Recipient hereby assumes sole responsibility to secure any other intellectual property rights needed, if any. For example, if a third party patent license is required to allow Recipient to distribute the Program, it is Recipient's responsibility to acquire that license before distributing the Program.      
    </p>
    <p>
      d) Each Contributor represents that to its knowledge it has sufficient copyright rights in its Contribution, if any, to grant the copyright license set forth in this Agreement.      
    </p>
    <ol>
      <li>
        <p>
           REQUIREMENTS          
        </p>
      </li>
    </ol>
    <p>
      A Contributor may choose to distribute the Program in object code form under its own license agreement, provided that:      
    </p>
    <p>
      a) it complies with the terms and conditions of this Agreement; and      
    </p>
    <p>
      b) its license agreement:      
    </p>
    <p>
      i) effectively disclaims on behalf of all Contributors all warranties and conditions, express and implied, including warranties or conditions of title and non-infringement, and implied warranties or conditions of merchantability and fitness for a particular purpose;      
    </p>
    <p>
      ii) effectively excludes on behalf of all Contributors all liability for damages, including direct, indirect, special, incidental and consequential damages, such as lost profits;      
    </p>
    <p>
      iii) states that any provisions which differ from this Agreement are offered by that Contributor alone and not by any other party; and      
    </p>
    <p>
      iv) states that source code for the Program is available from such Contributor, and informs licensees how to obtain it in a reasonable manner on or through a medium customarily used for software exchange.      
    </p>
    <p>
      When the Program is made available in source code form:      
    </p>
    <p>
      a) it must be made available under this Agreement; and      
    </p>
    <p>
      b) a copy of this Agreement must be included with each copy of the Program.      
    </p>
    <p>
      Contributors may not remove or alter any copyright notices contained within the Program.      
    </p>
    <p>
      Each Contributor must identify itself as the originator of its Contribution, if any, in a manner that reasonably allows subsequent Recipients to identify the originator of the Contribution.      
    </p>
    <ol>
      <li>
        <p>
           COMMERCIAL DISTRIBUTION          
        </p>
      </li>
    </ol>
    <p>
      Commercial distributors of software may accept certain responsibilities with respect to end users, business partners and the like. While this license is intended to facilitate the commercial use of the Program, the Contributor who includes the Program in a commercial product offering should do so in a manner which does not create potential liability for other Contributors. Therefore, if a Contributor includes the Program in a commercial product offering, such Contributor ("Commercial Contributor") hereby agrees to defend and indemnify every other Contributor ("Indemnified Contributor") against any losses, damages and costs (collectively "Losses") arising from claims, lawsuits and other legal actions brought by a third party against the Indemnified Contributor to the extent caused by the acts or omissions of such Commercial Contributor in connection with its distribution of the Program in a commercial product offering. The obligations in this section do not apply to any claims or Losses relating to any actual or alleged intellectual property infringement. In order to qualify, an Indemnified Contributor must: a) promptly notify the Commercial Contributor in writing of such claim, and b) allow the Commercial Contributor to control, and cooperate with the Commercial Contributor in, the defense and any related settlement negotiations. The Indemnified Contributor may participate in any such claim at its own expense.      
    </p>
    <p>
      For example, a Contributor might include the Program in a commercial product offering, Product X. That Contributor is then a Commercial Contributor. If that Commercial Contributor then makes performance claims, or offers warranties related to Product X, those performance claims and warranties are such Commercial Contributor's responsibility alone. Under this section, the Commercial Contributor would have to defend claims against the other Contributors related to those performance claims and warranties, and if a court requires any other Contributor to pay any damages as a result, the Commercial Contributor must pay those damages.      
    </p>
    <ol>
      <li>
        <p>
           NO WARRANTY          
        </p>
      </li>
    </ol>
    <p>
      EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, THE PROGRAM IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES OR CONDITIONS OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Each Recipient is solely responsible for determining the appropriateness of using and distributing the Program and assumes all risks associated with its exercise of rights under this Agreement , including but not limited to the risks and costs of program errors, compliance with applicable laws, damage to or loss of data, programs or equipment, and unavailability or interruption of operations.      
    </p>
    <ol>
      <li>
        <p>
           DISCLAIMER OF LIABILITY          
        </p>
      </li>
    </ol>
    <p>
      EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, NEITHER RECIPIENT NOR ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.      
    </p>
    <ol>
      <li>
        <p>
           GENERAL          
        </p>
      </li>
    </ol>
    <p>
      If any provision of this Agreement is invalid or unenforceable under applicable law, it shall not affect the validity or enforceability of the remainder of the terms of this Agreement, and without further action by the parties hereto, such provision shall be reformed to the minimum extent necessary to make such provision valid and enforceable.      
    </p>
    <p>
      If Recipient institutes patent litigation against any entity (including a cross-claim or counterclaim in a lawsuit) alleging that the Program itself (excluding combinations of the Program with other software or hardware) infringes such Recipient's patent(s), then such Recipient's rights granted under Section 2(b) shall terminate as of the date such litigation is filed.      
    </p>
    <p>
      All Recipient's rights under this Agreement shall terminate if it fails to comply with any of the material terms or conditions of this Agreement and does not cure such failure in a reasonable period of time after becoming aware of such noncompliance. If all Recipient's rights under this Agreement terminate, Recipient agrees to cease use and distribution of the Program as soon as reasonably practicable. However, Recipient's obligations under this Agreement and any licenses granted by Recipient relating to the Program shall continue and survive.      
    </p>
    <p>
      Everyone is permitted to copy and distribute copies of this Agreement, but in order to avoid inconsistency the Agreement is copyrighted and may only be modified in the following manner. The Agreement Steward reserves the right to publish new versions (including revisions) of this Agreement from time to time. No one other than the Agreement Steward has the right to modify this Agreement. The Eclipse Foundation is the initial Agreement Steward. The Eclipse Foundation may assign the responsibility to serve as the Agreement Steward to a suitable separate entity. Each new version of the Agreement will be given a distinguishing version number. The Program (including Contributions) may always be distributed subject to the version of the Agreement under which it was received. In addition, after a new version of the Agreement is published, Contributor may elect to distribute the Program (including its Contributions) under the new version. Except as expressly stated in Sections 2(a) and 2(b) above, Recipient receives no rights or licenses to the intellectual property of any Contributor under this Agreement, whether expressly, by implication, estoppel or otherwise. All rights in the Program not expressly granted under this Agreement are reserved.      
    </p>
    <p>
      This Agreement is governed by the laws of the State of New York and the intellectual property laws of the United States of America. No party to this Agreement will bring a legal action under this Agreement more than one year after the cause of action arose. Each party waives its rights to a jury trial in any resulting litigation.      
    </p>
    <!--
      
  This was created by CodeLicenseManager
    -->
    <H2>Eclipse Public License -v 1.0 version 1.0</H2>
    <pre>
      <code>
    Eclipse Public License -v 1.0
    
    THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION OF THE PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.
    
    1. DEFINITIONS
    "Contribution" means:
    a) in the case of the initial Contributor, the initial code and documentation distributed under this Agreement, and
    b) in the case of each subsequent Contributor:
    i) changes to the Program, and
    ii) additions to the Program;
    where such changes and/or additions to the Program originate from and are distributed by that particular Contributor. A Contribution 'originates' from a Contributor if it was added to the Program by such Contributor itself or anyone acting on such Contributor's behalf. Contributions do not include additions to the Program which: (i) are separate modules of software distributed in conjunction with the Program under their own license agreement, and (ii) are not derivative works of the Program.
    "Contributor" means any person or entity that distributes the Program.
    "Licensed Patents " mean patent claims licensable by a Contributor which are necessarily infringed by the use or sale of its Contribution alone or when combined with the Program.
    "Program" means the Contributions distributed in accordance with this Agreement.
    "Recipient" means anyone who receives the Program under this Agreement, including all Contributors.
    
    2. GRANT OF RIGHTS
    a) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, distribute and sublicense the Contribution of such Contributor, if any, and such derivative works, in source code and object code form.
    b) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free patent license under Licensed Patents to make, use, sell, offer to sell, import and otherwise transfer the Contribution of such Contributor, if any, in source code and object code form. This patent license shall apply to the combination of the Contribution and the Program if, at the time the Contribution is added by the Contributor, such addition of the Contribution causes such combination to be covered by the Licensed Patents. The patent license shall not apply to any other combinations which include the Contribution. No hardware per se is licensed hereunder.
    c) Recipient understands that although each Contributor grants the licenses to its Contributions set forth herein, no assurances are provided by any Contributor that the Program does not infringe the patent or other intellectual property rights of any other entity. Each Contributor disclaims any liability to Recipient for claims brought by any other entity based on infringement of intellectual property rights or otherwise. As a condition to exercising the rights and licenses granted hereunder, each Recipient hereby assumes sole responsibility to secure any other intellectual property rights needed, if any. For example, if a third party patent license is required to allow Recipient to distribute the Program, it is Recipient's responsibility to acquire that license before distributing the Program.
    d) Each Contributor represents that to its knowledge it has sufficient copyright rights in its Contribution, if any, to grant the copyright license set forth in this Agreement.
    
    3. REQUIREMENTS
    A Contributor may choose to distribute the Program in object code form under its own license agreement, provided that:
    a) it complies with the terms and conditions of this Agreement; and
    b) its license agreement:
    i) effectively disclaims on behalf of all Contributors all warranties and conditions, express and implied, including warranties or conditions of title and non-infringement, and implied warranties or conditions of merchantability and fitness for a particular purpose;
    ii) effectively excludes on behalf of all Contributors all liability for damages, including direct, indirect, special, incidental and consequential damages, such as lost profits;
    iii) states that any provisions which differ from this Agreement are offered by that Contributor alone and not by any other party; and
    iv) states that source code for the Program is available from such Contributor, and informs licensees how to obtain it in a reasonable manner on or through a medium customarily used for software exchange.
    When the Program is made available in source code form:
    a) it must be made available under this Agreement; and
    b) a copy of this Agreement must be included with each copy of the Program.
    Contributors may not remove or alter any copyright notices contained within the Program.
    Each Contributor must identify itself as the originator of its Contribution, if any, in a manner that reasonably allows subsequent Recipients to identify the originator of the Contribution.
    
    4. COMMERCIAL DISTRIBUTION
    Commercial distributors of software may accept certain responsibilities with respect to end users, business partners and the like. While this license is intended to facilitate the commercial use of the Program, the Contributor who includes the Program in a commercial product offering should do so in a manner which does not create potential liability for other Contributors. Therefore, if a Contributor includes the Program in a commercial product offering, such Contributor ("Commercial Contributor") hereby agrees to defend and indemnify every other Contributor ("Indemnified Contributor") against any losses, damages and costs (collectively "Losses") arising from claims, lawsuits and other legal actions brought by a third party against the Indemnified Contributor to the extent caused by the acts or omissions of such Commercial Contributor in connection with its distribution of the Program in a commercial product offering. The obligations in this section do not apply to any claims or Losses relating to any actual or alleged intellectual property infringement. In order to qualify, an Indemnified Contributor must: a) promptly notify the Commercial Contributor in writing of such claim, and b) allow the Commercial Contributor to control, and cooperate with the Commercial Contributor in, the defense and any related settlement negotiations. The Indemnified Contributor may participate in any such claim at its own expense.
    For example, a Contributor might include the Program in a commercial product offering, Product X. That Contributor is then a Commercial Contributor. If that Commercial Contributor then makes performance claims, or offers warranties related to Product X, those performance claims and warranties are such Commercial Contributor's responsibility alone. Under this section, the Commercial Contributor would have to defend claims against the other Contributors related to those performance claims and warranties, and if a court requires any other Contributor to pay any damages as a result, the Commercial Contributor must pay those damages.
    
    5. NO WARRANTY
    EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, THE PROGRAM IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES OR CONDITIONS OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. Each Recipient is solely responsible for determining the appropriateness of using and distributing the Program and assumes all risks associated with its exercise of rights under this Agreement , including but not limited to the risks and costs of program errors, compliance with applicable laws, damage to or loss of data, programs or equipment, and unavailability or interruption of operations.
    
    6. DISCLAIMER OF LIABILITY
    EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, NEITHER RECIPIENT NOR ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
    
    7. GENERAL
    If any provision of this Agreement is invalid or unenforceable under applicable law, it shall not affect the validity or enforceability of the remainder of the terms of this Agreement, and without further action by the parties hereto, such provision shall be reformed to the minimum extent necessary to make such provision valid and enforceable.
    If Recipient institutes patent litigation against any entity (including a cross-claim or counterclaim in a lawsuit) alleging that the Program itself (excluding combinations of the Program with other software or hardware) infringes such Recipient's patent(s), then such Recipient's rights granted under Section 2(b) shall terminate as of the date such litigation is filed.
    All Recipient's rights under this Agreement shall terminate if it fails to comply with any of the material terms or conditions of this Agreement and does not cure such failure in a reasonable period of time after becoming aware of such noncompliance. If all Recipient's rights under this Agreement terminate, Recipient agrees to cease use and distribution of the Program as soon as reasonably practicable. However, Recipient's obligations under this Agreement and any licenses granted by Recipient relating to the Program shall continue and survive.
    Everyone is permitted to copy and distribute copies of this Agreement, but in order to avoid inconsistency the Agreement is copyrighted and may only be modified in the following manner. The Agreement Steward reserves the right to publish new versions (including revisions) of this Agreement from time to time. No one other than the Agreement Steward has the right to modify this Agreement. The Eclipse Foundation is the initial Agreement Steward. The Eclipse Foundation may assign the responsibility to serve as the Agreement Steward to a suitable separate entity. Each new version of the Agreement will be given a distinguishing version number. The Program (including Contributions) may always be distributed subject to the version of the Agreement under which it was received. In addition, after a new version of the Agreement is published, Contributor may elect to distribute the Program (including its Contributions) under the new version. Except as expressly stated in Sections 2(a) and 2(b) above, Recipient receives no rights or licenses to the intellectual property of any Contributor under this Agreement, whether expressly, by implication, estoppel or otherwise. All rights in the Program not expressly granted under this Agreement are reserved.
    This Agreement is governed by the laws of the State of New York and the intellectual property laws of the United States of America. No party to this Agreement will bring a legal action under this Agreement more than one year after the cause of action arose. Each party waives its rights to a jury trial in any resulting litigation.
      </code>
    </pre>
    <H2>OSGi Specification License, Version 2.0.</H2>
    <p>
      License Grant      
    </p>
    <p>
      OSGi Alliance (“OSGi”) hereby grants you a fully-paid, non-exclusive, non-transferable, worldwide, limited license (without the right to sublicense), under OSGi’s applicable intellectual property rights to view, download, and reproduce this OSGi Specification (“Specification”) which follows this License Agreement (“Agreement”). You are not authorized to create any derivative work of the Specification. However, to the extent that an implementation of the Specification would necessarily be a derivative work of the Specification, OSGi also grants you a perpetual, non-exclusive, worldwide, fully paid-up, royalty free, limited license (without the right to sublicense) under any applicable copyrights, to create and/or distribute an implementation of the Specification that: (i) fully implements the Specification including all its required interfaces and functionality; (ii) does not modify, subset, superset or otherwise extend the OSGi Name Space, or include any public or protected packages, classes, Java interfaces, fields or methods within the OSGi Name Space other than those required and authorized by the Specification. An implementation that does not satisfy limitations (i)-(ii) is not considered an implementation of the Specification, does not receive the benefits of this license, and must not be described as an implementation of the Specification. An implementation of the Specification must not claim to be a compliant implementation of the Specification unless it passes the OSGi Compliance Tests for the Specification in accordance with OSGi processes. “OSGi Name Space” shall mean the public class or interface declarations whose names begin with “org.osgi" or any recognized successors or replacements thereof.      
    </p>
    <p>
      OSGi Participants (as such term is defined in the OSGi Intellectual Property Rights Policy) have made non-assert and licensing commitments regarding patent claims necessary to implement the Specification, if any, under the OSGi Intellectual Property Rights Policy which is available for examination on the OSGi public web site (www.osgi.org).      
    </p>
    <p>
      No Warranties and Limitation of Liability      
    </p>
    <p>
      THE SPECIFICATION IS PROVIDED "AS IS," AND OSGi AND ANY OTHER AUTHORS MAKE NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE SPECIFICATION ARE SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS. OSGi AND ANY OTHER AUTHORS WILL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THE SPECIFICATION OR THE PERFORMANCE OR IMPLEMENTATION OF THE CONTENTS THEREOF.      
    </p>
    <p>
      Covenant Not to Assert      
    </p>
    <p>
      As a material condition to this license you hereby agree, to the extent that you have any patent claims which are necessarily infringed by an implementation of the Specification, not to assert any such patent claims against the creation, distribution or use of an implementation of the Specification.      
    </p>
    <p>
      General      
    </p>
    <p>
      The name and trademarks of OSGi or any other Authors may NOT be used in any manner, including advertising or publicity pertaining to the Specification or its contents without specific, written prior permission. Title to copyright in the Specification will at all times remain with OSGi.      
    </p>
    <p>
      No other rights are granted by implication, estoppel or otherwise.      
    </p>
  </body>
</html>
