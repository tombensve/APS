<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generated-by" content="MarkdownDoc"/>
    <link href="docs.css" type="text/css" rel="stylesheet"/>
  </head>
  <body>
    <H1>Application Platform Services (APS)</H1>
    <p>
      OSGi Application Platform Services - A "smorgasbord" of OSGi services that focuses on ease of use and good enough functionality for many but wont fit all. It can be seen as osgi-ee-light-and-easy. The services are of platform type: configuration, database, JPA, content, etc.      
    </p>
    <p>
      All services that require some form of administration have an admin web application for that, that plugs into the general apsadminweb admin application.      
    </p>
    <p>
      All administrations web applications are WABs and thus require that the OSGi server supports WABs.      
    </p>
    <p>
      Another point of APS is to be OSGi server independent.      
    </p>
    <p>
      APS is made using basic OSGi functionality and is not using blueprint and other fancy stuff (of which I'm not a believer, I like to be in full controll :-)).      
    </p>
    <H2>Features</H2>
    <H3>Current</H3>
    <ul>
      <li>
        <p>
          A configuration service that works with annotated configuration models where each config value can be described/documented. The configuration model can be structured with sub models that there can be one or many of. Each top level configuration model registered with the configuration service will be available for publishing in its admin web.          
        </p>
      </li>
      <li>
        <p>
          A filesystem service that provides a persistent filesystem outside of the OSGi server. The configuration service makes use of this to store configurations.          
        </p>
      </li>
      <li>
        <p>
          A platform service that simply identifies the local installation and provides a description of it. It is basically a read only service that provides configured information about the installation.          
        </p>
      </li>
      <li>
        <p>
          A JPA service that is easier and more clearly defined than the osgi-ee JPA API, and allows for multiple JPA contexts. It works as an extender picking up persistence.xml whose defined persistence unit name can then be looked up using the service. A client can only lookup its own persistence units. It is based on OpenJPA.          
        </p>
      </li>
      <li>
        <p>
          A data source service. Only provides connection information, no pooling (OpenJPA provides its own pooling)!          
        </p>
      </li>
      <li>
        <p>
          External protocol extender that allows more or less any OSGi service to be called remotely using any deployed protocol service and transport. Currently provides JSONRPC 1.0 and 2.0 protocols, and an http transport. Protocols have two defined service APIs whose implementations can just be dropped in to make them available. The http transport can make use of any deployed protocol.          
        </p>
      </li>
      <li>
        <p>
          A multicast discovery service.          
        </p>
      </li>
      <li>
        <p>
          A session service (not http!). This is used by apsadminweb to keep a session among several different administration web applications.          
        </p>
      </li>
      <li>
        <p>
          An administration web service to which administration web applications can register themselves with an url and thus be available in the .../apsadminweb admin gui.          
        </p>
      </li>
      <li>
        <p>
          A user service. Provides basic user management including roles/groups. Is accompanied with a admin GUI (plugnis into apsadminweb) for administration of users.          
        </p>
      </li>
      <li>
        <p>
          A far better service tracker that does a better job at handling services coming and going. Supports service availability wait and timeout and can be wrapped as a proxy to the service.          
        </p>
      </li>
    </ul>
    <H3>Planned</H3>
    <ul>
      <li>
        <p>
          A log service with a log viewer GUI. The GUI should support server push and also allow for filtering of logs and configuration of what logs go to what log files.          
        </p>
      </li>
      <li>
        <p>
          A REST/JSON protocol for use with aps-external-protocol-extender.          
        </p>
      </li>
      <li>
        <p>
          Anything else relevant I come up with and consider fun to do :-).          
        </p>
      </li>
    </ul>
    <H3>Ideas</H3>
    <ul>
      <li>
        <p>
          JDBC connection pool service (based on some open source connection pool implementation). Will use the Data source service to create connection pools.          
        </p>
      </li>
      <li>
        <p>
          Since JBoss is apparently having trouble getting WABs to work (they are still using PAX, but claim that they have solved this in 7.2 that will not build when checked out from GitHub and don't seem to be released anytime soon) I am considering to add support for their WAR-&gt;OSGi service bridge though I haven't had much luck in getting that to work either so far.          
        </p>
      </li>
      <li>
        <p>
          A JCR (Java Content Repository) service and a content publishing GUI (following the general APS ambition - reasonable functionality and flexibility, ease of use. Will fit many, but not everyone).          
        </p>
      </li>
    </ul>
    <H2>Pre Setup</H2>
    <p>
      The Filesystem service is part of the core and used by other services. It should preferably have its filesystem root outside of the server installation. The BundleContext.getDataFile(String) returns a path within the deploy cache and is only valid for as long a a bundle is deployed. The point with the FilesystemService is to have a more permanent filesystem outside of the application server installation. To provide the FilesystemService root the following system property have to be set and available in the JVM instance:      
    </p>
    <pre>
      <code>
        aps.filesystem.root=&lt;root&gt;
      </code>
    </pre>
    <p>
      How to do this differs between servers. In Glassfish you can supply system properties with its admin gui.      
    </p>
    <p>
      If this system property is not set the default root will be BundleContext.getFile(). This will work but is not optimal!      
    </p>
    <p>
      After this path has been setup and the server started, all other configuration can be done in http://…/apsadminweb/.      
    </p>
    <H2>Javadoc</H2>
    <p>
      The complete javadoc for all services can be found at <a href='http://apidoc.natusoft.se/APS' title=''>http://apidoc.natusoft.se/APS</a>.      
    </p>
    <H1>APSConfigService</H1>
    <p>
      This is not the simple standard OSGi service configurations, but more an application config that can also be used for services. It supports structured configurations including lists of items and lists of subconfigurations. Code that uses the configuration provide one or more configuration classes with config items. These are registered with the config service, which makes them editable/publishable though and admin web app. After registration an instance of the config can be gotten containing published or defaul values. Alternatively the config class is specified with a fully qualified name in the <em>APS-Configs:</em> MANIFEST.MF entry. In this case the configuration service acts as an extender and automatically registers and provides an instance of the config for you, without having to call the config service.      
    </p>
    <H2>Configuration Environments</H2>
    <p>
      The APSConfigService supports different configuration environments. The idea is to define one config environment per installation. Configuration values can either be configuration environment specific or the same for all environments. See @ConfigItemDescription below for more information on specifying configuration environment specific values.      
    </p>
    <H2>Making a config class</H2>
    <p>
      Here is an example:      
    </p>
    <pre>
      <code>
    @APSConfigDescription(
            version="1.0",
            configId=”se.natusoft.aps.exmple.myconfig”,
            group=”examples”,  
            description=”An example configuration model”
    )
    public class MyConfig extends APSConfig {
        
        @APSConfigItemDescription(
            description=”Example of simple value.”,
        )
        public APSConfigValue simpleValue;
        
        @APSConfigItemDescription(
            description=”Example of list value.”
        )
        public APSConfigValueList listValue;
        
        @APSConfigItemDescription(
            description=”One instance of MySubConfig model.”
        )
        public MySubConfig mySubConfig;
        
        @APSConfigItemDescription(
            description=”Multiple instances of MySubConfig model.”
        )
        public APSConfigList&lt;MySubConfig&gt; listOfMySubConfigs;
        
        @APSConfigDescription(
            version=”1.0”,
            configId=”se.natusoft.aps.example.myconfig.mysubconfig”,
            description=”Example of a subconfig model. Does not have to be inner class!”
        )
        public static class MySubConfig extends APSConfig {
            
            @APSConfigItemDescription(
                description=”Description of values.”
            )
            public APSConfigValueList listOfValues;
            
            @APSConfigItemDescription(
                description=”Description of another value.”
            )
            public APSConfigValue anotherValue;
        }
    }
      </code>
    </pre>
    <H3>The config values </H3>
    <p>
      Now you might be wondering, why not an interface, and why <em>public</em> and why <em>APSConfigValue</em>, <em>APSConfigValueList</em>, and <em>APSConfigList</em>?      
    </p>
    <p>
      The reason for not using an interface and provide a java.lang.reflect.Proxy implementation of it is that OSGi has separate class loaders for each bundle. This means a service cannot proxy an interface provided by another bundle. Well, there are ways to go around that, but I did not want to do that unless that was the only option available. In this case it wasn’t. Therefore I use the above listed APS*Value classes as value containers. They are public so that they can be accessed and set by the APSConfigService. When you get the main config class instance back from the service all values will have valid instances. Each APS*Value has an internal reference to its config value in the internal config store. So if the value is updated this will be immediately reflected since it is referencing the one and only instance of it in the config store.      
    </p>
    <p>
      All config values are strings! All config values are stored as strings. The <strong>APSConfigValue</strong> container however have <em>toBoolean()</em>, <em>toDate()</em>, <em>toDouble()</em>, <em>toFloat()</em>, <em>toInt()</em>, <em>toLong()</em>, <em>toByte()</em>, <em>toShort()</em>, and <em>toString()</em> methods on it.      
    </p>
    <p>
      The <strong>APSConfigList&lt;Type&gt;</strong> container is an <em>java.lang.Iterable</em> of &lt;Type&gt; type objects. The &lt;Type&gt; cannot however be anything. When used directly in a config model it must be &lt;Type extends APSConfig&gt;. That is, you can only specify other config models extending APSConfig. The only exception to that is <strong>APSConfigValueList</strong> which is defined as:      
    </p>
    <pre>
      <code>
    public interface APSConfigValueList extends APSConfigList&lt;APSConfigValue&gt; {} 
      </code>
    </pre>
    <ul>
      <li>
        <p>
          Use <strong>APSConfigValue</strong> for plain values.          
        </p>
      </li>
      <li>
        <p>
          Use <strong>APSConfigValueList</strong> for a list of plain values.          
        </p>
      </li>
      <li>
        <p>
          Use <strong>MyConfigModel extends APSConfig</strong> for a subconfig model.          
        </p>
      </li>
      <li>
        <p>
          Use <strong>APSConfigList&lt;MyConfigModel extends APSConfig&gt;</strong> for a list of subconfig models.          
        </p>
      </li>
    </ul>
    <H3>The config annotations</H3>
    <p>
      The following 3 annotations are available for use on configuration models.      
    </p>
    <H4>@APSConfigDescription</H4>
    <pre>
      <code>
    @APSConfigDescription(
        version="1.0",
        configId=”se.natusoft.aps.exmple.myconfig”,
        group=”docs.examples”,
        description=”An example configuration model”
    )
      </code>
    </pre>
    <p>
      This is an annotation for a configuration model.      
    </p>
    <p>
      <strong>version</strong> - The version of the config model. This is required.      
    </p>
    <p>
      <strong>configId</strong> - The unique id of the configuration model. Use same approch as for packages. This is required.      
    </p>
    <p>
      <strong>group</strong> - This specifies a group or rather a tree branch that the config belongs under. This is only used by the configuration admin web app to render a tree of configuration models. This is optional.      
    </p>
    <p>
      <strong>description</strong> - This describes the configuration model.      
    </p>
    <H4>@APSConfigItemDescription</H4>
    <pre>
      <code>
    @APSConfigItemDescription(
        description=”Example of simple value.”,
        datePattern=”yyMMdd”,  
        environmentSpecific=true/false,  
        isBoolean=true/false,  
        validValues={”high”, ”medium”, ”low”}, 
    )
      </code>
    </pre>
    <p>
      This is an annotation for a configuration item whithin a configuration model.      
    </p>
    <p>
      <strong>description</strong> - This describes the configuration value. The configuration admin web app uses this to explain the configuration value to the person editing the configuration. This is required.      
    </p>
    <p>
      <strong>datePattern</strong> - This is a date pattern that will be passed to SimpleDateFormat to convert the date in the string value to a java.util.Date object and is used by the <em>toDate()</em> method of APSConfigValue. This date format will also be displayed in the configuration admin web app to hint at the date format to the person editing the configuration. The configuration admin web app will also use a calendar field if this is available. The calendar field has a complete calendar popup that lets you choose a date. This is optional.      
    </p>
    <p>
      <strong>environmentSpecific</strong> - This indicates that the config value can have different values depending on which config environment is active. This defaults to false in which case the value will apply to all config environments. This is optional.      
    </p>
    <p>
      <strong>isBoolean</strong> - This indicates that the config value is of boolean type. This is used by the configuration admin web app to turn this into a checkbox rather than a text field. This defaults to false and is this optional.      
    </p>
    <p>
      <strong>validValues</strong> - This is an array of strings ( {”...”, ..., ”...”} ) containing the only valid values for this config value. This is used by the configuration admin web app to provide a dropdown menu of the alternatives rather than a text field. This defaults to {} and is thus optional.      
    </p>
    <p>
      <strong>defaultValue</strong> - This is an array of @APSDefaultValue annotations. Se the description of this annotation below. This allows not only for providing a default value, but for providing a default value per config environment (which is why there is an array of @APSDefaultValue annotations!). Thus you can deliver pre configured configuration for all configuration environments. If a config environment is not specified for a default value then it applies for all configuration environments. Some configuration values are better off without default values, like hosts and ports for other remote services. The application/server maintenance people responsible for an installation in general knows this information better than the developers.      
    </p>
    <H4>@APSDefaultValue</H4>
    <pre>
      <code>
    @APSDefaultValue {
        configEnv=”production”,
        value=”15”
    }
      </code>
    </pre>
    <p>
      <strong>configEnv</strong> - This specifies the configuration environment this default value applies to. ”default” means all/any configuration environment and is the default value if not specified.      
    </p>
    <p>
      <strong>value</strong> - This is the default value of the configuration value for the configuration environment specified by configEnv.      
    </p>
    <H3>Auto managed configurations</H3>
    <p>
      It is possible to let the APSConfigService act as an extender and automatically register and setup config instances on bundle deploy by adding the <strong>APS-Configs:</strong> MANIFEST.MF header and a comma separated list of fully qualified names of config models. There are two variants of how to define the auto managed instance.      
    </p>
    <p>
      <strong>Warning</strong>: Auto managed configurations cannot ever be accessed during bundle activation in default activation thread! If the activation code starts a new thread then it is OK to access auto managed configuration in that thread, but only with variant 2! (the thread have to put itself to sleep until the configuration becomes managed. This is described below).      
    </p>
    <H4>Variant 1: A simple non instantiated static member of config model type</H4>
    <p>
      Example:      
    </p>
    <pre>
      <code>
    @APSConfigDescription(
        version="1.0",
        configId=”se.natusoft.aps.exmple.myconfig”,
        group=”examples”,
        description=”An example configuration model”
    )
    public class MyConfig extends APSConfig {
        
    —&gt;  public static MyConfig myConfig;  &lt;—
        
        @APSConfigItemDescription(
            description=”Example of simple value.”,
        )
        public APSConfigValue simpleValue;
        
        @APSConfigItemDescription(
            description=”Example of list value.”
        )
        public APSConfigValueList listValue;
        ...
        
      </code>
    </pre>
    <p>
      To access this variant of managed config do:      
    </p>
    <pre>
      <code>
    MyConfig.myConfig.simpleValue.toString()/toInt()/toDouble()/...
    
      </code>
    </pre>
    <p>
      <strong>A warning</strong>: This variant does not provide any support for determining if the configuration has become managaged yet. If you access it to early it will be null. Therefore you should only use this variant if you know it will become managed before it is referenced. The other variant allows you to check and wait for a config to become managed.      
    </p>
    <H4>Variant 2: A static instantiated ManagedConfig&amp;lt;ConfigModel&amp;gt; member. </H4>
    <p>
      Example:      
    </p>
    <pre>
      <code>
    @APSConfigDescription(
        version="1.0",
        configId=”se.natusoft.aps.exmple.myconfig”,
        group=”examples”,
        description=”An example configuration model”
    )
    public class MyConfig extends APSConfig {
        
    —&gt;  public static final ManagedConfig&lt;MyConfig&gt; managed = new ManagedConfig&lt;MyConfig&gt;();  &lt;—
        
        @APSConfigItemDescription(
            description=”Example of simple value.”,
        )
        public APSConfigValue simpleValue;
        
        @APSConfigItemDescription(
            description=”Example of list value.”
        )
        public APSConfigValueList listValue;
        ...
        
      </code>
    </pre>
    <p>
      There is a possibility that code started in a bundle, especially threads might start running before the config has become managed. In such cases the following will solve that:      
    </p>
    <pre>
      <code>
    if (!MyConfig.managed.isManaged()) {
        MyConfig.managed.waitUntilManaged();
    }
      </code>
    </pre>
    <p>
      Do not ever do this during start() of a Bundle activator! That would cause a never ending dead-lock!      
    </p>
    <p>
      To access this variant of managed config do:      
    </p>
    <pre>
      <code>
    MyConfig.managed.get().simpleValue.toString()/toInt()/toDouble()/...
    
      </code>
    </pre>
    <H2>API Usages</H2>
    <H3>The configuration service usage</H3>
    <p>
      The APSConfigService API looks like this:      
    </p>
    <pre>
      <code>
    public interface APSConfigService {
        void registerConfiguration(Class&lt;? extends APSConfig&gt; configClass, boolean forService) throws APSConfigException;
        void unregisterConfiguration(Class&lt;? extends APSConfig&gt; configClass);
        &lt;Config extends APSConfig&gt; Config getConfiguration(Class&lt;Config&gt; configClass) throws APSConfigException;
    }
      </code>
    </pre>
    <p>
      On bundle start you register the configuration. On bundle stop you unregister it. Inbetween you access it. It is a good idea to call getConfiguration(...) after register on bundle start and the pass this instance to your services, etc.      
    </p>
    <p>
      If the <em>forServices</em> flag is <em>true</em> then this configuration will also be registered in the standard OSGi configuration service. Please be warned however that APSConfigService stores its configuration values in properties files, but with rather complex keys. For non structured, flat configurations it might make some sense to register it with the standard osgi service also, but in most cases there is no point in doing this. I’m not even sure why I have this option!      
    </p>
    <p>
      <em>Please note</em> that if you are using managed configs (see above) then you never need to call this service API, not even lookup/track the APSConfigService!      
    </p>
    <H3>The configuration admin service usage</H3>
    <p>
      The APSconfigAdminService only needs to be used if you implement a configuration editor. APSConfigAdminWeb uses this API for example. See the javadoc for the API.      
    </p>
    <H2>The complete APS API</H2>
    <p>
      The complete APS javadoc can be found at <a href='http://apidoc.natusoft.se/APS/' title=''>http://apidoc.natusoft.se/APS/</a>.      
    </p>
    <H2>A word of advice</H2>
    <p>
      It is quite possible to make config structures of great complexity. <strong>DON'T!</strong> Even if it seems manageable from a code perspective it might not be that from a admin perspective. Keep it simple always apply!      
    </p>
    <H2>APSConfigAdminWeb screenshots</H2>
    <p>
            <img src='file:../../APS-Core/APSConfigServiceProvider/docs/src/../images/config-env.png' title='' alt='Config environment screenshot'/>      
    </p>
    <p>
            <img src='file:../../APS-Core/APSConfigServiceProvider/docs/src/../images/config-env-help.png' title='' alt='Config environment help screenshot'/>      
    </p>
    <p>
            <img src='file:../../APS-Core/APSConfigServiceProvider/docs/src/../images/config.png' title='' alt='Config screenshot'/>      
    </p>
    <p>
            <img src='file:../../APS-Core/APSConfigServiceProvider/docs/src/../images/config-list.png' title='' alt='Config list item screenshot'/>      
    </p>
    <H1>APSFilesystemService</H1>
    <p>
      This provides a filesystem for writing and reading files. This filesystem resides outside of the OSGi server and is for longterm storage, which differs from BundleContext.getDataFile() which resides within bundle deployment. The APSFilesystemService also does not return a File object! It priovides a file area for each unique owner name that is accessed through an API that cannot navigate nor access any files outside of this area. The ”owner” name should be either an application name or a bundle name if it is only used by one bundle.      
    </p>
    <p>
      The APSConfigService uses the APSFilesystemService to store its configurations.      
    </p>
    <H2>Setup</H2>
    <p>
      The <em>aps.filesystem.root</em> system property must be set to point to a root where this service provides its file areas. This is either passed to the JVM at server startup or configured withing the server. Glassfish allows you to configure properties within its admin gui. Virgo does not. If this is not provided the service will use BundleContext.getDataFile(".") as the root, which will work for testing and playing around, but should not be used for more serious purposes since this is not a path with a long term availability.      
    </p>
    <H2>The service</H2>
    <p>
      The service allows you to create or get an APSFilesystem object. From that object you can create/read/delete directories (represented by APSDirectory) and files (represented by APSFile). You can get readers, writers, input streams and output streams from files. All paths are relative to the file area represented by the APSFilesystem object.      
    </p>
    <p>
      The javadoc for the <a href='http://apidoc.natusoft.se/APS/se/natusoft/osgi/aps/api/core/filesystem/service/APSFilesystemService.html' title=''>APSFilesystemService</a>.      
    </p>
    <H2>The APIs for this service</H2>
    <p>
      public <em>interface</em> <strong>APSDirectory </strong> extends  APSFile    [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <blockquote>
      <p>
         This represents a directory in an APSFilesystem.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Use this to create or get directories and files and list contents of directories.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Personal comment: I do prefer the term "folder" over "directory" since I think that is less ambigous, but since Java uses the term "directory" I decided to stick with that name.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory createDir(String name) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns a newly created directory with the specified name.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the directory to create.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory createDir(String name, String duplicateMessage) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns a newly created directory with the specified name.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the directory to create.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>duplicateMessage</em> - The exception message if directory already exists.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile createFile(String name) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new file in the directory represented by the current APSDirectory.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the file to create.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getDir(String dirname) throws FileNotFoundException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the specified directory.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>dirname</em> - The name of the directory to enter.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>FileNotFoundException</em>        
      </p>
    </blockquote>
    <p>
      <strong>APSFile getFile(String name)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the named file in this directory.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the file to get.         
      </p>
    </blockquote>
    <p>
      <strong>void recursiveDelete() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Performs a recursive delete of the directory represented by this APSDirectory and all subdirectories and files.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>String[] list()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.list()        
      </p>
    </blockquote>
    <p>
      <strong>APSFile[] listFiles()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.listFiles()        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFile </strong>   [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <blockquote>
      <p>
         This represents a file in an APSFilesystemService provided filsystem. It provides most of the API of java.io.File but is not a File! It never discloses the full path in the host filesystem, only paths relative to its APSFilesystem root.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Use the createInputStream/OutputStream/Reader/Writer to read and write the file.         
      </p>
    </blockquote>
    <p>
      <strong>InputStream createInputStream() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new InputStream to this file.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>OutputStream createOutputStream() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new OutputStream to this file.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Reader createReader() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new Reader to this file.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Writer createWriter() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new Writer to this file.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>Properties loadProperties() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         If this file denotes a properties file it is loaded and returned.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure or if it is not a properties file.         
      </p>
    </blockquote>
    <p>
      <strong>void saveProperties(Properties properties) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         If this file denotes a properties file it is written with the specified properties.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>properties</em> - The properties to save.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure or if it is not a properties file.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory toDirectory()</strong>      
    </p>
    <blockquote>
      <p>
         If this APSFile represents a directory an APSDirectory instance will be returned. Otherwise null will be returned.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile getAbsoluteFile()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getAbsoluteFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getAbsolutePath()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the absolute path relative to filesystem root.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile getCanonicalFile() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getCanonicalFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getCanonicalPath() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getCanonicalPath()        
      </p>
    </blockquote>
    <p>
      <strong>String getParent()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getParent()        
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getParentFile()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getParentFile()        
      </p>
    </blockquote>
    <p>
      <strong>String getPath()</strong>      
    </p>
    <blockquote>
      <p>
                  
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getPath()        
      </p>
    </blockquote>
    <p>
      <strong>boolean renameTo(APSFile dest)</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.renameTo(File)        
      </p>
    </blockquote>
    <p>
      <strong>String getName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.getName()        
      </p>
    </blockquote>
    <p>
      <strong>boolean canRead()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.canRead()        
      </p>
    </blockquote>
    <p>
      <strong>boolean canWrite()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.canWrite()        
      </p>
    </blockquote>
    <p>
      <strong>boolean exists()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.exists()        
      </p>
    </blockquote>
    <p>
      <strong>boolean isDirectory()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isDirectory()        
      </p>
    </blockquote>
    <p>
      <strong>boolean isFile()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isFile()        
      </p>
    </blockquote>
    <p>
      <strong>boolean isHidden()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.isHidden()        
      </p>
    </blockquote>
    <p>
      <strong>long lastModified()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.lastModified()        
      </p>
    </blockquote>
    <p>
      <strong>long length()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.length()        
      </p>
    </blockquote>
    <p>
      <strong>boolean createNewFile() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.createNewFile()        
      </p>
    </blockquote>
    <p>
      <strong>boolean delete()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.delete()        
      </p>
    </blockquote>
    <p>
      <strong>void deleteOnExit()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>See</em>      
    </p>
    <blockquote>
      <p>
        java.io.File.deleteOnExit()        
      </p>
    </blockquote>
    <p>
      <strong>String toString()</strong>      
    </p>
    <blockquote>
      <p>
         Returns a string representation of this APSFileImpl.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFilesystem </strong>   [se.natusoft.osgi.aps.api.core.filesystem.model] {      
    </p>
    <blockquote>
      <p>
         This represents an APSFilesystemService filesytem.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getDirectory(String path) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns a folder at the specified path.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>path</em> - The path of the folder to get.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure, specifically if the specified path is not a folder or doesn't exist.         
      </p>
    </blockquote>
    <p>
      <strong>APSFile getFile(String path)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the file or folder of the specifeid path.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>path</em> - The path of the file.         
      </p>
    </blockquote>
    <p>
      <strong>APSDirectory getRootDirectory()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the root directory.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSFilesystemService </strong>   [se.natusoft.osgi.aps.api.core.filesystem.service] {      
    </p>
    <blockquote>
      <p>
         This provides a filesystem for use by services/applications. Each filesystem has its own root that cannot be navigated outside of.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Services or application using this should do something like this in their activators:         
      </p>
    </blockquote>
    <pre>
      <code>
    APSFilesystemService fss;
    APSFilesystemImpl fs;

    if (fss.hasFilesystem("my.file.system")) {
        fs = fss.getFilsystem("my.file.system");
    }
    else {
        fs = fss.createFilesystem("my.file.system");
    }
      </code>
    </pre>
    <blockquote>
      <p>
                
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>APSFilesystem createFilesystem(String owner) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new filesystem for use by an application or service. Where on disk this filesystem resides is irellevant. It is accessed using the "owner", and will exist until it is removed.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem or rather a unique identifier of it. Concider using application or service package.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure. An already existing filesystem for the "owner" will cause this exception.         
      </p>
    </blockquote>
    <p>
      <strong>boolean hasFilesystem(String owner)</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if the specified owner has a fileystem.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the fileystem or rather a unique identifier of it.         
      </p>
    </blockquote>
    <p>
      <strong>APSFilesystem getFilesystem(String owner) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the filesystem for the specified owner.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem or rahter a unique identifier of it.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      <strong>void deleteFilesystem(String owner) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Removes the filesystem and all files in it.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>owner</em> - The owner of the filesystem to delete.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any failure.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSPlatformService</H1>
    <p>
      This is a trivial little service that just returns meta data about the specific platform installation.      
    </p>
    <p>
      The returned information is configured in the <em>/apsadminweb</em>.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>class</em> <strong>PlatformDescription </strong>   [se.natusoft.osgi.aps.api.core.platform.model] {      
    </p>
    <blockquote>
      <p>
         This model provides information about a platform installation.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public PlatformDescription()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new PlatformDescription.         
      </p>
    </blockquote>
    <p>
      <strong>public PlatformDescription(String identifier, String type, String description)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new PlatformDescription.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>identifier</em> - An identifying name for the platform.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>type</em> - The type of the platform, for example "Development", "SystemTest".         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>description</em> - A short description of the platform instance.         
      </p>
    </blockquote>
    <p>
      <strong>public String getIdentifier()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the platform identifier.         
      </p>
    </blockquote>
    <p>
      <strong>public String getType()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the type of the platform.         
      </p>
    </blockquote>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the description of the platform.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSPlatformService </strong>   [se.natusoft.osgi.aps.api.core.platform.service] {      
    </p>
    <blockquote>
      <p>
         Provides information about the platform instance.         
      </p>
    </blockquote>
    <p>
      <strong>public PlatformDescription getPlatformDescription()</strong>      
    </p>
    <blockquote>
      <p>
         Returns a description of the platform instance / installation.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJSONLib</H1>
    <p>
      This is a library (exports all its packages and provides no service) for reading and writing JSON. It can also write a JavaBean object as JSON and take a JSON value or inputstream containing JSON and produce a JavaBean.      
    </p>
    <p>
      This basically provides a class representing each JSON type: JSONObject, JSONString, JSONNumber, JSONBoolean, JSONArray, JSONNull, and a JSONValue class that is the common base class for all the other. Each class knows how to read and write the JSON type it represents. Then there is a JavaToJSON and a JSONToJava class with static methods for converting back and forth. This mapping is very primitive. There has to be one to one between the JSON and the Java objects.      
    </p>
    <p>
      This does not try to be an alternative to Jackson! This is used internally by other services.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>class</em> <strong>JSON </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This is the official API for reading and writing JSON values.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONValue read(InputStream jsonIn, JSONErrorHandler errorHandler) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Reads any JSON object from the specified InputStream.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONValue subclass. Which depends on what was found on the stream.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonIn</em> - The InputStream to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>errorHandler</em> - An implementation of this interface should be supplied by the user to handle any errors during JSON parsing.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on any IO failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static void write(OutputStream jsonOut, JSONValue value) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes a JSONValue to an OutputStream. This will write compact output by default.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonOut</em> - The OutputStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to write.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static void write(OutputStream jsonOut, JSONValue value, boolean compact) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes a JSONValue to an OutputStream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonOut</em> - The OutputStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to write.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true the written JSON is made very compact and hard to read but produce less data.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONArray </strong> extends  JSONValue  [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This represents the "array" diagram on the above mentioned web page:         
      </p>
    </blockquote>
    <pre>
      <code>
              _______________________
             /                       \
             |                       |
|_____ ([) __/_______ (value) _______\__ (]) _____|
|              /                   \              |
               |                   |
               \_______ (,) _______/
      </code>
    </pre>
    <blockquote>
      <p>
         @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public JSONArray()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONArray for wrinting JSON output.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONArray(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONArray for reading JSON input and writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em>        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void addValue(JSONValue value)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a value to the array.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value to add.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;JSONValue&gt; getAsList()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the array values as a List.         
      </p>
    </blockquote>
    <p>
      <strong>public &lt;T extends JSONValue&gt; List&lt;T&gt; getAsList(Class&lt;T&gt; type)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the array values as a list of a specific type.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A list of specified type if type is the same as in the list.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>type</em> - The class of the type to return values as a list of.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>&lt;T&gt;</em> - One of the JSONValue subclasses.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONBoolean </strong> extends  JSONValue    [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.   @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public JSONBoolean(boolean value)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONBoolean instance for writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value for this boolean.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONBoolean(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONBoolean instance for reading JSON input or writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em>        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setBooleanValue(boolean value)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the value of this boolean.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value to set.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean getAsBoolean()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the value of this boolean.         
      </p>
    </blockquote>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the value of this boolean as a String.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>JSONErrorHandler </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This is called on warnings or failures.   @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
      <strong>void warning(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Warns about something.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The warning message.         
      </p>
    </blockquote>
    <p>
      <strong>void fail(String message, Throwable cause) throws RuntimeException</strong>      
    </p>
    <blockquote>
      <p>
         Indicate failure.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The failure message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of the failure. Can be null!         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>RuntimeException</em> - This method must throw a RuntimeException.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONNull </strong> extends  JSONValue    [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.   @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
      <strong>public JSONNull()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONNull instance for writing JSON output.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONNull(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONNull instance for reading JSON input or writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em>        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        as String.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONNumber </strong> extends  JSONValue    [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This represents the "number" diagram on the above mentioned web page:         
      </p>
    </blockquote>
    <pre>
      <code>
                                      ______________________
                                     /                      \
                                     |                      |
|_|______________ (0) _______________/__ (.) ___ (digit) ___\_________________________|_|
| | \       /  \                    /         /           \  \                      / | |
    |       |  |                   /          \___________/  |                      |
    \_ (-) _/  \_ (digit 1-9) ____/_______                   |                      |
                               /          \                  |                      |
                               \_ (digit) /           _ (e) _|                      |
                                                     |_ (E) _|           ___________|
                                                     |        _ (+) _   /           |
                                                     \_______/_______\__\_ (digit) _/
                                                             \_ (-) _/
      </code>
    </pre>
    <blockquote>
      <p>
         @author Tommy Svesson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public JSONNumber(Number value)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONNumber instance for writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The numeric value.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONNumber(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONNumber instance for reading JSON input or writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em> - The error handle to use.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public Number toNumber()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a Number.         
      </p>
    </blockquote>
    <p>
      <strong>public double toDouble()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a double value.         
      </p>
    </blockquote>
    <p>
      <strong>public float toFloat()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a float value.         
      </p>
    </blockquote>
    <p>
      <strong>public int toInt()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as an int value.         
      </p>
    </blockquote>
    <p>
      <strong>public long toLong()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a long value.         
      </p>
    </blockquote>
    <p>
      <strong>public short toShort()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a short value.         
      </p>
    </blockquote>
    <p>
      <strong>public byte toByte()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a byte value.         
      </p>
    </blockquote>
    <p>
      <strong>public String toString()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        number as String.        
      </p>
    </blockquote>
    <p>
      <strong>public Object to(Class type)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number as a value of the type specified by the type parameter.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>type</em> - The type of the returned number.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONObject </strong> extends  JSONValue    [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        It represents the "object" diagram on the above mentioned web page:         
      </p>
    </blockquote>
    <pre>
      <code>
             ________________________________________
            /                                        \
|___ ({) __/_____ (string) ____ (:) ____ (value) _____\___ (}) ____|
|           /                                        \             |
            \__________________ (,) _________________/

      </code>
    </pre>
    <blockquote>
      <p>
        This is also the starting point.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        To write JSON, create a new JSONObject (new JSONObject()) and call addProperty(name, value) for children. Then do jsonObj.writeJSON(outputStream).         
      </p>
    </blockquote>
    <blockquote>
      <p>
        To read JSON, create a new JSONObject (new JSONObject(jsonErrorHandler)) and then do jsonObj.readJSON(inputStream). Then use getProperty(name) to extract children.    @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public JSONObject()  }  /** * Creates a new JSONObject instance for reading JSON input or writing JSON output. * * errorHandler */ public JSONObject(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a JSONObject instance for writing JSON output.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public Set&lt;JSONString&gt; getPropertyNames()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the names of the available properties.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONValue getProperty(JSONString name)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the named property.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property to get.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONValue getProperty(String name)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the named property.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property to get.         
      </p>
    </blockquote>
    <p>
      <strong>public void addProperty(JSONString name, JSONValue value)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a property to this JSONObject instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The property value.         
      </p>
    </blockquote>
    <p>
      <strong>public void addProperty(String name, JSONValue value)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a property to this JSONObject instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The property value.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONString </strong> extends  JSONValue    [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This represents the "string" diagram on the above mentioned web page:         
      </p>
    </blockquote>
    <pre>
      <code>
           __________________________________________________________________________
          /    ___________________________________________________________________   \
          |   /                                                                   \  |
|___ (") _|___|___ (Any UNICODE character except " or \ or control character) ____|__|_ (") ___|
|           \                                                                  /               |
             |                                                                 |
             \__ (\) ___ (") (quotation mark) _________________________________|
                     |__ (\) (reverse solidus) ________________________________|
                     |__ (/) (solidus) ________________________________________|
                     |__ (b) (backspace) ______________________________________|
                     |__ (f) (formfeed) _______________________________________|
                     |__ (n) (newline) ________________________________________|
                     |__ (r) (carriage return) ________________________________|
                     |__ (t) (orizontal tab) __________________________________|
                     \__ (u) (4 hexadecimal digits) ___________________________/
      </code>
    </pre>
    <blockquote>
      <p>
          @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public JSONString(String value)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONString for writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The value of this JSONString.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONString(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONString for reading JSON input and writing JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorHandler</em>        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>abstract</em> <em>class</em> <strong>JSONValue </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         This class is based on the structure defined on http://www.json.org/.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This is a base class for all other JSON* classes. It represents the "value" diagram on the above mentioned web page:         
      </p>
    </blockquote>
    <pre>
      <code>
                                                  Subclasses
                                                  ----------
|________________ (STRING) ________________|      JSONString
|  |_____________ (NUMBER) _____________|  |      JSONNumber
   |_____________ (OBJECT) _____________|         JSONObject
   |_____________ (ARRAY)  _____________|         JSONArray
   |_____________ (true)   _____________|     \__ JSONBoolean
   |_____________ (false)  _____________|     /
   \_____________ (null)   _____________/         JSONNull

      </code>
    </pre>
    <blockquote>
      <p>
           @author Tommy Svensson         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected JSONValue()  }  /** * Creates a new JSONValue */ protected JSONValue(JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONValue.         
      </p>
    </blockquote>
    <p>
      <strong>protected abstract void readJSON(char c, JSONReader reader) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         This will read the vale from an input stream.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        the last character read.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The first character already read from the input stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>reader</em> - The reader to read from.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>protected abstract void writeJSON(JSONWriter writer, boolean compact) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         This will write the data held by this JSON value in JSON format on the specified stream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>writer</em> - A JSONWriter instance to write with.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true write the JSON as compact as possible. false means readable, indented.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - On IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>protected JSONErrorHandler getErrorHandler()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The user supplied error handler.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected void warn(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Provide a warning.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The warning message.         
      </p>
    </blockquote>
    <p>
      <strong>protected void fail(String message, Throwable cause)</strong>      
    </p>
    <blockquote>
      <p>
         Fails the job.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The failure message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - An eventual cause of the failure. Can be null.         
      </p>
    </blockquote>
    <p>
      <strong>protected void fail(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Fails the job.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The failure message.         
      </p>
    </blockquote>
    <p>
      <strong>public void readJSON(InputStream is) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         This will read the value from an input stream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>is</em> - The input stream to read from.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>public void writeJSON(OutputStream os) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         This writes JSON to the specified OutputStream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>os</em> - The outoutStream to write to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>public void writeJSON(OutputStream os, boolean compact) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         This writes JSON to the specified OutputStream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>os</em> - The outoutStream to write to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>compact</em> - If true write JSON as compact as possible. If false write it readable with indents.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>protected JSONReader(PushbackReader reader, JSONErrorHandler errorHandler)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONReader instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>reader</em> - The PushbackReader to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>errorHandler</em> - The handler for errors.         
      </p>
    </blockquote>
    <p>
      <strong>protected char getChar() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the next character on the specified input stream, setting EOF state checkable with isEOF().          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO problems.         
      </p>
    </blockquote>
    <p>
      <strong>protected char getChar(boolean handleEscapes) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the next character on the specified input stream, setting EOF state checkable with isEOF().          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>handleEscapes</em> - If true then \* escape character are handled.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO problems.         
      </p>
    </blockquote>
    <p>
      <strong>protected void ungetChar(char c) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Unreads the specified character so that the next call to getNextChar() will return it again.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The character to unget.         
      </p>
    </blockquote>
    <p>
      <strong>protected char skipWhitespace(char c) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Skips whitespace returning the first non whitespace character. This also sets the EOF flag.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The first char already read from the input stream.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>protected char skipWhitespace() throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Skips whitespace returning the first non whitespace character. This also sets the EOF flag.          
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>protected char readUntil(String until, char c, StringBuilder sb, boolean handleEscapes) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Reads until any of a specified set of characters occur.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
                
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>until</em> - The characters to stop reading at. The stopping character will be returned unless EOF.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>c</em> - The first preread character.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>sb</em> - If not null read characters are added to this. The stopping character will not be included.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>handleEscapes</em> - True if we are reading a string that should handle escape characters.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>protected char readUntil(String until, StringBuilder sb, boolean string) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Reads until any of a specified set of characters occur.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>until</em> - The characters to stop reading at. The stopping character will be returned unless EOF.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>sb</em> - If not null read characters are added to this. The stopping character will not be included.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>string</em> - True if we are rading a string that should be escaped.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>protected char readUntil(String until, StringBuilder sb) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Reads until any of a specified set of characters occur.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>until</em> - The characters to stop reading at. The stopping character will be returned unless EOF.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>sb</em> - If not null read characters are added to this. The stopping character will not be included.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      <strong>protected boolean checkValidChar(char c, String validChars)</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if c is one of the characters in validChars.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>c</em> - The character to check.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>validChars</em> - The valid characters.         
      </p>
    </blockquote>
    <p>
      <strong>protected void assertChar(char a, char e, String message)</strong>      
    </p>
    <blockquote>
      <p>
         Asserts that char a equals expected char c.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>a</em> - The char to assert.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>e</em> - The expected value.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - Failure message.         
      </p>
    </blockquote>
    <p>
      <strong>protected void assertChar(char a, String expected, String message)</strong>      
    </p>
    <blockquote>
      <p>
         Asserts that char a equals expected char c.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>a</em> - The char to assert.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>expected</em> - String of valid characters.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - Failure message.         
      </p>
    </blockquote>
    <p>
      protected <em>static</em> <em>class</em> <strong>JSONWriter </strong>   [se.natusoft.osgi.aps.json] {      
    </p>
    <blockquote>
      <p>
         For subclasses to use in writeJSON(JSONWriter writer).         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>protected JSONWriter(Writer writer)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONWriter instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>writer</em> - The writer to write to.         
      </p>
    </blockquote>
    <p>
      <strong>protected void write(String json) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes JSON output.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The JSON output to write.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>protected void writeln(String json) throws  IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes JSON output plus a newline.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The JSON output to write.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em>        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>BeanInstance </strong>   [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <blockquote>
      <p>
         This wraps a Java Bean instance allowing it to be populated with data using setProperty(String, Object) methods handling all reflection calls.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public BeanInstance(Object modelInstance)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new ModelInstance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>modelInstance</em> - The model instance to wrap.         
      </p>
    </blockquote>
    <p>
      <strong>public Object getModelInstance()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the test model instance held by this object.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;String&gt; getSettableProperties()</strong>      
    </p>
    <blockquote>
      <p>
         Returns a list of settable properties.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;String&gt; getGettableProperties()</strong>      
    </p>
    <blockquote>
      <p>
         Returns a list of gettable properties.         
      </p>
    </blockquote>
    <p>
      <strong>public void setProperty(String property, Object value) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Sets a property          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The name of the property to set.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value to set with.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on any failure to set the property.         
      </p>
    </blockquote>
    <p>
      <strong>public Object getProperty(String property) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the value of the specified property.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The property value.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The property to return value of.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on failure (probably bad property name!).         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public Class getPropertyType(String property) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Returns the type of the specified property.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The class representing the property type.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>property</em> - The property to get the type for.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - if property does not exist.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JavaToJSON </strong>   [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <blockquote>
      <p>
         Takes a JavaBean and produces a JSONObject.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONObject convertObject(Object javaBean) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Converts a JavaBean object into a JSONObject.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONObject containing all values from the JavaBean.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>javaBean</em> - The JavaBean object to convert.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on converting failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONObject convertObject(JSONObject jsonObject, Object javaBean) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Converts a JavaBean object into a JSONObject.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A JSONObject containing all values from the JavaBean.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonObject</em> - The jsonObject to convert the bean into or null for a new JSONObject.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaBean</em> - The JavaBean object to convert.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - on converting failure.         
      </p>
    </blockquote>
    <p>
      <strong>public static JSONValue convertValue(Object value)</strong>      
    </p>
    <blockquote>
      <p>
         Converts a value from a java value to a JSONValue.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The converted JSONValue.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - The java value to convert. It can be one of String, Number, Boolean, null, JavaBean, or an array of those.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONConvertionException </strong> extends  RuntimeException    [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <blockquote>
      <p>
         This exception is thrown on failure to convert from JSON to Java or Java to JSON.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Almost all exceptions within the APS services and libraries extend either APSException or APSRuntimeException. I decided to just extend RuntimeException here to avoid any other dependencies for this library since it can be useful outside of APS and can be used as any jar if not deployed in OSGi container.         
      </p>
    </blockquote>
    <p>
      <strong>public JSONConvertionException(final String message)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONConvertionException.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message         
      </p>
    </blockquote>
    <p>
      <strong>public JSONConvertionException(final String message, final Throwable cause)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new JSONConvertionException.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of this exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>JSONToJava </strong>   [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <blockquote>
      <p>
         Creates a JavaBean instance and copies data from a JSON value to it.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        The following mappings are made in addition to the expected ones: &lt;ul  &lt;li JSONArray only maps to an array property. li  &lt;li Date properties in bean are mapped from JSONString "yyyy-MM-dd HH:mm:ss" li  &lt;li Enum properties in bean are mapped from JSONString which have to contain enum constant name. li  ul         
      </p>
    </blockquote>
    <p>
      <strong>public static &lt;T&gt; T convert(InputStream jsonStream, Class&lt;T&gt; javaClass) throws IOException, JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Returns an instance of a java class populated with data from a json object value read from a stream.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A populated instance of javaClass.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>jsonStream</em> - The stream to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The java class to instantiate and populate.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failures.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On JSON to Java failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static &lt;T&gt; T convert(String json, Class&lt;T&gt; javaClass) throws IOException, JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Returns an instance of a java class populated with data from a json object value read from a String containing JSON.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A populated instance of javaClass.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The String to read from.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The java class to instantiate and populate.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failures.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On JSON to Java failures.         
      </p>
    </blockquote>
    <p>
      <strong>public static &lt;T&gt; T convert(JSONValue json, Class&lt;T&gt; javaClass) throws JSONConvertionException</strong>      
    </p>
    <blockquote>
      <p>
         Returns an instance of java class populated with data from json.           
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A converted Java object.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>json</em> - The json to convert to java.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>javaClass</em> - The class of the java object to convert to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>JSONConvertionException</em> - On failure to convert.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>SystemOutErrorHandler </strong> implements  JSONErrorHandler    [se.natusoft.osgi.aps.json.tools] {      
    </p>
    <blockquote>
      <p>
         A simple implementation of JSONErrorHandler that simply displays messages on System.out and throws a RuntimeException on fail. This is used by the tests. In a non test case another implementation is probably preferred.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSToolsLib</H1>
    <p>
      This is a library of utilities including a service tracker that beats the (beep) out of the default one including exception rather than null response, timeout specification, getting a proxied service implementation that automatically uses the tracker, allocating a service, calling it, and deallocating it again. This makes it trivially easy to handle a service being restarted or redeployed. It also includes a logger utility that will lookup the standard log service and log to that if found.      
    </p>
    <p>
      This bundle provides no services. It just makes all its packages public. Every bundle included in APS makes use of APSToolsLib so it must be deployed for things to work.      
    </p>
    <p>
      Please note that this bundle has no dependencies! That is, it can be used as is without requireing any other APS bundle.      
    </p>
    <H2>APSServiceTracker</H2>
    <p>
      This does the same thing as the standard service tracker included with OSGi, but does it better with more options and flexibility. One of the differences between this tracker and the OSGi one is that this throws an <em>APSNoServiceAvailableException</em> if the service is not available. Personally I think this is easier to work with than having to check for a null result.      
    </p>
    <p>
      There are several variants of constructors, but here is an example of one of the most used ones within the APS services:      
    </p>
    <pre>
      <code>
    APSServiceTracker&lt;Service&gt; tracker = new APSServiceTracker&lt;Service&gt;(context, Service.class, ”20 seconds”);
    tracker.start();
    
      </code>
    </pre>
    <p>
      Note that the third argument, which is a timeout can also be specified as an int in which case it is always in miliseconds. The string variant supports the a second word of ”sec<a href='' title=''>onds</a>” and ”min<a href='' title=''>utes</a>” which indicates the type of the first numeric value. ”forever” means just that and requires just one word. Any other second words than those will be treated as milliseconds. The APSServiceTracker also has a set of constants for the timeout string value:      
    </p>
    <pre>
      <code>
    public static final String SHORT_TIMEOUT = "3 seconds";
    public static final String MEDIUM_TIMEOUT = "30 seconds";
    public static final String LARGE_TIMEOUT = "2 minutes";
    public static final String VERY_LARGE_TIMEOUT = "5 minutes";
    public static final String HUGE_LARGE_TIMEOUT = "10 minutes";
    public static final String NO_TIMEOUT = "forever";
      </code>
    </pre>
    <p>
      On bundle stop you should do:      
    </p>
    <pre>
      <code>
    tracker.stop(context);
    
      </code>
    </pre>
    <p>
      So that the tracker unregisters itself from receiving bundle/service events.      
    </p>
    <H3>Services and active service</H3>
    <p>
      The tracker tracks all instances of the service being tracked. It however have the notion of an active service. The active service is the service instance that will be returned by allocateService() (which is internally used by all other access methods also). On startup it will be the first service instance received. It will keep tracking other instances comming in, but as long as the active service does not go away it will be the one used. If the active service goes away then the the one that is at the beginning of the list of the other tracked instances will become active. If that list is empty there will be no active, which will trigger a wait for a service to become available again if allocateService() is called.      
    </p>
    <H3>Providing a logger</H3>
    <p>
      You can provide an APSLogger (see further down about APSLogger) to the tracker:      
    </p>
    <pre>
      <code>
    tracker.setLogger(apsLogger);
    
      </code>
    </pre>
    <p>
      When available the tracker will log to this.      
    </p>
    <H3>Tracker as a wrapped service</H3>
    <p>
      The tracker can be used as a wrapped service:      
    </p>
    <pre>
      <code>
    Service service = tracker.getWrappedService();
    
      </code>
    </pre>
    <p>
      This gives you a proxied <em>service</em> instance that that gets the real service, calls it, releases it and return the result. This handles transparently if a service has been restarted or one instance of the service has gone away and another came available. It will wait for the specified timeout for a service to become available and if that does not happen the <em>APSNoServiceAvailableException</em> will be thrown. This is of course a runtime exception which makes the service wrapping possible without loosing the possibility to handle the case where the service is not available.      
    </p>
    <H3>Using the tracker in a similar way to the OSGi standard tracker</H3>
    <p>
      To get a service instance you do:      
    </p>
    <pre>
      <code>
    Service service = tracker.allocateService();
    
      </code>
    </pre>
    <p>
      Note that if the tracker has a timeout set then this call will wait for the service to become available if it is currently not available until an instance becomes available or the timeout time is reached. It will throw <em>APSNoServiceAvailableException</em> on failure in any case.      
    </p>
    <p>
      When done with the service do:      
    </p>
    <pre>
      <code>
    tracker.releaseService();
      </code>
    </pre>
    <H3>Accessing a service by tracker callback</H3>
    <p>
      There are a few variants to get a service instance by callback. When the callbacks are used the actual service instance will only be allocated during the callback and then released again.      
    </p>
    <H4>onServiceAvailable</H4>
    <p>
      This will result in a callback when any instance of the service becomes available. If there is more than one service instance published then there will be a callback for each.      
    </p>
    <pre>
      <code>
        tracker.onServiceAvailable(new OnServiceAvailable&lt;Service&gt;() {
            @Override
            public void onServiceAvailable(Service service, ServiceReference serviceReference) throws Exception {
                // Do something.
            }
        });
      </code>
    </pre>
    <H4>onServiceLeaving</H4>
    <p>
      This will result in a callback when any instance of the service goes away. If there is more than one service instance published the there will be a callback for each instance leaving.      
    </p>
    <pre>
      <code>
        onServiceLeaving(new OnServiceLeaving&lt;Service&gt;() {
    
            @Override
            public void onServiceLeaving(ServiceReference service, Class serviceAPI) throws Exception {
                // Handle the service leaving.
            }
        });
      </code>
    </pre>
    <p>
      Note that since the service is already gone by this time you don’t get the service instance, only its reference and the class representing its API. In most cases both of these parameters are irellevant.      
    </p>
    <H4>onActiveServiceAvailable</H4>
    <p>
      This does the same thing as onServiceAvailable() but only for the active service. It uses the same <em>OnServiceAvailable</em> interface.      
    </p>
    <H4>onActiveServiceLeaving</H4>
    <p>
      This does the same thing as onServiceLeaving() but for the active service. It uses the same <em>OnServiceLeaving</em> interface.      
    </p>
    <H4>withService</H4>
    <p>
      Runs the specified callback providing it with a service to use. This will wait for a service to become available if a timeout has been provided for the tracker.      
    </p>
    <p>
      Don't use this in an activator start() method! onActiveServiceAvailable() and onActiveServiceLeaving() are safe in a start() method, this is not!      
    </p>
    <pre>
      <code>
        tracker.withService(new WithService&lt;Service&gt;() {
            @Override
            public void withService(Service service, Object... args) throws Exception {
                // do something here.
            }
        }, arg1, arg2);
      </code>
    </pre>
    <p>
      If you don’t have any arguments this will also work:      
    </p>
    <pre>
      <code>
        tracker.withService(new WithService&lt;Service&gt;() {
            @Override
            public void withService(Service service) throws Exception {
                // do something here
            }
        });
      </code>
    </pre>
    <H4>withServiceIfAvailable</H4>
    <p>
      This does the same as withService(...) but without waiting for a service to become available. If the service is not available at the time of the call the callback will not be called. No exception is thrown by this!      
    </p>
    <H4>withAllAvailableServices</H4>
    <p>
      This is used exactly the same way as withService(...), but the callback will be done for each tracked service instance, not only the active.      
    </p>
    <H2>APSLogger</H2>
    <p>
      This provides logging functionality. The no args constructor will log to System.out by default. The OutputStream constructor will logg to the specified output stream by default.      
    </p>
    <p>
      The APSLogger can be used by just creating an instance and then start using the info(...), error(...), etc methods. But in that case it will only log to System.out or the provided OutputStream. If you however do this:      
    </p>
    <pre>
      <code>
    APSLogger logger = new APSLogger();
    logger.start(context);
    
      </code>
    </pre>
    <p>
      then the logger will try to get hold of the standard OSGi LogService and if that is available log to that. If the log service is not available it will fallback to the OutputStream.      
    </p>
    <p>
      If you call the <code>setServiceRefrence(serviceRef);</code> method on the logger then information about that service will be provied with each log.      
    </p>
    <H2>APSContextWrapper</H2>
    <p>
      This provides a static wrap(...) method:      
    </p>
    <pre>
      <code>
    Service providedService = APSContextWrapper.wrap(serviceProvider, Service.class);
    
      </code>
    </pre>
    <p>
      where <em>serviceProvider</em> is an instance of a class that implements <em>Service</em>. The resulting instance is a java.lang.reflect.Proxy implementation of <em>Service</em> that ensures that the <em>serviceProvider</em> ClassLoader is the context class loader during each call to all service methods that are annotated with @APSRunInBundlesContext annotation in <em>Service</em>. The wrapped instance can then be registered as the OSGi service provider.      
    </p>
    <p>
      Normally the threads context class loader is the original service callers context class loader. For a web application it would be the web containers context class loader. If a service needs its own bundles class loader during its execution then this wrapper can be used.      
    </p>
    <H2>ID generators</H2>
    <p>
      There is one interface:      
    </p>
    <pre>
      <code>
    /**
     * This is a generic interface for representing IDs. 
     */
    public interface ID extends Comparable&lt;ID&gt; {
    
        /**
         * Creates a new unique ID.
         *
         * @return A newly created ID.
         */
        public ID newID();
    
        /**
         * Tests for equality.
         *
         * @param obj The object to compare with.
         *
         * @return true if equal, false otherwise.
         */
        @Override
        public boolean equals(Object obj);
    
        /**
         * @return The hash code.
         */
        @Override
        public int hashCode();
    
    }
      </code>
    </pre>
    <p>
      that have 2 implementations:      
    </p>
    <ul>
      <li>
        <p>
          IntID - Produces int ids.          
        </p>
      </li>
      <li>
        <p>
          UUID - Produces java.util.UUID Ids.          
        </p>
      </li>
    </ul>
    <H1>APSWebTools</H1>
    <p>
      This is not an OSGi bundle! This is a plain jar containing utilities for web applications. Specifically APS administration web applications. This jar has to be included in each web application that wants to use it.      
    </p>
    <p>
      Among other things it provides support for being part of the APS administration web login (APSAdminWebLoginHandler). Since the APS administration web is built using Vaadin it has Vaadin support classes. APSVaadinOSGiApplication is a base class used by all APS administration webs.      
    </p>
    <H2>APIs</H2>
    <p>
      The following are the APIs for a few selected classes. The complete javadoc for this library can be found at <a href='http://apidoc.natusoft.se/APSWebTools' title=''>http://apidoc.natusoft.se/APSWebTools</a>.      
    </p>
    <hr/>    <p>
      public <em>class</em> <strong>APSAdminWebLoginHandler </strong> extends  APSLoginHandler  implements  APSLoginHandler.HandlerInfo    [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <blockquote>
      <p>
         This is a login handler to use by any admin web registering with the APSAdminWeb to validate that there is a valid login available.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public APSAdminWebLoginHandler(BundleContext context)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSAdminWebLoginHandler.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>context</em> - The bundle context.         
      </p>
    </blockquote>
    <p>
      <strong>public void setSessionIdFromRequestCookie(HttpServletRequest request)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the session id from a cookie in the specified request.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>request</em> - The request to get the session id cookie from.         
      </p>
    </blockquote>
    <p>
      <strong>public void saveSessionIdOnResponse(HttpServletResponse response)</strong>      
    </p>
    <blockquote>
      <p>
         Saves the current session id on the specified response.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>response</em> - The response to save the session id cookie on.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSLoginHandler </strong> implements  LoginHandler    [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <blockquote>
      <p>
         This class validates if there is a valid logged in user and also provides a simple login if no valid logged in user exists.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This utility makes use of APSAuthService to login auth and APSSessionService for session handling. Trackers for these services are created internally which requires the shutdown() method to be called when no longer used to cleanup.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        The bundle needs to import the following packages for this class to work:         
      </p>
    </blockquote>
    <pre>
      <code>
   se.natusoft.osgi.aps.api.auth.user;version="[0.9,2)",
   se.natusoft.osgi.aps.api.misc.session;version="[0.9,2)"
      </code>
    </pre>
    <blockquote>
      <p>
                
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public APSLoginHandler(BundleContext context, HandlerInfo handlerInfo)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new VaadinLoginDialogHandler.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>context</em> - The bundles BundleContext.         
      </p>
    </blockquote>
    <p>
      <strong>protected void setHandlerInfo(HandlerInfo handlerInfo)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the handler info when not provided in constructor.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>handlerInfo</em> - The handler info to set.         
      </p>
    </blockquote>
    <p>
      <strong>public void shutdown()</strong>      
    </p>
    <blockquote>
      <p>
         Since this class internally creates and starts service trackers this method needs to be called on shutdown to cleanup!         
      </p>
    </blockquote>
    <p>
      <strong>public String getLoggedInUser()</strong>      
    </p>
    <blockquote>
      <p>
         This returns the currently logged in user or null if none are logged in.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public boolean hasValidLogin()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if this handler sits on a valid login.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean login(String userId, String pw)</strong>      
    </p>
    <blockquote>
      <p>
         Logs in with a userid and a password.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if successfully logged in, false otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean login(String userId, String pw, String requiredRole)</strong>      
    </p>
    <blockquote>
      <p>
         Logs in with a userid and a password.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        This method does not use or modify any internal state of this object! It only uses the APSUserService that this object sits on. This allows code sitting on an instance of this class to use this method for validating a user without having to setup its own service tracker for the APSUserService when this object is already available due to the code also being an APSAdminWeb member. It is basically a convenience.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        a valid User object on success or null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requiredRole</em> - If non null the user is required to have this role for a successful login. If it doesn't null will         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>interface</em> <strong>HandlerInfo </strong>   [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <blockquote>
      <p>
         Config values for the login handler.         
      </p>
    </blockquote>
    <p>
      <strong>String getSessionId()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An id to an APSSessionService session.        
      </p>
    </blockquote>
    <p>
      <strong>void setSessionId(String sessionId)</strong>      
    </p>
    <blockquote>
      <p>
         Sets a new session id.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The session id to set.         
      </p>
    </blockquote>
    <p>
      <strong>String getUserSessionName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the session data containing the logged in user if any.        
      </p>
    </blockquote>
    <p>
      <strong>String getRequiredRole()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The required role of the user for it to be considered logged in.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>LoginHandler </strong>   [se.natusoft.osgi.aps.tools.web] {      
    </p>
    <blockquote>
      <p>
         This is a simple API for doing a login.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean hasValidLogin()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if this handler sits on a valid login.         
      </p>
    </blockquote>
    <p>
      <strong>boolean login(String userId, String pw)</strong>      
    </p>
    <blockquote>
      <p>
         Logs in with a userid and a password.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if successfully logged in, false otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to login.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>pw</em> - The password of the user to login.         
      </p>
    </blockquote>
    <p>
      <strong>public void shutdown()</strong>      
    </p>
    <blockquote>
      <p>
         If the handler creates service trackers or other things that needs to be shutdown when no longer used this methods needs to be called when the handles is no longer needed.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSAuthService</H1>
    <p>
      This is a very simple little service that only does authentication of users. This service is currently used by the APS administration web (/apsadminweb) and APSExtProtocolHTTPTransportProvider for remote calls to services over http.      
    </p>
    <p>
      The idea behing this service is that it should be easy to provide an implementation of this that uses whatever authentication scheme you want/need. If you have an LDAP server you want to authenticate against for example, provide an implementation that looks up and authenticates the user agains the LDAP server.      
    </p>
    <p>
      See this a little bit lika an authentication plugin.      
    </p>
    <p>
      The APS web applications that use this only uses password authentication.      
    </p>
    <H2>APSSimpleUserServiceAuthServiceProvider</H2>
    <p>
      This provides an APSAuthService that uses the APSSimpleUserService to authenticate users. It only supports password authentication. If you don’t have your own implementation of APSAuthService then you can deploy this one along with APSSimpleUserService, and probably APSUserAdminWeb.      
    </p>
    <H2>API</H2>
    <p>
      public <em>interface</em> <strong>APSAuthService&lt;Credential&gt; </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         This is intended to be used as a wrapper to other means of authentication. Things in APS that needs authentication uses this service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Implementations can lookup the user in an LDAP for example, or use some other user service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        APS supplies an APSSimpleUserServiceAuthServiceProvider that uses the APSSimpleUserService to authenticate. It is provided in its own bundle.         
      </p>
    </blockquote>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <blockquote>
      <p>
         This authenticates a user. A Properties object is returned on successful authentication. null is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod, String role) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <blockquote>
      <p>
         This authenticates a user. A Properties object is returned on successful authentication. null is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>role</em> - The specified user must have this role for authentication to succeed. Please note that the APS admin webs will pass "apsadmin" for the role. The implementation might need to translate this to another role.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>AuthMethod[] getSupportedAuthMethods()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an array of the AuthMethods supported by the implementation.         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>enum</em> <strong>AuthMethod </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         This hints at how to use the credentials.         
      </p>
    </blockquote>
    <p>
      <strong>NONE</strong>      
    </p>
    <blockquote>
      <p>
         Only userid is required.         
      </p>
    </blockquote>
    <p>
      <strong>PASSWORD</strong>      
    </p>
    <blockquote>
      <p>
         toString() on the credentials object should return a password.         
      </p>
    </blockquote>
    <p>
      <strong>KEY</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a key of some sort.         
      </p>
    </blockquote>
    <p>
      <strong>CERTIFICATE</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a certificate of some sort.         
      </p>
    </blockquote>
    <p>
      <strong>DIGEST</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a digest password.         
      </p>
    </blockquote>
    <p>
      <strong>SSO</strong>      
    </p>
    <blockquote>
      <p>
         The credential object contains information for participating in a single sign on.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSSimpleUserService</H1>
    <p>
      This is an simple, easy to use service for handling logged in users. It provides two services: APSSimpleUserService and APSSimpleUserServiceAdmin. The latter handles all creation, editing, and deletion of roles and users. This service in itself does not require any authentication to use! Thereby you have to trust all code in the server! The APSUserAdminWeb WAB bundle however does require a user with role ’apsadmin’ to be logged in or it will simply repsond with a 401 (UNAUTHORIZED).      
    </p>
    <p>
      So why this and not org.osgi.service.useradmin ? Well, maybe I’m just stupid, but <em>useradmin</em> does not make sense to me. It seems to be missing things, specially for creating. You can create a role, but you cannot create a user. There is no obvious authentication of users. Maybee that should be done via the credentials Dictionary, but what are the expected keys in there ?      
    </p>
    <H2>Basic example</H2>
    <p>
      To login a user do something like this:      
    </p>
    <pre>
      <code>
    APSSimpleUserService userService ...
    ...
    User user = userService.getUser(userId);
    if (user == null) {
        throw new AuthException(”Bad login!”);
    }
    if (!userService.authenticateUser(user, password, APSSimpleUserService.AUTH_METHOD_PASSWORD)) {
        throw new AuthException(”Bad login!”);
    }
    ...
    if (user.isAuthenticated() &amp;&amp; user.hasRole(”apsadmin”)) {
        ...
    }
    
      </code>
    </pre>
    <H2>Setup</H2>
    <p>
      The following SQL is needed to create the database tables used by the service.      
    </p>
    <pre>
      <code>
    /*
     * This represents one role.
     */
    create table role (
      /* The id and key of the role. */
      id varchar(50) not null primary key,
    
      /* A short description of what the role represents. */
      description varchar(200),
    
      /* 1 == master role, 0 == sub-role. */
      master int
    );
    
    /*
     * This represents one user.
     */
    create table svcuser (
      /* User id and also key. */
      id varchar(50) not null primary key,
    
      /* For the provided implementation this is a password. */
      auth varchar(2000),
    
      /*
       * The service stores string properties for the user here as one long string.
       * These are not meant to be searchable only to provide information about the
       * user.
       *
       * You might want to adapt this size to the amount of data you will be adding
       * to a user.
       */
      user_data varchar(4000)
    );
    
    /*
     * A user can have one or more roles.
     */
    create table user_role (
      user_id varchar(50) not null,
      role_id varchar(50) not null,
      primary key (user_id, role_id),
      foreign key (user_id) references svcuser (id),
      foreign key (role_id) references role (id)
    );
    
    /*
     * A role can have one ore more sub-roles.
     */
    create table role_role (
      master_role_id varchar(50) not null,
      role_id varchar(50) not null,
      primary key (master_role_id, role_id),
      foreign key (master_role_id) references role (id),
      foreign key (role_id) references role (id)
    );
    
    /*
     * ---- This part is mostly an example ----
     * WARNING: You do however need a role called 'apsadmin' to be able to login to
     * /apsadminweb! The name of the user having that role does not matter. As long
     * as it is possible to login to /apsadminweb new roles and users can be created
     * there.
     */
    
    /* The following adds an admin user. */
    insert into role VALUES ('apsadmin', 'Default admin for APS', 1);
    insert into svcuser VALUES ('apsadmin', 'admin', '');
    insert into user_role VALUES ('apsadmin', 'apsadmin');
    
    /* This adds a role for non admin users. */
    insert into role VALUES ('user', 'Plain user', 1);
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      </code>
    </pre>
    <!--
      
The above empty lines are required due to a bug in iText used to render the PDF. It will move the picture to the next page completely out of context since text after the picture will then come before it. 
    -->
    <p>
      After the tables have been created you need to configure a datasource for it in /apsadminweb configuration tab:      
    </p>
    <p>
            <img src='file:../../APS-Auth/APSSimpleUserServiceProvider/docs/src/../images/DataSourceConfig.png' title='' alt='Picture of datasource config gui.'/>      
    </p>
    <p>
      Please note that the above picture is just an example. The data source name <strong>APSSimpleUserServiceDS</strong> is however important. The service will be looking up the entry with that name! The rest of the entry depends on your database and where it is running. Also note that the ”(default)” after the field names in the above picture are the name of the currently selected configuration environment. This configuration is configuration environment specific. You can point out different database servers for different environments for example.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSAuthService&lt;Credential&gt; </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         This is intended to be used as a wrapper to other means of authentication. Things in APS that needs authentication uses this service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Implementations can lookup the user in an LDAP for example, or use some other user service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        APS supplies an APSSimpleUserServiceAuthServiceProvider that uses the APSSimpleUserService to authenticate. It is provided in its own bundle.         
      </p>
    </blockquote>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <blockquote>
      <p>
         This authenticates a user. A Properties object is returned on successful authentication. null is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>Properties authUser(String userId, Credential credentials, AuthMethod authMethod, String role) throws APSAuthMethodNotSupportedException</strong>      
    </p>
    <blockquote>
      <p>
         This authenticates a user. A Properties object is returned on successful authentication. null is returned on failure. The Properties object returned contains misc information about the user. It can contain anything or nothing at all. There can be no assumptions about its contents!          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        User properties on success, null on failure.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>credentials</em> - What this is depends on the value of AuthMethod. It is up to the service implementation to resolve this.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - This hints at how to interpret the credentials.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>role</em> - The specified user must have this role for authentication to succeed. Please note that the APS admin webs will pass "apsadmin" for the role. The implementation might need to translate this to another role.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSAuthMethodNotSupportedException</em> - If the specified authMethod is not supported by the implementation.         
      </p>
    </blockquote>
    <p>
      <strong>AuthMethod[] getSupportedAuthMethods()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an array of the AuthMethods supported by the implementation.         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>enum</em> <strong>AuthMethod </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         This hints at how to use the credentials.         
      </p>
    </blockquote>
    <p>
      <strong>NONE</strong>      
    </p>
    <blockquote>
      <p>
         Only userid is required.         
      </p>
    </blockquote>
    <p>
      <strong>PASSWORD</strong>      
    </p>
    <blockquote>
      <p>
         toString() on the credentials object should return a password.         
      </p>
    </blockquote>
    <p>
      <strong>KEY</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a key of some sort.         
      </p>
    </blockquote>
    <p>
      <strong>CERTIFICATE</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a certificate of some sort.         
      </p>
    </blockquote>
    <p>
      <strong>DIGEST</strong>      
    </p>
    <blockquote>
      <p>
         The credential object is a digest password.         
      </p>
    </blockquote>
    <p>
      <strong>SSO</strong>      
    </p>
    <blockquote>
      <p>
         The credential object contains information for participating in a single sign on.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSimpleUserService </strong>   [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         This is the API of a simple user service that provide basic user handling that will probably be enough in many cases, but not all.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Please note that this API does not declare any exceptions! In the case of an exception being needed the APSSimpleUserServiceException should be thrown. This is a runtime exception.         
      </p>
    </blockquote>
    <p>
      <strong>public static final String AUTH_METHOD_PASSWORD = "password"</strong>      
    </p>
    <blockquote>
      <p>
         Password authentication method for authenticateUser().         
      </p>
    </blockquote>
    <p>
      <strong>public Role getRole(String roleId)</strong>      
    </p>
    <blockquote>
      <p>
         Gets a role by its id.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A Role object representing the role or null if role was not found.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleId</em> - The id of the role to get.         
      </p>
    </blockquote>
    <p>
      <strong>public User getUser(String userId)</strong>      
    </p>
    <blockquote>
      <p>
         Gets a user by its id.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A User object representing the user or null if userId was not found.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>userId</em> - The id of the user to get.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean authenticateUser(User user, Object authentication, String authMethod)</strong>      
    </p>
    <blockquote>
      <p>
         Authenticates a user using its user id and user provided authentication.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if authenticated, false otherwise. If true user.isAuthenticated() will also return true.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The User object representing the user to authenticate.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authentication</em> - The user provided authentication data. For example if AuthMethod is AUTH_METHOD_PASSWORD         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authMethod</em> - Specifies what authentication method is wanted.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSimpleUserServiceAdmin </strong> extends  APSSimpleUserService    [se.natusoft.osgi.aps.api.auth.user] {      
    </p>
    <blockquote>
      <p>
         Admin API for APSSimpleUserService.         
      </p>
    </blockquote>
    <p>
      <strong>public RoleAdmin createRole(String name, String description)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new role.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        a new Role object representing the role.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the role. This is also the key and cannot be changed.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>description</em> - A description of the role. This can be updated afterwards.         
      </p>
    </blockquote>
    <p>
      <strong>public void updateRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Updates a role.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to update.         
      </p>
    </blockquote>
    <p>
      <strong>public void deleteRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Deletes a role.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to delete. This will likely fail if there are users still having this role!         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;RoleAdmin&gt; getRoles()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all available roles.         
      </p>
    </blockquote>
    <p>
      <strong>public UserAdmin createUser(String id)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new user. Please note that you get an empty user back. You probably want to add roles and also possibly properties to the user. After you have done that call updateUser(user).          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A User object representing the new user.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>id</em> - The id of the user. This is key so it must be unique.         
      </p>
    </blockquote>
    <p>
      <strong>public void updateUser(User user)</strong>      
    </p>
    <blockquote>
      <p>
         Updates a user.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to update.         
      </p>
    </blockquote>
    <p>
      <strong>public void deleteUser(User user)</strong>      
    </p>
    <blockquote>
      <p>
         Deletes a user.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to delete.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;UserAdmin&gt; getUsers()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all users.         
      </p>
    </blockquote>
    <p>
      <strong>public void setUserAuthentication(User user, String authentication)</strong>      
    </p>
    <blockquote>
      <p>
         Sets authentication for the user.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>user</em> - The user to set authentication for.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>authentication</em> - The authentication to set.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSAuthMethodNotSupportedException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.auth.user.exceptions] {      
    </p>
    <blockquote>
      <p>
         This is thrown by APSAuthService when the implementation does not support the selected auth method.         
      </p>
    </blockquote>
    <p>
      <strong>public APSAuthMethodNotSupportedException(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSAuthMethodNotSupportedException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <p>
      <strong>public APSAuthMethodNotSupportedException(String message, Throwable cause)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSAuthMethodNotSupportedException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The exception that is the cause of this one.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSSimpleUserServiceException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.auth.user.exceptions] {      
    </p>
    <blockquote>
      <p>
         Indicates a problem with the APSSimpleUserService.         
      </p>
    </blockquote>
    <p>
      <strong>public APSSimpleUserServiceException(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSSimpleUserServiceException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <p>
      <strong>public APSSimpleUserServiceException(String message, Throwable cause)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSSimpleUserServiceException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of the exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>Role </strong> extends  Comparable&lt;Role&gt;    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <blockquote>
      <p>
         This defines a role.         
      </p>
    </blockquote>
    <p>
      <strong>public String getId()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The id of the role.        
      </p>
    </blockquote>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of the role.        
      </p>
    </blockquote>
    <p>
      <strong>public boolean hasRole(String roleName)</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if the role has the specified sub role name.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleName</em> - The name of the role to check for.         
      </p>
    </blockquote>
    <p>
      <strong>boolean isMasterRole()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if this role is a master role. Only master roles can be added to users.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RoleAdmin </strong> extends  Role    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <blockquote>
      <p>
         Provides update API for Role.         
      </p>
    </blockquote>
    <p>
      <strong>public void setDescription(String description)</strong>      
    </p>
    <blockquote>
      <p>
         Changes the description of the role.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>description</em> - The new description.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;Role&gt; getRoles()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all sub roles for this role.         
      </p>
    </blockquote>
    <p>
      <strong>public void addRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a sub role to this role.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Removes a sub role from this role.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void setMasterRole(boolean masterRole)</strong>      
    </p>
    <blockquote>
      <p>
         Sets whether this is a master role or not.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>masterRole</em> - true for master role.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>User </strong> extends  Comparable&lt;User&gt;    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <blockquote>
      <p>
         This defines a User.         
      </p>
    </blockquote>
    <p>
      <strong>public String getId()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the unique id of the user.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean isAuthenticated()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if this user is authenticated.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean hasRole(String roleName)</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if the user has the specified role name.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>roleName</em> - The name of the role to check for.         
      </p>
    </blockquote>
    <p>
      <strong>public Properties getUserProperties()</strong>      
    </p>
    <blockquote>
      <p>
         This provides whatever extra information about the user you want. How to use this is upp to the user of the service. There are some constants in this class that provide potential keys for the user properties.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Please note that the returned properties are read only!         
      </p>
    </blockquote>
    <p>
      <strong>public static final String USER_NAME = "name"</strong>      
    </p>
    <blockquote>
      <p>
         Optional suggestion for user properties key.         
      </p>
    </blockquote>
    <p>
      <strong>public static final String USER_PHONE = "phone"</strong>      
    </p>
    <blockquote>
      <p>
         Optional suggestion for user properties key.         
      </p>
    </blockquote>
    <p>
      <strong>public static final String USER_PHONE_WORK = "phone.work"</strong>      
    </p>
    <blockquote>
      <p>
         Optional suggestion for user properties key.         
      </p>
    </blockquote>
    <p>
      <strong>public static final String USER_PHONE_HOME = "phone.home"</strong>      
    </p>
    <blockquote>
      <p>
         Optional suggestion for user properties key.         
      </p>
    </blockquote>
    <p>
      <strong>public static final String USER_EMAIL = "email"</strong>      
    </p>
    <blockquote>
      <p>
         Optional suggestion for user properties key.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>UserAdmin </strong> extends  User    [se.natusoft.osgi.aps.api.auth.user.model] {      
    </p>
    <blockquote>
      <p>
         Provides update API for the User.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;Role&gt; getRoles()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all roles for this user.         
      </p>
    </blockquote>
    <p>
      <strong>public void addRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a role to this user.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeRole(Role role)</strong>      
    </p>
    <blockquote>
      <p>
         Removes a role from this user.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>role</em> - The role to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void addUserProperty(String key, String value)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a user property.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>key</em> - The key of the property.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>value</em> - The value of the property.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeUserProperty(String key)</strong>      
    </p>
    <blockquote>
      <p>
         Removes a user property.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>key</em> - The key of the property to remove.         
      </p>
    </blockquote>
    <p>
      <strong>public void setUserProperties(Properties properties)</strong>      
    </p>
    <blockquote>
      <p>
         Sets properties for the user.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        To update the user properties either first do getProperties() do your changes, and then call this method with the changed properties or just use the addUserProperty() and removeUserProperty() methods.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>properties</em> - The properties to set.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <!--
      
    This is a source file that will be generated into pdf, html and markdown complete with javadoc input
    and put directly under docs.
    -->
    <H1>APSDataSource</H1>
    <p>
      This is a service that provides named data source definitions. It does <strong>not</strong> provided pooled <em>javax.sql.DataSource</em> instances!! It only provides definitions with connection url, driver name, user and password. This service can be used by other services that provide DataSource pooling for example. The APSSimpleUserServiceProvider makes use of this service by looking up ”APSSimpleUserServiceDS” passing the information on to the APSJPAService in its properties. Not everything can make use of an <em>javax.sql.DataSource</em>, but everything can make use of the information provided by this service.      
    </p>
    <p>
      The actual data source definitions are configured in the <em>/apsadminweb</em> under configuration group ”persistence”.      
    </p>
    <H2>APIs</H2>
    <p>
      The complete APS javadoc can be found at <a href='http://apidoc.natusoft.se/APS/' title=''>http://apidoc.natusoft.se/APS/</a>.      
    </p>
    <p>
      public <em>interface</em> <strong>DataSourceDef </strong>   [se.natusoft.osgi.aps.api.data.jdbc.model] {      
    </p>
    <blockquote>
      <p>
         This represents information required for setting upp a JDBC data source.         
      </p>
    </blockquote>
    <p>
      <strong>String getName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of this data source definition. This information is optional and can return null!        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionURL()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The JDBC connection URL. Ex: jdbc:provider://host:port/database[;properties].        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionDriveName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The fully qualified class name of the JDBC driver to use.        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionUserName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the database user to login as.        
      </p>
    </blockquote>
    <p>
      <strong>String getConnectionPassword()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The password for the database user.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSDataSourceDefService </strong>   [se.natusoft.osgi.aps.api.data.jdbc.service] {      
    </p>
    <blockquote>
      <p>
         This service provides lookup of configured data source definitions. These can be used to setup connection pools, JPA, ...         
      </p>
    </blockquote>
    <p>
      <strong>DataSourceDef lookupByName(String name)</strong>      
    </p>
    <blockquote>
      <p>
         Looks up a data source definition by its configured name.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A DataSourceDef or null if name was not valid.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name to lookup.         
      </p>
    </blockquote>
    <p>
      <strong>List&lt;DataSourceDef&gt; getAllDefinitions()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All available definitions.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJPAService</H1>
    <p>
      This provides JPA to services and applications. It has a slightly more OSGi friendly API than the org.osgi.service.jpa.EntityManagerFactoryBuilder. The APSOpenJPAProvider however returns an APSJPAService instance that also implements EntityManagerFactoryBuilder. For some reason I haven’t figured out yet, it cannot be registered as a service with the EntityManagerFactoryBuilder interface! The bundle fails to deploy if that is done.      
    </p>
    <p>
      The provided service is using OpenJPA. The service works partly as an extender inspecting deployed bundles for a META-INF/persistence.xml file. When found this is read and some setup is done already there. The persistenceUnitName from the persistence.xml file is used to connect the client later with its configuration. When a JPA using bundle is shut down its JPA setup is automatically cleaned.      
    </p>
    <p>
      Here is an example of usage:      
    </p>
    <pre>
      <code>
        private APSJPAEntityManagerProvider emp = null;
        ...
        private APSJPAEntityManagerProvider getEMP() {
            if (this.emp == null || !this.emp.isValid()) {
                DataSourceDef dsDef = this.dataSourceDefService.lookupByName(”MyDS");
                if (dsDef == null) {
                    throw new SomeException("Could not find an ’MyDs’ in 'persistence/datasources' configuration!");
                }
                Map&lt;String, String&gt; props = new HashMap&lt;String, String&gt;();
                props.put("javax.persistence.jdbc.user", dsDef.getConnectionUserName());
                props.put("javax.persistence.jdbc.password", dsDef.getConnectionPassword());
                props.put("javax.persistence.jdbc.url", dsDef.getConnectionURL());
                props.put("javax.persistence.jdbc.driver", dsDef.getConnectionDriveName());
                this.emp = this.jpaService.initialize(this.bundleContext, ”myPersistenceUnitName”, props);
            }
            return this.emp;
        }
        ...
        EntityManager em = getEMP().createEntityManager();
        em.getTransaction().begin();
    
        try {
            RoleEntity role = new RoleEntity(id);
            role.setDescription(description);
            em.persist(role);
            em.getTransaction().commit();
        }
        catch (RuntimeException re) {
            em.getTransaction().rollback();
            throw re;
        }
        finally {
            em.close();
        }
            
      </code>
    </pre>
    <p>
      This code example handles the APSJPAService having been restared or redeployed. When <code>emp.isValid()</code> returns false then all you need to do is to call <code>jpaService.initialize(...)</code> again. The rest is just POJPA (Plain Old JPA :-)).      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSJPAService </strong>   [se.natusoft.osgi.aps.api.data.jpa.service] {      
    </p>
    <blockquote>
      <p>
         This service allows an JPA EntityManager to be gotten for a persistent unit name.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        So why is this done this way ? Why is not an EntityManagerFactory returned?         
      </p>
    </blockquote>
    <blockquote>
      <p>
        The answer to that is that the EntityManagerFactory is internal to the service who is responsible for creating it and for closing it at sometime (stopping of bundle). The client only needs an EntityManager for which the client is responsible after its creation.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        The creation of the EntityManagerFactory is delayed until the call to initialize(...). Creating the EMF along with the persistence provider at persistence bundle discovery would limit database connection properties to the persistence.xml file which is less than optimal to put it mildly. The whole point with the APS project is to provide a configured platform into which you can drop applications and they adapt to their surrounding. Not unlike what JEE does, but does it milder and more flexibly being OSGi and also provides application and service specific configuration with a web gui for editing configuration. Thereby providing database connection properties from clients allows clients more flexibility in how they want to handle that. The APSDataSourceDef service can for example be used to lookup a JDBC connection definition. The default provider implementation of this service uses OpenJPA which provides its own connection pooling.         
      </p>
    </blockquote>
    <p>
      <strong>APSJPAEntityManagerProvider initialize(BundleContext bundleContext, String persistenceUnitName, Map&lt;String, String&gt; props) throws APSResourceNotFoundException</strong>      
    </p>
    <blockquote>
      <p>
         Initializes and returns a provider from the specified properties.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A configured EntityManager.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>bundleContext</em> - The context of the client bundle. It is used to locate its persistence provider.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>persistenceUnitName</em> - The name of the persistent unit defined in persistence.xml.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>props</em> - Custom properties to configure database, etc.         
      </p>
    </blockquote>
    <p>
      public <em>static</em> <em>interface</em> <strong>APSJPAEntityManagerProvider </strong>   [se.natusoft.osgi.aps.api.data.jpa.service] {      
    </p>
    <blockquote>
      <p>
         Once you get this it is valid until the APSJPAService is stopped (which will happen if the service is redeployed!).         
      </p>
    </blockquote>
    <p>
      <strong>public boolean isValid()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if this instance is valid. If not call APSJPAService.initialize(...) again to get a new instance. It will be invalid if the APSJPAService provider have been restarted.         
      </p>
    </blockquote>
    <p>
      <strong>EntityManager createEntityManager()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new EntityManager. You are responsible for closing it!         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Please note that the EntityManager caches all referenced entities. If you keep and reuse it for a longer time it can use more memory. For example at &lt;a href='http://docs.jboss.org/ejb3/app-server/tutorial/extended_pc/extended.html' http://docs.jboss.org/ejb3/app-server/tutorial/extended_pc/extended.html a it says that "Usually, an EntityManager in JBoss EJB 3.0 lives and dies within a JTA transaction". This indicates how long-lived the EntityManager should preferably be.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A configured EntityManager.        
      </p>
    </blockquote>
    <p>
      <strong>EntityManagerFactory getEntityManagerFactory()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the underlaying entity manager factory. This will return null if isValid() return false!         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSJSONService</H1>
    <p>
      This provides exactly the same functionallity as APSJSONLib. It actually wraps the library as a service. The reason for that is that I wanted to be able to redeploy the library without forcing a redeploy of the Bunde using it. A redeploy of the library will force a redeploy of this service, but not the user of this service. The APS users of this service uses APSServiceTracker wrapped as a service and thus handles this service leaving and returning without having to care about it.      
    </p>
    <p>
      This service and the library existrs for internal use. It is here and can be used by anyone, but in most cases like serializing java beans back and forth to JSON (which this can do) Jacksson would still be a better choice and offers more flexibility. In the long run I’m going to see if I can replace the internal use of this with Jacksson as well.      
    </p>
    <H1>APSResolvingBundleDeployer</H1>
    <p>
      This is a bundle deployer that is intended as an alternative to the server provided deployer.      
    </p>
    <p>
      This bundle deployer will try to automatically resolve deploy dependencies. It does this by having a fail threshold. If the deploy of a bundle fails it just keeps quite and put the bundle at the end of the list of bundles to deploy. It updates the try count for the bundle however. Next time the bundle is up for deploy it might have the dependencies it needs and will deploy. If not it goes back to the end of the list again and its retry count is incremented again. This repeats until the retry count reaches the threshold value in which case an error is logged and the bundle will not be attempted to be deployed again unless it gets a new timestamp on disk.      
    </p>
    <p>
      Glassfish does something similar, but Virgo fails completely unless bundles are deployed in the correct order. You have to provide a par file for Virgo to deploy correctly.      
    </p>
    <p>
      There is one catch to using this deployer: It does not handle WAB bundles! Neither Glassfish nor Virgo seems to handle WAB deployment using the OSGi extender pattern. If they did they would recognize a WAB being deployed even though it is deployed by this deployer and handle it. They dont!      
    </p>
    <H2>Configuration</H2>
    <p>
      The following configuration is available for this deployer. Edit this in /apsadminweb ”Configurations” tab under the <em>aps</em> node.      
    </p>
    <p>
      <strong>deployDirectory</strong> - The directory to deploy bundles from. All bundles in this directory will be attempted to be deployed.      
    </p>
    <p>
      <strong>failThreshold</strong> - The number of failed deploys before giving upp. The more bundles and the more dependencies among them the higher the value should be. The default value is 8.      
    </p>
    <H1>APSSessionService</H1>
    <p>
      This service provides session storage functionality. You can create a session, get an existing session by its id, and close a session. Each session can hold any number of named objects.      
    </p>
    <p>
      Why a session service ? To begin with, this is not an HttpSession! That said, it was created to handle a single session among several web applications. This for the APS administration web which are made up of several web applications working toghether. This is explained in detail in the APSAdminWeb documentation.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSSession </strong>   [se.natusoft.osgi.aps.api.misc.session] {      
    </p>
    <blockquote>
      <p>
         This represents an active session.         
      </p>
    </blockquote>
    <p>
      <strong>String getId()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The id of this session.        
      </p>
    </blockquote>
    <p>
      <strong>boolean isValid()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if this session is still valid.        
      </p>
    </blockquote>
    <p>
      <strong>void saveObject(String name, Object object)</strong>      
    </p>
    <blockquote>
      <p>
         Saves an object in the session. Will do nothing if the session is no longer valid.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name to store the object under.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>object</em> - An object to store in the session.         
      </p>
    </blockquote>
    <p>
      <strong>Object retrieveObject(String name)</strong>      
    </p>
    <blockquote>
      <p>
         Returns a object stored under the specified name or null if no object is stored under that name.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        If isValid() returns false then this will always return null.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the object to get.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSessionService </strong>   [se.natusoft.osgi.aps.api.misc.session] {      
    </p>
    <blockquote>
      <p>
         This is not a http session! It is a simple session that can be used by any code running in the same OSGi server.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>APSSession createSession(int timeoutInMinutes)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new session.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>timeoutInMinutes</em> - The timeout in minutes.         
      </p>
    </blockquote>
    <p>
      <strong>APSSession createSession(String sessionId, int timeoutInMinutes)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new session.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        The idea behind this variant is to support distributed sessions. The implementation must use a session id that is unique enough to support this. The APS implementation uses java.util.UUID.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to create.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>timeoutInMinutes</em> - The timeout in minutes.         
      </p>
    </blockquote>
    <p>
      <strong>APSSession getSession(String sessionId)</strong>      
    </p>
    <blockquote>
      <p>
         Looks up an existing session by its id.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A valid session having the specified id or null.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to lookup.         
      </p>
    </blockquote>
    <p>
      <strong>void closeSession(String sessionId)</strong>      
    </p>
    <blockquote>
      <p>
         Closes the session represented by the specified id. After this call APSSession.isValid() on an APSSession representing this session will return false.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>sessionId</em> - The id of the session to close.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSDiscoveryService</H1>
    <p>
      This is actually a service directory that also multicasts on the network to find other instances of itself and makes the services in other instances available also.      
    </p>
    <p>
      A <em>service</em> here means anything that can be called either with an URL or a host and port. It does not specifically indicate what type of service it is. Each published service however has an id that can be used to better identify it. Basically clients of services have to know the id of the service they want and by that know what it is and how to talk to it.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>class</em> <strong>APSDiscoveryPublishException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.net.discovery.exception] {      
    </p>
    <blockquote>
      <p>
         Thrown on service publish problems.         
      </p>
    </blockquote>
    <p>
      <strong>public APSDiscoveryPublishException(String message)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSRuntimeException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <p>
      <strong>public APSDiscoveryPublishException(String message, Throwable cause)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSRuntimeException instance.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The exception message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>cause</em> - The cause of this exception.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>ServiceDescription </strong>   [se.natusoft.osgi.aps.api.net.discovery.model] {      
    </p>
    <blockquote>
      <p>
         Describes a service.         
      </p>
    </blockquote>
    <p>
      <strong>String getDescription()</strong>      
    </p>
    <blockquote>
      <p>
         A short description of the service.         
      </p>
    </blockquote>
    <p>
      <strong>String getServiceId()</strong>      
    </p>
    <blockquote>
      <p>
         An id/name of the service.         
      </p>
    </blockquote>
    <p>
      <strong>String getVersion()</strong>      
    </p>
    <blockquote>
      <p>
         The version of the service.         
      </p>
    </blockquote>
    <p>
      <strong>String getServiceHost()</strong>      
    </p>
    <blockquote>
      <p>
         The targetHost of the service.         
      </p>
    </blockquote>
    <p>
      <strong>int getServicePort()</strong>      
    </p>
    <blockquote>
      <p>
         The targetPort of the service.         
      </p>
    </blockquote>
    <p>
      <strong>String getServiceURL()</strong>      
    </p>
    <blockquote>
      <p>
         An optional URL to the service.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>ServiceDescriptionProvider </strong> implements  ServiceDescription    [se.natusoft.osgi.aps.api.net.discovery.model] {      
    </p>
    <blockquote>
      <p>
         Describes a service.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public ServiceDescriptionProvider()  }  // // Methods //  /** * Returns a string representation of this object. */ public String toString()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new ServiceDescirption.         
      </p>
    </blockquote>
    <p>
      <strong>public String getDescription()</strong>      
    </p>
    <blockquote>
      <p>
         A short description of the service.         
      </p>
    </blockquote>
    <p>
      <strong>public void setDescription(String description)</strong>      
    </p>
    <blockquote>
      <p>
         Sets a short description of the service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>description</em> - The description to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setServiceId(String serviceId)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the id of the service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceId</em> - The service id to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setVersion(String version)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the version of the service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>version</em> - The version to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setServiceHost(String serviceHost)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the targetHost of the service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceHost</em> - The service targetHost to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public void setServicePort(int servicePort)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the targetPort of the servcie.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>servicePort</em> - The service targetPort to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong></strong>      
    </p>
    <blockquote>
      <p>
         Sets an url to the service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceURL</em> - The servcie url to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSSimpleDiscoveryService </strong>   [se.natusoft.osgi.aps.api.net.discovery.service] {      
    </p>
    <blockquote>
      <p>
         A network service discovery.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ServiceDescription&gt; getRemotelyDiscoveredServices()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all remotely discovered services.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ServiceDescription&gt; getLocallyRegisteredServices()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the locally registered services.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ServiceDescription&gt; getAllServices()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all known services, both locally registered and remotely discovered.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ServiceDescription&gt; getService(String serviceId, String version)</strong>      
    </p>
    <blockquote>
      <p>
         Returns all discovered services with the specified id.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceId</em> - The id of the service to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the service to get.         
      </p>
    </blockquote>
    <p>
      <strong>public void publishService(ServiceDescription service) throws APSDiscoveryPublishException</strong>      
    </p>
    <blockquote>
      <p>
         Publishes a local service. This will announce it to other known APSSimpleDiscoveryService instances.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The description of the servcie to publish.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSDiscoveryPublishException</em> - on problems to publish (note: this is a runtime exception!).         
      </p>
    </blockquote>
    <p>
      <strong>public void unpublishService(ServiceDescription service) throws APSDiscoveryPublishException</strong>      
    </p>
    <blockquote>
      <p>
         Recalls the locally published service, announcing to other known APSSimpleDiscoveryService instances that this service is no longer available.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The service to unpublish.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>APSDiscoveryPublishException</em> - on problems to publish (note: this is a runtime exception!).         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSExternalProtocolExtender</H1>
    <p>
      This is an OSGi bundle that makes use of the OSGi extender pattern. It listens to services being registered and unregistered and if the services bundles <em>MANIFEST.MF</em> contains ”APS-Externalizable: true” the service is made externally available. If the <em>MANIFEST.MF</em> contains ”APS-Externalizable: false” however making the service externally available is forbidden.      
    </p>
    <p>
      The exernal protocol extender also provides a configuration where services can be specified with their fully qualified name to be made externally available. If a bundle however have specifically specified false for the above manifest entry then the config entry will be ignored.      
    </p>
    <p>
      So, what is meant by ”made externally available” ? Well what this bundle does is to analyze with reflection all services that are in one way or the other specified as being externalizable (manifest or config) and for all callable methods of the service an <em>APSExternallyCallable</em> object will be created and saved locally with the service name. <em>APSExternallyCallable</em> extends <em>java.util.concurrent.Callable</em>, and adds the possibility to add parameters to calls and also provides meta data for the service method, and the bundle it belongs to.      
    </p>
    <H2>The overall structure</H2>
    <p>
      The complete picture for making services externally callable looks like this:      
    </p>
    <p>
            <img src='file:../../APS-Network/APSExternalProtocolExtender/docs/src/../images/EPERelations.png' title='' alt='EPERelations.png'/>      
    </p>
    <p>
      This bundle provides the glue between the services and the protocols. Transports and protocols have to be provided by other bundles.      
    </p>
    <p>
      The flow is like this:      
    </p>
    <ol>
      <li>
        <p>
          Transport gets some request and an InputStream.          
        </p>
      </li>
      <li>
        <p>
          Transport gets some user selected protocol (The APSExtProtocolHTTPTransportProvider allows specification of both protocol, protocol version, and service to call in the URL).          
        </p>
      </li>
      <li>
        <p>
          Transport calls APSExternalProtocolService to get requested protocol.          
        </p>
      </li>
      <li>
        <p>
          Transport calls protocol to parse InputStream and it returns an RPCRequest.          
        </p>
      </li>
      <li>
        <p>
          Transport uses the information in the RPCRequest to call a service using APSExternalProtocolService.          
        </p>
      </li>
      <li>
        <p>
          Transport takes the result from the call and passes to the protocol along with an OutputStream to write response on.          
        </p>
      </li>
    </ol>
    <H2>APSExternalProtocolService</H2>
    <p>
      This bundle registers an <em>APSExternalProtocolService</em> that will provide all <em>APSExternallyCallable</em> instances (or rather copies of them since you can modify the one you get back by providing arguments). This service also provides getters for available remote protocols and you can register with it to receive information about chages for services and protocols.      
    </p>
    <H3>Protocols</H3>
    <p>
      There is a base API for protocols: RPCProtocol. APIs for different types of protocols should extend this. There is currently only one type of protocol available: <em>StreamedRPCProtocol</em>. The protocol type APIs are service APIs and services implementing them must be provided by other bundles. This bundle looks for and keeps track of all such service providers.      
    </p>
    <p>
      The <em>StreamedRPCProtocol</em> provides a method for parsing a request from an InputStream returning an RPCRequest object. This request object contains the name of the service, the method, and the parameters. This is enough for using <em>APSExternalProtocolService</em> to do a call to the service. The request object is also used to write the call response on an OutputStream. There is also a method to write an error response.      
    </p>
    <p>
      It is the responsibility of the transport provider to use a protocol to read and write requests and responses and to use the request information to call a service method.      
    </p>
    <H3>Getting information about services and protocols.</H3>
    <p>
      A transport provider can register themselves with the <em>APSExternalProtocolService</em> by implementing the <em>APSExternalProtocolListener</em> interface. They will then be notified when a new externalizable service becomes available or is leaving and when a protocol becomes available or is leaving.      
    </p>
    <H2>See also</H2>
    <p>
      <em>APSExtProtocolHTTPTransportProvider</em> - Provides a HTTP transport.      
    </p>
    <p>
      <em>APSStreamedJSONRPCProtocolProvider</em> - Provides version 1.0 and 2.0 of JSONRPC.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSExternalProtocolService </strong>   [se.natusoft.osgi.aps.api.external.extprotocolsvc] {      
    </p>
    <blockquote>
      <p>
         This service makes the currently available externalizable services available for calling. It should be used by a bundle providing an externally available way of calling a service (JSON over http for example) to translate and forward calls to the local service. The locally called service is not required to be aware that it is called externally.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        Never cache any result of this service! Always make a new call to get the current state. Also note that it is possible that the service represented by an APSExternallyCallable have gone away after it was returned, but before you do call() on it! In that case an APSNoServiceAvailableException will be thrown. Note that you can register as an APSExternalProtocolListener to receive notifications about externalizable services coming and going, and also protocols coming and going to keep up to date with the current state of things.          
      </p>
    </blockquote>
    <p>
      <strong>public Set&lt;String&gt; getAvailableServices()</strong>      
    </p>
    <blockquote>
      <p>
         Returns all currently available services.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;APSExternallyCallable&gt; getCallables(String serviceName) throws RuntimeException</strong>      
    </p>
    <blockquote>
      <p>
         Returns all APSExternallyCallable for the named service object.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The name of the service to get callables for.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>RuntimeException</em> - If the service is not available.         
      </p>
    </blockquote>
    <p>
      <strong>public Set&lt;String&gt; getAvailableServiceFunctionNames(String serviceName)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the names of all available functions of the specified service.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The service to get functions for.         
      </p>
    </blockquote>
    <p>
      <strong>public APSExternallyCallable getCallable(String serviceName, String serviceFunctionName)</strong>      
    </p>
    <blockquote>
      <p>
         Gets an APSExternallyCallable for a specified service name and service function name.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An APSExternallyCallable instance or null if the combination of service and serviceFunction is not available.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceName</em> - The name of the service object to get callable for.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>serviceFunctionName</em> - The name of the service function of the service object to get callable for.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;RPCProtocol&gt; getAllProtocols()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All currently deployed providers of RPCProtocol.        
      </p>
    </blockquote>
    <p>
      <strong>public RPCProtocol getProtocolByNameAndVersion(String name, String version)</strong>      
    </p>
    <blockquote>
      <p>
         Returns an RPCProtocol provider by protocol name and version.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        Any matching protocol or null if nothing matches.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the protocol to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the protocol to get.         
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;StreamedRPCProtocol&gt; getAllStreamedProtocols()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        All currently deployed providers of StreamedRPCProtocol.        
      </p>
    </blockquote>
    <p>
      <strong>public StreamedRPCProtocol getStreamedProtocolByNameAndVersion(String name, String version)</strong>      
    </p>
    <blockquote>
      <p>
         Returns a StreamedRPCProtocol provider by protocol name and version.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        Any matching protocol or null if nothing matches.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the streamed protocol to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the streamed protocol to get.         
      </p>
    </blockquote>
    <p>
      <strong>public void addExternalProtocolListener(APSExternalProtocolListener externalServiceListener)</strong>      
    </p>
    <blockquote>
      <p>
         Add a listener for externally available services.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>externalServiceListener</em> - The listener to add.         
      </p>
    </blockquote>
    <p>
      <strong>public void removeExternalProtocolListener(APSExternalProtocolListener externalServiceListener)</strong>      
    </p>
    <blockquote>
      <p>
         Removes a listener for externally available services.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>externalServiceListener</em> - The listener to remove.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSExternallyCallable&lt;ReturnType&gt; </strong> extends  Callable&lt;ReturnType&gt;    [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <blockquote>
      <p>
         This API represents one callable service method.         
      </p>
    </blockquote>
    <p>
      <strong>public String getServiceName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the service this callable is part of.        
      </p>
    </blockquote>
    <p>
      <strong>public String getServiceFunctionName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the service function this callable represents.        
      </p>
    </blockquote>
    <p>
      <strong>public DataTypeDescription getReturnDataDescription()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of the return type.        
      </p>
    </blockquote>
    <p>
      <strong>public List&lt;ParameterDataTypeDescription&gt; getParameterDataDescriptions()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A description of each parameter type.        
      </p>
    </blockquote>
    <p>
      <strong>public Bundle getServiceBundle()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The bundle the service belongs to.        
      </p>
    </blockquote>
    <p>
      <strong>public void setArguments(Object... value)</strong>      
    </p>
    <blockquote>
      <p>
         Provides parameters to the callable using a varags list of parameter values.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>value</em> - A parameter value.         
      </p>
    </blockquote>
    <p>
      <strong>ReturnType call() throws Exception</strong>      
    </p>
    <blockquote>
      <p>
         Calls the service method represented by this APSExternallyCallable.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The return value of the method call if any or null otherwise.        
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>Exception</em> - Any exception the called service method threw.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>APSExternalProtocolListener </strong>   [se.natusoft.osgi.aps.api.external.extprotocolsvc.model] {      
    </p>
    <blockquote>
      <p>
         A listener for externally available services. Please note that this means that the service is available for potential external protocol exposure! For it to be truly available there also has to be a protocol and transport available. It is probably only transports that are interested in this information!         
      </p>
    </blockquote>
    <p>
      <strong>public void externalServiceAvailable(String service, String version)</strong>      
    </p>
    <blockquote>
      <p>
         This gets called when a new externally available service becomes available.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The fully qualified name of the newly available service.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the service.         
      </p>
    </blockquote>
    <p>
      <strong>public void externalServiceLeaving(String service, String version)</strong>      
    </p>
    <blockquote>
      <p>
         This gets called when an externally available service no longer is available.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>service</em> - The fully qualified name of the service leaving.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>version</em> - The version of the service.         
      </p>
    </blockquote>
    <p>
      <strong>public void protocolAvailable(String protocolName, String protocolVersion)</strong>      
    </p>
    <blockquote>
      <p>
         This gets called when a new protocol becomes available.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>protocolName</em> - The name of the protocol.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>protocolVersion</em> - The version of the protocol.         
      </p>
    </blockquote>
    <p>
      <strong>public void protocolLeaving(String protocolName, String protocolVersion)</strong>      
    </p>
    <blockquote>
      <p>
         This gets called when a new protocol is leaving.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>protocolName</em> - The name of the protocol.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>protocolVersion</em> - The version of the protocol.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>class</em> <strong>APSRESTException </strong> extends  APSRuntimeException    [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <blockquote>
      <p>
         This is a special exception that services can throw if they are intended to be available as REST services through the APSExternalProtocolExtender+APSRPCHTTPTransportProvider. This allows for better control over status codes returned by the service call.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
      <strong>public APSRESTException(int httpStatusCode)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSRESTException.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <p>
      <strong>public APSRESTException(int httpStatusCode, String message)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new APSRESTException.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - An error message.         
      </p>
    </blockquote>
    <p>
      <strong>public int getHttpStatusCode()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the http status code.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>enum</em> <strong>ErrorType </strong>   [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <blockquote>
      <p>
         This defines what I think is a rather well though through set of error types applicable for an RPC call. No they are not mine, they come from Matt Morley in his JSONRPC 2.0 specification at http://jsonrpc.org/spec.html.         
      </p>
    </blockquote>
    <p>
      <strong>PARSE_ERROR</strong>      
    </p>
    <blockquote>
      <p>
         Invalid input was received by the server. An error occurred on the server while parsing request data.         
      </p>
    </blockquote>
    <p>
      <strong>INVALID_REQUEST</strong>      
    </p>
    <blockquote>
      <p>
         The request data sent is not a valid.         
      </p>
    </blockquote>
    <p>
      <strong>METHOD_NOT_FOUND</strong>      
    </p>
    <blockquote>
      <p>
         The called method does not exist / is not available.         
      </p>
    </blockquote>
    <p>
      <strong>INVALID_PARAMS</strong>      
    </p>
    <blockquote>
      <p>
         The parameters to the method are invalid.         
      </p>
    </blockquote>
    <p>
      <strong>INTERNAL_ERROR</strong>      
    </p>
    <blockquote>
      <p>
         Internal protocol error.         
      </p>
    </blockquote>
    <p>
      <strong>SERVER_ERROR</strong>      
    </p>
    <blockquote>
      <p>
         Server related errors.         
      </p>
    </blockquote>
    <p>
      <strong>REST</strong>      
    </p>
    <blockquote>
      <p>
         This means the protocol is of REST type and should return a HTTP status code.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCError </strong>   [se.natusoft.osgi.aps.api.net.rpc.errors] {      
    </p>
    <blockquote>
      <p>
         This represents an error in servicing an RPC request.         
      </p>
    </blockquote>
    <p>
      <strong>public ErrorType getErrorType()</strong>      
    </p>
    <blockquote>
      <p>
         The type of the error.         
      </p>
    </blockquote>
    <p>
      <strong>public int getRESTHttpStatusCode()</strong>      
    </p>
    <blockquote>
      <p>
         This should return a valid http status code if ErrorType == REST.         
      </p>
    </blockquote>
    <p>
      <strong>public String getMessage()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an error message. This is also optional.         
      </p>
    </blockquote>
    <p>
      <strong>public boolean hasOptionalData()</strong>      
    </p>
    <blockquote>
      <p>
         True if there is optional data available. An example of optional data would be a stack trace for example.         
      </p>
    </blockquote>
    <p>
      <strong>public String getOptionalData()</strong>      
    </p>
    <blockquote>
      <p>
         The optional data.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>abstract</em> <em>class</em> <strong>AbstractRPCRequest </strong> implements  RPCRequest    [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <blockquote>
      <p>
         This contains a parsed JSONRPC request.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public AbstractRPCRequest(String method)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new AbstractRPCRequest.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>method</em> - The method to call.         
      </p>
    </blockquote>
    <p>
      <strong>public AbstractRPCRequest(RPCError error)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new AbstractRPCRequest.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>error</em> - An RPCError indicating a request problem, most probably of ErrorType.PARSE_ERROR type.         
      </p>
    </blockquote>
    <p>
      <strong>public AbstractRPCRequest(String method, Object callId)</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new AbstractRPCRequest.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>method</em> - The method to call.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>callId</em> - The callId of the call.         
      </p>
    </blockquote>
    <p>
      <strong>protected Map&lt;String, Object&gt; getNamedParameters()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The named parameters.        
      </p>
    </blockquote>
    <p>
      <strong>protected List&lt;Object&gt; getParameters()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The sequential parameters.        
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      <strong>public void setServiceQName(String serviceQName)</strong>      
    </p>
    <blockquote>
      <p>
         Sets the fully qualified name of the service to call. This is optional since not all protocol delivers a service name this way.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceQName</em> - The service name to set.         
      </p>
    </blockquote>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
            
    </p>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCRequest </strong>   [se.natusoft.osgi.aps.api.net.rpc.model] {      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <strong>boolean isValid()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if this request is valid. If this returns false all information except getError() is invalid, and getError() should return a valid RPCError object.         
      </p>
    </blockquote>
    <p>
      <strong>RPCError getError()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an RPCError object if isValid() == false, null otherwise.         
      </p>
    </blockquote>
    <p>
      <strong>String getServiceQName()</strong>      
    </p>
    <blockquote>
      <p>
         Returns a fully qualified name of service to call. This will be null for protocols where service name is not provided this way. So this cannot be taken for given!         
      </p>
    </blockquote>
    <p>
      <strong>String getMethod()</strong>      
    </p>
    <blockquote>
      <p>
         REST protocol where it will be part of the URL.         
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The method to call. This can return null if the method is provided by other means, for example a        
      </p>
    </blockquote>
    <p>
      <strong>boolean hasCallId()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if there is a call id available in the request.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        A call id is something that is received with a request and passed back with the response to the request. Some RPC implementations will require this and some wont.         
      </p>
    </blockquote>
    <p>
      <strong>Object getCallId()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the method call call Id.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        A call id is something that is received with a request and passed back with the response to the request. Some RPC implementations will require this and some wont.         
      </p>
    </blockquote>
    <p>
      <strong>void addParameter(Object parameter)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a parameter. This is mutually exclusive with addParameter(name, parameter)!          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>parameter</em> - The parameter to add.         
      </p>
    </blockquote>
    <p>
      <strong>void addNamedParameter(String name, Object parameter)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a named parameter. This is mutually exclusive with addParameter(parameter)!          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the parameter.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>parameter</em> - The parameter to add.         
      </p>
    </blockquote>
    <p>
      <strong>int getNumberOfParameters()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The number of parameters available.        
      </p>
    </blockquote>
    <p>
      <strong>&lt;T&gt; T getParameter(int index, Class&lt;T&gt; paramClass)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the parameter at the specified index.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The parameter object.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>index</em> - The index of the parameter to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>paramClass</em> - The expected class of the parameter.         
      </p>
    </blockquote>
    <p>
      <strong>boolean hasNamedParameters()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        true if there are named parameters available. If false the plain parameter list should be used.        
      </p>
    </blockquote>
    <p>
      <strong>Set&lt;String&gt; getParameterNames()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The available parameter names.        
      </p>
    </blockquote>
    <p>
      <strong>&lt;T&gt; T getNamedParameter(String name, Class&lt;T&gt; paramClass)</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A named parameter.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the parameter to get.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>paramClass</em> - The expected class of the parameter.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>RPCProtocol </strong>   [se.natusoft.osgi.aps.api.net.rpc.service] {      
    </p>
    <blockquote>
      <p>
         This represents an RPC protocol provider. This API is not enough in itself, it is a common base for different protocols.         
      </p>
    </blockquote>
    <p>
      <strong>String getServiceProtocolName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the provided protocol.        
      </p>
    </blockquote>
    <p>
      <strong>String getServiceProtocolVersion()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The version of the implemented protocol.        
      </p>
    </blockquote>
    <p>
      <strong>String getRequestContentType()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The expected content type of a request. This should be verified by the transport if it has content type availability.        
      </p>
    </blockquote>
    <p>
      <strong>String getResponseContentType()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The content type of the response for when such can be provided.        
      </p>
    </blockquote>
    <p>
      <strong>String getRPCProtocolDescription()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A short description of the provided service. This should be in plain text.        
      </p>
    </blockquote>
    <p>
      <strong>RPCError createRPCError(ErrorType errorType, String message, String optionalData)</strong>      
    </p>
    <blockquote>
      <p>
         Factory method to create an error object.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        An RPCError implementation.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>errorType</em> - The type of the error.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - An error message.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>optionalData</em> - Whatever optional data you want to pass along or null.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>StreamedRPCProtocol </strong> extends  RPCProtocol    [se.natusoft.osgi.aps.api.net.rpc.service] {      
    </p>
    <blockquote>
      <p>
         This represents an RPC protocol provider that provide client/service calls with requests read from an InputStream and responses written to an OutputStream.         
      </p>
    </blockquote>
    <p>
      <strong>boolean isREST()</strong>      
    </p>
    <blockquote>
      <p>
         Returns true if the protocol is a REST protocol.         
      </p>
    </blockquote>
    <p>
      <strong>List&lt;RPCRequest&gt; parseRequests(String serviceQName, InputStream requestStream) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Parses a request from the provided InputStream and returns 1 or more RPCRequest objects.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The parsed requests.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>serviceQName</em> - A fully qualified name to the service to call. This can be null if service name is provided on the stream.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>requestStream</em> - The stream to parse request from.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>void writeResponse(Object result, RPCRequest request, OutputStream responseStream) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes a successful response to the specified OutputStream.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>result</em> - The resulting object of the RPC call or null if void return. If is possible a non void method also returns null!         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>request</em> - The request this is a response to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>responseStream</em> - The OutputStream to write the response to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>void writeErrorResponse(RPCError error, RPCRequest request, OutputStream responseStream) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Writes an error response.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>error</em> - The error to pass back.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>request</em> - The request that this is a response to.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>responseStream</em> - The OutputStream to write the response to.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>IOException</em> - on IO failure.         
      </p>
    </blockquote>
    <p>
      <strong>RPCError createRESTError(int httpStatusCode)</strong>      
    </p>
    <blockquote>
      <p>
         Returns an RPCError for a REST protocol with a http status code.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <p>
      <strong>RPCError createRESTError(int httpStatusCode, String message)</strong>      
    </p>
    <blockquote>
      <p>
         Returns an RPCError for a REST protocol with a http status code.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>httpStatusCode</em> - The http status code to return.         
      </p>
    </blockquote>
    <blockquote>
      <p>
        <em>message</em> - An error message.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSExtProtocolHTTPTransportProvider</H1>
    <p>
      This provides an http transport for simple remote requests to OSGi services that have "APS-Externalizable: true" in their META-INF/MANIFEST.MF. This follows the OSGi extender pattern and makes any registered OSGi services of bundles having the above manifest entry available for remote calls over HTTP. This transport makes use of the aps-external-protocol-extender which exposes services with the above mentioned manifest entry with each service method available as an APSExternallyCallable.The aps-ext-protocol-http-transport-provider for example acts as a mediator between the protocol implementations and aps-external-protocol-extender for requests over HTTP.      
    </p>
    <p>
      Please note that depending on protocol not every service method will be callable. It depends on its arguments and return value. It mostly depends on how well the protocol handles types and can convert between the caller and the service.      
    </p>
    <p>
      This does not provide any protocol, only transport! For services to be able to be called at least one protocol is needed. Protocols are provided by providing an implementation of se.natusoft.osgi.aps.api.net.rpc.service.StreamedRPCProtocolService and registering it as an OSGi service. The StreamedRPCProtocolService API provides a protocol name and protocol version getter which is used to identify it. A call to an RPC service looks like this:      
    </p>
    <p>
      &nbsp; &nbsp; &nbsp; &nbsp;http://host:port/apsrpc/<em>protocol</em>/<em>version</em>[/<em>service</em>][/<em>method</em>]      
    </p>
    <p>
      <em>protocol</em> - This is the name of the protocol to use. An implementation of that protocol must of course be available for this to work. If it isn't you will get a 404 back! The protocol service (RPCProtocol&lt;-StreamedRPCProtocol) provides a name for each protocol. It is this name that is referenced.      
    </p>
    <p>
      <em>version</em> - This is the version of the protocol. If this doesn't match any protocols available you will also get a 404 back.      
    </p>
    <p>
      <em>service</em> - This is the service to call. Depending on the protocol you might not need this. But for protocols that only provide method in the stream data like JSONRPC for example, then this is needed. When provided it has to be a fully qualified service interface class name.      
    </p>
    <p>
      <em>method</em> - This is the method to call. The need for this also depends on the protocol. A REST protocol would need it. The JSONRPC protocol does not. When this is specified in the URL then it will be used even if the protocol provides the method in the request! Please note that a method can be specified on two ways:      
    </p>
    <ul>
      <li>
        <p>
          method(type,...)          
        </p>
      </li>
      <li>
        <p>
          method          
        </p>
      </li>
    </ul>
    <p>
      The method will be resolved in that order. The parameter type specifying version is required when there are several methods with the same name but different parameters. The method name only will give you the last one in that case.      
    </p>
    <H2>Example</H2>
    <p>
      Here is an example calling the APSPlatformService with JSONRPC 2.0 using curl:      
    </p>
    <pre>
      <code>
    curl --data '{"jsonrpc": "2.0", "method": "getPlatformDescription", "params": [], "id": 1}' http://localhost:8080/apsrpc/JSONRPC/2.0/se.natusoft.osgi.aps.api.core.platform.service.APSPlatformService 
      </code>
    </pre>
    <p>
      Yields:      
    </p>
    <pre>
      <code>
    {
        "id": 1, 
        "result": 
        {
            "description": "My personal development environment.", 
            "type": "Development", 
            "identifier": "MyDev"
        }
    , 
        "jsonrpc": "2.0"
    }
      </code>
    </pre>
    <p>
      The APSPlatformService is a plain OSGi service that provides data with JavaBean setters and getters. This simple example only works if you have disabled the ”requireAuthentication” configuration (network/rpc-http-transport).      
    </p>
    <H2>Authentication</H2>
    <p>
      Authentication for services are provided in 2 ways. Both require a userid and a password and both validate the user using the APSAuthService.      
    </p>
    <p>
      The 2 alternatives are:      
    </p>
    <ul>
      <li>
        <p>
          http://.../apsrpc/<strong>auth:user:password</strong>/protocol/...          
        </p>
      </li>
      <li>
        <p>
          Basic HTTP authentication using header: 'Authorization: Basic {<em>base 64 encoded user:password</em>}’.          
        </p>
      </li>
    </ul>
    <p>
      One of these will be required if the <em>requireAuthentication</em> configuration have been enabled.      
    </p>
    <H2>The help web</H2>
    <p>
      Opening the <em>http://.../apsrpc/_help/</em> URL will give you a web page that provides a lot of information. This page requires authentication since it register itself with the APSAdminWeb (/apsadminweb) as ”Remote Services” and appears there as a tab, and thus joins in with the APSAdminWeb authentication.      
    </p>
    <p>
      In addition to much of the same information as in this documentation it also lists all protocols tracked by the <em>APSExternalProtocolExtender</em> with their name, version, description, and other properties. Next it lists all services that <em>APSExternalProtocolExtender</em> provides as callable. Each of these services are a link that can be clicked. Clicking on a service will show all the methods of the service and then list the call url for each method per protocol. Each method listed is also a link, and clicking that link will give you a page where you can provide arguments and then press execute to call the service. The result will be displayed as JSON on the same page. This is very useful for testing and debugging services.      
    </p>
    <H2>See Also</H2>
    <p>
      Also look at the documentation for APSExternalProtocolExtender.      
    </p>
    <H1>APSGroups</H1>
    <p>
      Provides network groups where named groups can be joined as members and then send and receive data messages to the group. This is based on multicast and provides a verified multicast delivery with acknowledgements of receive to the sender and resends if needed. The sender will get an exception if not all members receive all data. Member actuality is handled by members announcing themselves relatively often and will be removed when an announcement does not come in expected time. So if a member dies unexpectedly (network goes down, etc) its membership will resolve rather quickly. Members also tries to inform the group when they are doing a controlled exit.      
    </p>
    <p>
      Please note that this does not support streaming! That would require a far more complex protocol. APSGroups waits in all packets of a message before delivering the message.      
    </p>
    <H2>OSGi service usage</H2>
    <p>
      The APSGroupsService can be used as an OSGi service and as a standalone library. This section describes the service.      
    </p>
    <H3>Getting the service</H3>
    <pre>
      <code>
    APSServiceTracker&lt;APSGroupService&gt; apsGroupsServiceTracker = 
        new APSServiceTracker&lt;APSGroupsService&gt;(bundleContext, APSConfigService.class,
        APSServiceTracker.LARGE_TIMEOUT);
    APSGroupsService apsGroupsService = apsGroupsServiceTracker.getWrappedService();
    
      </code>
    </pre>
    <H3>Joining a group</H3>
    <pre>
      <code>
    GroupMember groupMember = apsGroupsService.joinGroup(”mygroup”);
    
      </code>
    </pre>
    <H3>Sending a message</H3>
    <p>
      To send a message you create a message, get its output stream and write whatever you want to send on that output stream, close it and then send it. <em>Note</em> that since the content of the message is any data you want, all members of the groups must know how the data sent looks like. In other words, you have to define your own message protocol for your messages. Note that you can wrap the OutputStream in an ObjectOutputStream and serialize any java object you want.      
    </p>
    <pre>
      <code>
    Message message = groupMember.createNewMessage();
    OutputStream msgDataStream = message.getOutputStream();
    try {
        ...
        msgDataStream.close();
        groupMember.sendMessage(message);
    }
    catch (IOException ioe) {
        ...
    }
    
      </code>
    </pre>
    <p>
      Note that the <code>groupMember.sendMessage(message)</code> does throw an IOException on failure to deliver the message to all members.      
    </p>
    <H3>Receiving a message</H3>
    <p>
      To receive a message you have to register a message listener with the GroupMember object.      
    </p>
    <pre>
      <code>
    MessageListener msgListener = new MyMsgListener();
    groupMember.addMessageListener(myMsgListener); 
      </code>
    </pre>
    <p>
      and then handle received messages:      
    </p>
    <pre>
      <code>
    public class MyMsgListener implements MessageListener {
        public void messageReceived(Message message) {
            InputStream msgDataStream = message.getInputStream();
            ...
        }
    }
      </code>
    </pre>
    <H3>Leaving a group</H3>
    <pre>
      <code>
    apsGroupsService.leaveGroup(groupMember);
    
      </code>
    </pre>
    <H2>Library usage</H2>
    <p>
      The bundle jar file can also be used as a library outside of an OSGi server, with an API that has no other dependencies than what is in the jar. The API is then slightly different, and resides under the se.natusoft.apsgroups package.      
    </p>
    <H3>Setting up</H3>
    <pre>
      <code>
    APSGroups apsGroups = new APSGroups(config, logger);
    apsGroups.connect();
    
      </code>
    </pre>
    <p>
      The config passed as argument to APSGroups will be explained further down under ”Configuration”.      
    </p>
    <p>
      The <em>logger</em> is an instance of an implementation of the APSGroupsLogger interface. Either you provide your own implementation of that or your use the APSGroupsSystemOutLogger implementation.      
    </p>
    <H3>Joining a group</H3>
    <pre>
      <code>
    GroupMember groupMember = apsGroups.joinGroup(”mygroup”);
      </code>
    </pre>
    <H3>Sending and receiving messages</H3>
    <p>
      Sending and receiving works exactly like the OSGi examples above.      
    </p>
    <H3>Leaving a group</H3>
    <pre>
      <code>
    apsGroups.leaveGroup(groupMember);
      </code>
    </pre>
    <H3>Shutting down</H3>
    <pre>
      <code>
    apsGroups.disconnect();
    
      </code>
    </pre>
    <H2>Net time</H2>
    <p>
      All APSGroups instances connected will try to sync their time. I call this synced time ”net time”.      
    </p>
    <p>
      It works like this: When an APSGroups instance comes up it waits a while for NET_TIME packets. If it gets such a packet then it enters receive mode and takes the time in the received NET_TIME packet and stores a diff to that time and local time. This diff can then be used to translate back and forth between local and net time. If no such packet arrives in expected time it enters send mode and starts sending NET_TIME packets itself using its current net time. If a NET_TIME packet is received when in send mode it directly goes over to listen mode. If in listen mode and no NET_TIME packet comes in reasonable time it goes over to send mode. So among all instances on the network only one is responsible for sending NET_TIME. If that instance leaves then there might be a short fight for succession, but it will resolve itself rather quickly.      
    </p>
    <p>
      The GroupMember contains a few <em>create*</em> methods to produce a <em>NetTime</em> object instance. See the API further down for more information on these.      
    </p>
    <H2>Configuration</H2>
    <H3>OSGi service </H3>
    <p>
      The OSGi service provides a configuration model that gets managed by the APSConfigService. It can be configured in the APS adminweb (http://host:port/apsadminweb/). Here is a screenshot of the config admin:      
    </p>
    <p>
            <img src='file:../../APS-Network/APSGroups/docs/src/../images/config.png' title='' alt='/apsconfigadmin web gui for configuring APSGroups'/>      
    </p>
    <H3>Library </H3>
    <p>
      The library wants an implementation of the APSGroupsConfig interface as its first argument to APSGroups(config, logger) constructor. Either you implement your own or use the APSGroupsConfigProvider implementation. This is a plain java bean with both setters and getters for the config values. It comes with quite reasonable default values. It contains exactly the same properties as shown in the picture above.      
    </p>
    <H2>APIs</H2>
    <p>
      public <em>interface</em> <strong>APSGroupsService </strong>   [se.natusoft.osgi.aps.api.net.groups.service] {      
    </p>
    <blockquote>
      <p>
         A service that lets clients send data reliable to all members of a group on any host. There is no limit on the size of the data sent, but that said I wouldn't send MB:s of data!         
      </p>
    </blockquote>
    <p>
      <strong>GroupMember joinGroup(String name) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Joins a group.          
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        A GroupMember that provides the API for sending and receiving data in the group.        
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>name</em> - The name of the group to join.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>java.io.IOException</em> - The unavoidable one!         
      </p>
    </blockquote>
    <p>
      <strong>void leaveGroup(GroupMember groupMember) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Leaves as member of group.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>groupMember</em> - The GroupMember returned when joined.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>java.io.IOException</em> - The unavoidable one!         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>GroupMember </strong>   [se.natusoft.osgi.aps.api.net.groups.service] {      
    </p>
    <blockquote>
      <p>
         This is the API for APSGroupsService members received when they join a group. It is used to send and receive data messages to/from the group.         
      </p>
    </blockquote>
    <p>
      <strong>void addMessageListener(MessageListener listener)</strong>      
    </p>
    <blockquote>
      <p>
         Adds a listener for incoming messages.         
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>listener</em> - The listener to add.         
      </p>
    </blockquote>
    <p>
      <strong>void removeMessageListener(MessageListener listener)</strong>      
    </p>
    <blockquote>
      <p>
         Removes a listener for incoming messages.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>listener</em> - The listener to remove.         
      </p>
    </blockquote>
    <p>
      <strong>Message createNewMessage()</strong>      
    </p>
    <blockquote>
      <p>
         Creates a new Message to send. Use the sendMessage() method when ready to send it.         
      </p>
    </blockquote>
    <p>
      <strong>void sendMessage(Message message) throws IOException</strong>      
    </p>
    <blockquote>
      <p>
         Sends a previously created message to all current members of the group. If this returns without an exception then all members have received the message.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The message to send.         
      </p>
    </blockquote>
    <p>
      <em>Throws</em>      
    </p>
    <blockquote>
      <p>
        <em>java.io.IOException</em> - On failure to reach all members.         
      </p>
    </blockquote>
    <p>
      <strong>UUID getMemberId()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The ID of the member.        
      </p>
    </blockquote>
    <p>
      <strong>List&lt;String&gt; getMemberInfo()</strong>      
    </p>
    <blockquote>
      <p>
         Returns information about members.         
      </p>
    </blockquote>
    <p>
      <strong>NetTime getNow()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The current time as net time.        
      </p>
    </blockquote>
    <p>
      <strong>NetTime createFromNetTime(long netTimeMillis)</strong>      
    </p>
    <blockquote>
      <p>
         Creates from milliseconds in net time.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>netTimeMillis</em> - The net time milliseconds to create a NetTime for.         
      </p>
    </blockquote>
    <p>
      <strong>NetTime createFromNetTime(Date netTimeDate)</strong>      
    </p>
    <blockquote>
      <p>
         Creates from a Date in net time.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>netTimeDate</em> - The Date in net time to create a NetTime for.         
      </p>
    </blockquote>
    <p>
      <strong>NetTime createFromLocalTime(long localTimeMillis)</strong>      
    </p>
    <blockquote>
      <p>
         Creates from milliseconds in local time.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>localTimeMillis</em> - The local time milliseconds to create a NetTime for.         
      </p>
    </blockquote>
    <p>
      <strong>NetTime createFromLocalTime(Date localTimeDate)</strong>      
    </p>
    <blockquote>
      <p>
         Creates from a Date in local time.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>localTimeDate</em> - The Date in local time to create a NetTime for.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>Message </strong>   [se.natusoft.osgi.aps.api.net.groups.service] {      
    </p>
    <blockquote>
      <p>
         This represents a complete message containing any data you want to send to the group. You provide the message with data using the OutputStream, and read message data using the InputStream.         
      </p>
    </blockquote>
    <p>
      <strong>OutputStream getOutputStream()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an OutputStream to write message on. Multiple calls to this will return the same OutputStream!         
      </p>
    </blockquote>
    <p>
      <strong>InputStream getInputStream()</strong>      
    </p>
    <blockquote>
      <p>
         Returns an InputStream for reading the message. Multiple calls to this will return new InputStream:s starting from the beginning!         
      </p>
    </blockquote>
    <p>
      <strong>UUID getId()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the id of this message.         
      </p>
    </blockquote>
    <p>
      <strong>String getMemberId()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        id of member as a string.        
      </p>
    </blockquote>
    <p>
      <strong>String getGroupName()</strong>      
    </p>
    <blockquote>
      <p>
                 
      </p>
    </blockquote>
    <p>
      <em>Returns</em>      
    </p>
    <blockquote>
      <p>
        The name of the group this message belongs to.        
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>MessageListener </strong>   [se.natusoft.osgi.aps.api.net.groups.service] {      
    </p>
    <blockquote>
      <p>
         For listening on messages from the group.         
      </p>
    </blockquote>
    <p>
      <strong>public void messageReceived(Message message)</strong>      
    </p>
    <blockquote>
      <p>
         Notification of received message.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>message</em> - The received message.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <p>
      public <em>interface</em> <strong>NetTime </strong> extends  Serializable    [se.natusoft.osgi.aps.api.net.groups.service] {      
    </p>
    <blockquote>
      <p>
         This represents a common network time between members for handling date and time data. The net time is synchronized between all members. Each receiver of net time diffs it with local time and stores the diff so that they can convert to/from local/net time.         
      </p>
    </blockquote>
    <p>
      <strong>public long getNetTime()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the number of milliseconds since Januray 1, 1970 in net time.         
      </p>
    </blockquote>
    <p>
      <strong>public Date getNetTimeDate()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the net time as a Date.         
      </p>
    </blockquote>
    <p>
      <strong>public Calendar getNetTimeCalendar()</strong>      
    </p>
    <blockquote>
      <p>
         Returns the net time as a Calendar.         
      </p>
    </blockquote>
    <p>
      <strong>public Calendar getNetTimeCalendar(Locale locale)</strong>      
    </p>
    <blockquote>
      <p>
         Returns the net time as a Calendar.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>locale</em> - The locale to use.         
      </p>
    </blockquote>
    <p>
      <strong>public Date getLocalTimeDate()</strong>      
    </p>
    <blockquote>
      <p>
         Converts the net time to local time and returns as a Date.         
      </p>
    </blockquote>
    <p>
      <strong>public Calendar getLocalTimeCalendar()</strong>      
    </p>
    <blockquote>
      <p>
         Converts the net time to local time and returns as a Calendar.         
      </p>
    </blockquote>
    <p>
      <strong>public Calendar getLocalTimeCalendar(Locale locale)</strong>      
    </p>
    <blockquote>
      <p>
         Converts the net time to local time and returns as a Calendar.          
      </p>
    </blockquote>
    <p>
      <em>Parameters</em>      
    </p>
    <blockquote>
      <p>
        <em>locale</em> - The locale to use.         
      </p>
    </blockquote>
    <p>
      }      
    </p>
    <hr/>    <p>
                
    </p>
    <H1>APSStreamedJSONRPCProtocolProvider</H1>
    <p>
      This provides JSONRPC protocol. It provides both version 1.0 and 2.0 of the protocol. It requires a transport that uses it and services provided by aps-external-protocol-extender to be useful.      
    </p>
    <p>
      The 1.0 version of the JSONRPC protocol are described at <a href='http://json-rpc.org/wiki/specification' title=''>http://json-rpc.org/wiki/specification</a>.      
    </p>
    <p>
      The 2.0 version of the JSONRPC protocol are describved at <a href='http://jsonrpc.org/spec.html' title=''>http://jsonrpc.org/spec.html</a>.      
    </p>
    <H2>See also</H2>
    <p>
      Se the documentation for <em>APSExtProtocolHTTPTransportProvider</em> for an HTTP transport through which these protocols can be used.      
    </p>
    <p>
      Se the documentation for <em>APSExternalProtocolExtender</em> for a description of how services are made available and what services it provides for transport providers.      
    </p>
  </body>
</html>
